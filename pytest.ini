# pytest configuration for GreenLang
# This file configures pytest behavior, test discovery, and coverage settings

[tool:pytest]
# Test discovery patterns
python_files = test_*.py *_test.py tests_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths =
    tests
    applications/GL-CBAM-APP/tests
    applications/GL-CSRD-APP/tests
    applications/GL-VCCI-Carbon-APP/tests
    greenlang/tests

# Minimum version requirement
minversion = 7.0

# Add current directory to Python path
pythonpath = .

# Strict markers - fail on unknown markers
strict_markers = true

# Coverage settings
addopts =
    --verbose
    --strict-markers
    --tb=short
    --cov=greenlang
    --cov=applications/GL-CBAM-APP
    --cov=applications/GL-CSRD-APP
    --cov=applications/GL-VCCI-Carbon-APP
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=85
    --maxfail=1
    --disable-warnings
    -p no:warnings

# Ignore certain directories during collection
norecursedirs =
    .git
    .github
    .tox
    dist
    build
    *.egg
    __pycache__
    venv
    env
    .venv
    node_modules
    .pytest_cache
    htmlcov
    docs
    examples
    benchmarks

# Ignore deprecation warnings from third-party libraries
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning
    ignore::ResourceWarning
    error::UserWarning

# Markers for test categorization
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests
    unit: marks tests as unit tests
    e2e: marks tests as end-to-end tests
    smoke: marks tests as smoke tests
    performance: marks tests as performance tests
    security: marks tests as security tests
    requires_db: marks tests that require database
    requires_redis: marks tests that require Redis
    requires_docker: marks tests that require Docker
    skip_ci: marks tests to skip in CI environment
    wip: work in progress tests
    critical: critical tests that must pass
    compliance: regulatory compliance tests
    property: property-based tests (hypothesis)
    network: tests that require network access

# Logging
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/tests.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Console output
console_output_style = progress

# Timeout for tests (in seconds)
timeout = 300

# Parallel execution settings (requires pytest-xdist)
# Uncomment to enable parallel testing
# addopts = -n auto

# JUnit XML output for CI systems
junit_family = xunit2
junit_suite_name = GreenLang Test Suite

# Doctest configuration
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# Coverage configuration
[coverage:run]
branch = True
source =
    greenlang
    applications/GL-CBAM-APP
    applications/GL-CSRD-APP
    applications/GL-VCCI-Carbon-APP

omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */venv/*
    */.venv/*
    */migrations/*
    */conftest.py
    */setup.py
    */config/*
    */__init__.py
    */site-packages/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
skip_empty = True

# Thresholds
fail_under = 85

exclude_lines =
    pragma: no cover
    def __repr__
    def __str__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
    @abc.abstractmethod
    except ImportError
    pass

[coverage:html]
directory = htmlcov
title = GreenLang Coverage Report
show_contexts = True

[coverage:xml]
output = coverage.xml