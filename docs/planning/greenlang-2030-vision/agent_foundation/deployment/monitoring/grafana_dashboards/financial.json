{
  "dashboard": {
    "uid": "financial-dashboard",
    "title": "Financial Dashboard - GreenLang",
    "description": "Cost tracking, optimization opportunities, and budget monitoring",
    "tags": ["financial", "costs", "budget"],
    "timezone": "browser",
    "refresh": "1h",
    "time": {
      "from": "now-30d",
      "to": "now"
    },
    "panels": [
      {
        "id": 1,
        "title": "Monthly Cost Breakdown",
        "type": "piechart",
        "datasource": "Prometheus",
        "gridPos": {"h": 10, "w": 10, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "sum(increase(greenlang_agents_api_calls{api=\"llm\"}[30d])) * 0.002",
            "legendFormat": "LLM API",
            "refId": "A"
          },
          {
            "expr": "sum(greenlang_agents_pod_count) * 0.05 * 24 * 30",
            "legendFormat": "Compute",
            "refId": "B"
          },
          {
            "expr": "sum(greenlang_agents_database_connections) * 0.02 * 24 * 30",
            "legendFormat": "Database",
            "refId": "C"
          },
          {
            "expr": "sum(greenlang_agents_data_processed_bytes) / 1073741824 * 0.09",
            "legendFormat": "Storage",
            "refId": "D"
          }
        ],
        "options": {
          "pieType": "donut",
          "displayLabels": ["name", "value", "percent"],
          "legendDisplayMode": "table",
          "legendPlacement": "right",
          "legendValues": ["value", "percent"],
          "unit": "currencyUSD"
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "decimals": 2
          }
        }
      },
      {
        "id": 2,
        "title": "Cost Trend (Daily)",
        "type": "graph",
        "datasource": "Prometheus",
        "gridPos": {"h": 10, "w": 14, "x": 10, "y": 0},
        "targets": [
          {
            "expr": "sum(increase(greenlang_agents_api_calls[1d])) * 0.002",
            "legendFormat": "API Costs",
            "refId": "A"
          },
          {
            "expr": "sum(avg_over_time(greenlang_agents_pod_count[1d])) * 0.05 * 24",
            "legendFormat": "Infrastructure",
            "refId": "B"
          },
          {
            "expr": "(sum(increase(greenlang_agents_api_calls[1d])) * 0.002) + (sum(avg_over_time(greenlang_agents_pod_count[1d])) * 0.05 * 24)",
            "legendFormat": "Total Daily Cost",
            "refId": "C"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 20,
              "gradientMode": "opacity",
              "spanNulls": false,
              "showPoints": "never",
              "stacking": {
                "mode": "normal",
                "group": "A"
              }
            }
          }
        },
        "options": {
          "tooltip": {"mode": "multi"},
          "legend": {
            "displayMode": "list",
            "placement": "bottom",
            "calcs": ["lastNotNull", "mean", "sum"]
          }
        }
      },
      {
        "id": 3,
        "title": "Cost per Agent",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 10},
        "targets": [
          {
            "expr": "((sum(rate(greenlang_agents_api_calls[1h])) * 0.002) + (sum(greenlang_agents_pod_count) * 0.05)) / sum(greenlang_agents_agent_count)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "displayName": "$/Agent/Hour",
            "decimals": 4,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.01},
                {"color": "red", "value": 0.05}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Cost per Report",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 10},
        "targets": [
          {
            "expr": "(sum(increase(greenlang_agents_api_calls[24h])) * 0.002) / sum(increase(greenlang_agents_reports_generated[24h]))",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "displayName": "$/Report",
            "decimals": 3,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 0.5},
                {"color": "red", "value": 1}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "API Call Efficiency",
        "type": "gauge",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 10},
        "targets": [
          {
            "expr": "avg(greenlang_agents_cache_hit_rate) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "displayName": "Cache Hit Rate",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 70},
                {"color": "green", "value": 85}
              ]
            }
          }
        }
      },
      {
        "id": 6,
        "title": "Monthly Budget Status",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 10},
        "targets": [
          {
            "expr": "(sum(increase(greenlang_agents_api_calls[30d])) * 0.002 + sum(greenlang_agents_pod_count) * 0.05 * 24 * 30) / 10000 * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "displayName": "Budget Used",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 80},
                {"color": "red", "value": 100}
              ]
            }
          }
        }
      },
      {
        "id": 7,
        "title": "Cost Optimization Opportunities",
        "type": "table",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 14},
        "targets": [
          {
            "expr": "topk(10, greenlang_agents_cache_hit_rate < 0.7)",
            "format": "table",
            "instant": true,
            "refId": "A"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "renameByName": {
                "cache_type": "Cache Type",
                "Value": "Hit Rate",
                "__name__": "Metric",
                "job": "Service"
              }
            }
          },
          {
            "id": "calculateField",
            "options": {
              "mode": "binary",
              "reduce": {
                "reducer": "lastNotNull"
              },
              "binary": {
                "left": "Hit Rate",
                "operator": "*",
                "right": "100"
              },
              "alias": "Hit Rate %"
            }
          },
          {
            "id": "calculateField",
            "options": {
              "mode": "binary",
              "reduce": {
                "reducer": "lastNotNull"
              },
              "binary": {
                "left": "100",
                "operator": "-",
                "right": "Hit Rate %"
              },
              "alias": "Potential Savings %"
            }
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "displayMode": "color-background",
              "align": "center"
            },
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 15},
                {"color": "red", "value": 30}
              ]
            }
          }
        }
      },
      {
        "id": 8,
        "title": "Infrastructure Utilization",
        "type": "graph",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 22},
        "targets": [
          {
            "expr": "avg(greenlang_agents_cpu_utilization)",
            "legendFormat": "CPU %",
            "refId": "A"
          },
          {
            "expr": "avg(greenlang_agents_memory_usage_bytes) / avg(greenlang_agents_memory_usage_bytes > 0) * 100",
            "legendFormat": "Memory %",
            "refId": "B"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "custom": {
              "drawStyle": "line",
              "lineInterpolation": "smooth",
              "lineWidth": 2,
              "fillOpacity": 10,
              "gradientMode": "opacity"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 70},
                {"color": "red", "value": 90}
              ]
            }
          }
        }
      },
      {
        "id": 9,
        "title": "Cost per API Provider",
        "type": "bargauge",
        "datasource": "Prometheus",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 22},
        "targets": [
          {
            "expr": "sum(increase(greenlang_agents_api_calls[24h])) by (api) * 0.002",
            "legendFormat": "{{api}}",
            "refId": "A"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "valueMode": "color",
          "showUnfilled": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 50},
                {"color": "red", "value": 100}
              ]
            }
          }
        }
      },
      {
        "id": 10,
        "title": "Budget vs Actual (Monthly)",
        "type": "bargauge",
        "datasource": "Prometheus",
        "gridPos": {"h": 6, "w": 24, "x": 0, "y": 30},
        "targets": [
          {
            "expr": "sum(increase(greenlang_agents_api_calls[30d])) * 0.002 + sum(greenlang_agents_pod_count) * 0.05 * 24 * 30",
            "legendFormat": "Actual Spend",
            "refId": "A"
          }
        ],
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient",
          "valueMode": "color",
          "showUnfilled": true,
          "minVizWidth": 0,
          "minVizHeight": 30
        },
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "min": 0,
            "max": 10000,
            "displayName": "Monthly Spend vs $10,000 Budget",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 8000},
                {"color": "red", "value": 10000}
              ]
            }
          }
        }
      },
      {
        "id": 11,
        "title": "Cost Projections",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 0, "y": 36},
        "targets": [
          {
            "expr": "predict_linear(sum(increase(greenlang_agents_api_calls[1d]))[7d:1d], 30 * 86400) * 0.002",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "displayName": "30-Day Projection",
            "decimals": 0
          }
        }
      },
      {
        "id": 12,
        "title": "ROI Metrics",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 6, "y": 36},
        "targets": [
          {
            "expr": "sum(increase(greenlang_agents_reports_generated[30d])) * 50 / (sum(increase(greenlang_agents_api_calls[30d])) * 0.002 + sum(greenlang_agents_pod_count) * 0.05 * 24 * 30)",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percentunit",
            "displayName": "ROI",
            "decimals": 1,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "yellow", "value": 1},
                {"color": "green", "value": 2}
              ]
            }
          }
        }
      },
      {
        "id": 13,
        "title": "Savings from Optimization",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 12, "y": 36},
        "targets": [
          {
            "expr": "(1 - avg(greenlang_agents_cache_hit_rate)) * sum(increase(greenlang_agents_api_calls[30d])) * 0.002",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "currencyUSD",
            "displayName": "Potential Savings",
            "decimals": 0
          }
        }
      },
      {
        "id": 14,
        "title": "Cost Alerts",
        "type": "stat",
        "datasource": "Prometheus",
        "gridPos": {"h": 4, "w": 6, "x": 18, "y": 36},
        "targets": [
          {
            "expr": "count(ALERTS{alertname=~\".*Cost.*\", alertstate=\"firing\"})",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "displayName": "Active Cost Alerts",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "green", "value": null},
                {"color": "yellow", "value": 1},
                {"color": "red", "value": 3}
              ]
            }
          }
        }
      }
    ],
    "templating": {
      "list": [
        {
          "name": "budget",
          "type": "custom",
          "current": {
            "text": "10000",
            "value": "10000"
          },
          "options": [
            {"text": "5000", "value": "5000"},
            {"text": "10000", "value": "10000"},
            {"text": "20000", "value": "20000"},
            {"text": "50000", "value": "50000"}
          ]
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "datasource": "Prometheus",
          "enable": true,
          "expr": "increase(greenlang_agents_api_calls[1h]) * 0.002 > 100",
          "iconColor": "red",
          "name": "High Cost Events",
          "step": "1h"
        }
      ]
    },
    "schemaVersion": 38,
    "version": 1
  },
  "overwrite": true
}