{
  "dashboard": {
    "id": null,
    "uid": "gl008-trap-performance",
    "title": "GL-008 Steam Trap Inspection Performance",
    "tags": ["gl-008", "steam-traps", "performance", "inspections"],
    "timezone": "browser",
    "schemaVersion": 38,
    "version": 1,
    "refresh": "30s",
    "time": {
      "from": "now-24h",
      "to": "now"
    },
    "timepicker": {
      "refresh_intervals": ["10s", "30s", "1m", "5m", "15m", "30m", "1h"]
    },
    "templating": {
      "list": [
        {
          "name": "facility",
          "type": "query",
          "query": "label_values(gl008_inspections_total, facility)",
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "includeAll": true,
          "multi": true
        },
        {
          "name": "trap_type",
          "type": "query",
          "query": "label_values(gl008_inspections_total{facility=~\"$facility\"}, trap_type)",
          "current": {
            "text": "All",
            "value": "$__all"
          },
          "includeAll": true,
          "multi": true
        }
      ]
    },
    "annotations": {
      "list": [
        {
          "name": "System Deployments",
          "datasource": "Prometheus",
          "enable": true,
          "iconColor": "blue",
          "tags": ["deployment"]
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "Inspection Rate (Inspections/Hour)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum(rate(gl008_inspections_total{facility=~\"$facility\", trap_type=~\"$trap_type\"}[5m])) * 3600",
            "legendFormat": "Total Inspections/Hour",
            "refId": "A"
          },
          {
            "expr": "sum by (status) (rate(gl008_inspections_total{facility=~\"$facility\", trap_type=~\"$trap_type\"}[5m])) * 3600",
            "legendFormat": "{{status}}",
            "refId": "B"
          }
        ],
        "yaxes": [
          {
            "label": "Inspections/Hour",
            "format": "short"
          },
          {
            "format": "short",
            "show": false
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            }
          }
        }
      },
      {
        "id": 2,
        "title": "Inspection P95 Latency",
        "type": "graph",
        "gridPos": {"x": 12, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(gl008_inspection_latency_seconds_bucket{facility=~\"$facility\"}[5m])) by (le))",
            "legendFormat": "P95 Latency",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.50, sum(rate(gl008_inspection_latency_seconds_bucket{facility=~\"$facility\"}[5m])) by (le))",
            "legendFormat": "P50 Latency",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.99, sum(rate(gl008_inspection_latency_seconds_bucket{facility=~\"$facility\"}[5m])) by (le))",
            "legendFormat": "P99 Latency",
            "refId": "C"
          }
        ],
        "yaxes": [
          {
            "label": "Latency (seconds)",
            "format": "s"
          },
          {
            "format": "short",
            "show": false
          }
        ],
        "thresholds": [
          {
            "value": 3,
            "colorMode": "critical",
            "op": "gt",
            "fill": true,
            "line": true
          }
        ],
        "alert": {
          "name": "High Inspection Latency",
          "conditions": [
            {
              "evaluator": {
                "params": [3],
                "type": "gt"
              },
              "query": {
                "params": ["A", "5m", "now"]
              },
              "type": "query"
            }
          ],
          "frequency": "1m",
          "handler": 1,
          "message": "P95 inspection latency exceeds 3 seconds SLO"
        }
      },
      {
        "id": 3,
        "title": "Detection Accuracy Rate",
        "type": "gauge",
        "gridPos": {"x": 0, "y": 8, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "sum(gl008_true_positives_total{facility=~\"$facility\"}) / (sum(gl008_true_positives_total{facility=~\"$facility\"}) + sum(gl008_false_positives_total{facility=~\"$facility\"}) + sum(gl008_false_negatives_total{facility=~\"$facility\"})) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 90, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Precision (PPV)",
        "type": "gauge",
        "gridPos": {"x": 6, "y": 8, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "avg(gl008_detection_precision{facility=~\"$facility\"}) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 85, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 5,
        "title": "Recall (Sensitivity)",
        "type": "gauge",
        "gridPos": {"x": 12, "y": 8, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "avg(gl008_detection_recall{facility=~\"$facility\"}) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 85, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 6,
        "title": "F1 Score",
        "type": "gauge",
        "gridPos": {"x": 18, "y": 8, "w": 6, "h": 6},
        "targets": [
          {
            "expr": "avg(gl008_detection_f1_score{facility=~\"$facility\"}) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 85, "color": "yellow"},
                {"value": 90, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 7,
        "title": "Inspection Duration by Method (P95)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 14, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum by (method, le) (rate(gl008_inspection_duration_seconds_bucket{facility=~\"$facility\"}[5m])))",
            "legendFormat": "{{method}}",
            "refId": "A"
          }
        ],
        "yaxes": [
          {
            "label": "Duration (seconds)",
            "format": "s"
          },
          {
            "format": "short",
            "show": false
          }
        ]
      },
      {
        "id": 8,
        "title": "Inspections by Status (24h)",
        "type": "piechart",
        "gridPos": {"x": 12, "y": 14, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum by (status) (increase(gl008_inspections_total{facility=~\"$facility\"}[24h]))",
            "legendFormat": "{{status}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short"
          }
        }
      },
      {
        "id": 9,
        "title": "Analysis Time Breakdown (Avg)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 22, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "avg(rate(gl008_acoustic_analysis_seconds_sum{facility=~\"$facility\"}[5m]) / rate(gl008_acoustic_analysis_seconds_count{facility=~\"$facility\"}[5m]))",
            "legendFormat": "Acoustic Analysis",
            "refId": "A"
          },
          {
            "expr": "avg(rate(gl008_thermal_analysis_seconds_sum{facility=~\"$facility\"}[5m]) / rate(gl008_thermal_analysis_seconds_count{facility=~\"$facility\"}[5m]))",
            "legendFormat": "Thermal Analysis",
            "refId": "B"
          },
          {
            "expr": "avg(rate(gl008_ultrasonic_analysis_seconds_sum{facility=~\"$facility\"}[5m]) / rate(gl008_ultrasonic_analysis_seconds_count{facility=~\"$facility\"}[5m]))",
            "legendFormat": "Ultrasonic Analysis",
            "refId": "C"
          }
        ],
        "yaxes": [
          {
            "label": "Time (seconds)",
            "format": "s"
          },
          {
            "format": "short",
            "show": false
          }
        ]
      },
      {
        "id": 10,
        "title": "Inspection Errors Rate",
        "type": "graph",
        "gridPos": {"x": 12, "y": 22, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum(rate(gl008_inspection_errors_total{facility=~\"$facility\"}[5m])) * 3600",
            "legendFormat": "Total Errors/Hour",
            "refId": "A"
          },
          {
            "expr": "sum by (error_type) (rate(gl008_inspection_errors_total{facility=~\"$facility\"}[5m])) * 3600",
            "legendFormat": "{{error_type}}",
            "refId": "B"
          }
        ],
        "yaxes": [
          {
            "label": "Errors/Hour",
            "format": "short"
          },
          {
            "format": "short",
            "show": false
          }
        ]
      },
      {
        "id": 11,
        "title": "False Positive Rate",
        "type": "stat",
        "gridPos": {"x": 0, "y": 30, "w": 8, "h": 6},
        "targets": [
          {
            "expr": "sum(increase(gl008_false_positives_total{facility=~\"$facility\"}[24h])) / (sum(increase(gl008_true_positives_total{facility=~\"$facility\"}[24h])) + sum(increase(gl008_false_positives_total{facility=~\"$facility\"}[24h]))) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 5, "color": "yellow"},
                {"value": 10, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 12,
        "title": "False Negative Rate",
        "type": "stat",
        "gridPos": {"x": 8, "y": 30, "w": 8, "h": 6},
        "targets": [
          {
            "expr": "sum(increase(gl008_false_negatives_total{facility=~\"$facility\"}[24h])) / (sum(increase(gl008_true_positives_total{facility=~\"$facility\"}[24h])) + sum(increase(gl008_false_negatives_total{facility=~\"$facility\"}[24h]))) * 100",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 5, "color": "yellow"},
                {"value": 10, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 13,
        "title": "Detection Confidence Distribution",
        "type": "heatmap",
        "gridPos": {"x": 16, "y": 30, "w": 8, "h": 6},
        "targets": [
          {
            "expr": "gl008_detection_confidence{facility=~\"$facility\"}",
            "format": "time_series",
            "refId": "A"
          }
        ],
        "dataFormat": "timeseries",
        "yAxis": {
          "format": "short",
          "decimals": 2
        },
        "color": {
          "mode": "spectrum",
          "cardColor": "#b4ff00",
          "colorScale": "sqrt",
          "exponent": 0.5,
          "colorScheme": "interpolateRdYlGn"
        }
      },
      {
        "id": 14,
        "title": "Inspections by Trap Type (24h)",
        "type": "bargauge",
        "gridPos": {"x": 0, "y": 36, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum by (trap_type) (increase(gl008_inspections_total{facility=~\"$facility\"}[24h]))",
            "legendFormat": "{{trap_type}}",
            "refId": "A"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "unit": "short",
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"}
              ]
            }
          }
        },
        "options": {
          "orientation": "horizontal",
          "displayMode": "gradient"
        }
      },
      {
        "id": 15,
        "title": "System Health Status",
        "type": "stat",
        "gridPos": {"x": 12, "y": 36, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "gl008_system_health{component=\"inspection_engine\"}",
            "legendFormat": "Inspection Engine",
            "refId": "A"
          },
          {
            "expr": "gl008_system_health{component=\"sensor_interface\"}",
            "legendFormat": "Sensor Interface",
            "refId": "B"
          },
          {
            "expr": "gl008_system_health{component=\"database\"}",
            "legendFormat": "Database",
            "refId": "C"
          },
          {
            "expr": "gl008_system_health{component=\"api\"}",
            "legendFormat": "API",
            "refId": "D"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {"type": "value", "value": 0, "text": "Down"},
              {"type": "value", "value": 1, "text": "Healthy"}
            ],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 1, "color": "green"}
              ]
            }
          }
        },
        "options": {
          "orientation": "auto",
          "textMode": "value_and_name",
          "colorMode": "background"
        }
      }
    ]
  }
}
