# GL-008 SteamTrapInspector - External Secrets Operator Template
# Uses External Secrets Operator to sync secrets from AWS Secrets Manager

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: gl-008-secrets
  namespace: greenlang
  labels:
    app: gl-008-steam-trap-inspector
    agent: "GL-008"
  annotations:
    description: "External secrets for GL-008 SteamTrapInspector"
spec:
  # Refresh interval
  refreshInterval: 1h

  # Secret store reference
  secretStoreRef:
    name: aws-secrets-manager
    kind: SecretStore

  # Target secret
  target:
    name: gl-008-secrets
    creationPolicy: Owner

  # Data to fetch from secrets manager
  data:
    # Database credentials
    - secretKey: database_url
      remoteRef:
        key: greenlang/gl-008/database
        property: url

    - secretKey: database_user
      remoteRef:
        key: greenlang/gl-008/database
        property: username

    - secretKey: database_password
      remoteRef:
        key: greenlang/gl-008/database
        property: password

    # Redis credentials
    - secretKey: redis_url
      remoteRef:
        key: greenlang/gl-008/redis
        property: url

    # AI API keys
    - secretKey: anthropic_api_key
      remoteRef:
        key: greenlang/gl-008/ai
        property: anthropic_api_key

    # AWS credentials for S3 access
    - secretKey: aws_access_key_id
      remoteRef:
        key: greenlang/gl-008/aws
        property: access_key_id

    - secretKey: aws_secret_access_key
      remoteRef:
        key: greenlang/gl-008/aws
        property: secret_access_key

    # Alert integration keys
    - secretKey: slack_webhook_url
      remoteRef:
        key: greenlang/gl-008/alerting
        property: slack_webhook

    - secretKey: pagerduty_api_key
      remoteRef:
        key: greenlang/gl-008/alerting
        property: pagerduty_api_key

    # Email SMTP credentials
    - secretKey: smtp_password
      remoteRef:
        key: greenlang/gl-008/email
        property: smtp_password
