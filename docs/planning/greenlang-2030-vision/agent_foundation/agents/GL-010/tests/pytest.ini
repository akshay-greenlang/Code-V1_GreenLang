[pytest]
# ==============================================================================
# Pytest Configuration for GL-010 EMISSIONWATCH Test Suite
# ==============================================================================
#
# This configuration file defines test collection, execution, and reporting
# settings for the comprehensive GL-010 EmissionsComplianceAgent test suite.
#
# Test Categories:
#   - Unit Tests: 200+ tests covering all calculators, tools, and orchestrator
#   - Integration Tests: 50+ tests for CEMS, reporting, and pipeline integration
#   - E2E Tests: 12+ tests for complete workflow validation
#   - Determinism Tests: 15+ tests for reproducibility verification
#   - Performance Tests: 10+ tests for latency and throughput benchmarks
#
# Coverage Target: 90%+
# Author: GreenLang Foundation Test Engineering
# Version: 1.0.0
# ==============================================================================

# Test Discovery
testpaths =
    unit
    integration
    e2e
    determinism
    performance

python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Minimum Python version
minversion = 3.9

# Markers for test categorization
markers =
    # Test type markers
    unit: Unit tests for individual components
    integration: Integration tests for component interactions
    e2e: End-to-end workflow tests
    determinism: Reproducibility and determinism verification tests
    performance: Performance benchmark tests

    # Speed markers
    slow: Tests that take more than 5 seconds
    fast: Tests that complete in under 100ms

    # Functional area markers
    nox: NOx emission calculation tests
    sox: SOx emission calculation tests
    co2: CO2 emission calculation tests
    pm: Particulate matter calculation tests
    compliance: Compliance checking tests
    violation: Violation detection tests
    reporting: Regulatory reporting tests
    audit: Audit trail tests
    cems: CEMS integration tests

    # Regulatory framework markers
    epa: EPA (US) regulatory compliance tests
    eu_ied: EU Industrial Emissions Directive tests
    china_mee: China MEE standards tests
    multi_jurisdiction: Multi-jurisdiction compliance tests

    # Quality markers
    smoke: Critical path smoke tests
    regression: Regression tests
    boundary: Boundary condition tests
    edge_case: Edge case tests
    error_handling: Error handling tests

    # Infrastructure markers
    requires_cems: Tests requiring CEMS connection mock
    requires_database: Tests requiring database connection
    requires_api: Tests requiring external API mock

# Console output options
console_output_style = progress
addopts =
    -v
    --tb=short
    --strict-markers
    -ra

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = test_results.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Timeout settings (requires pytest-timeout plugin)
timeout = 60
timeout_method = thread

# Coverage configuration (requires pytest-cov plugin)
# Run with: pytest --cov=.. --cov-report=html
# Note: Coverage is measured against the parent GL-010 directory

# Parallel execution (requires pytest-xdist plugin)
# Run with: pytest -n auto

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    error::UserWarning

# Fixture scope defaults
usefixtures =

# Cache directory
cache_dir = .pytest_cache

# JUnit XML output for CI/CD integration
junit_family = xunit2
junit_suite_name = GL-010-EMISSIONWATCH-Tests

# HTML report (requires pytest-html plugin)
# Run with: pytest --html=report.html

# Benchmark options (requires pytest-benchmark plugin)
# Run with: pytest --benchmark-only
benchmark_disable_gc = true
benchmark_warmup = true
benchmark_min_rounds = 5

# Doctest options
doctest_optionflags = NORMALIZE_WHITESPACE IGNORE_EXCEPTION_DETAIL

# Random order (requires pytest-random-order plugin)
# Run with: pytest --random-order

# Required plugins for full functionality
required_plugins =
    pytest-cov
    pytest-mock
    pytest-asyncio

# asyncio mode for async tests
asyncio_mode = auto
