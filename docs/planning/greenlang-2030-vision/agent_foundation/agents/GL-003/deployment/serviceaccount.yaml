# GL-003 SteamSystemAnalyzer - Service Account and RBAC
# Kubernetes RBAC for pod-level permissions

apiVersion: v1
kind: ServiceAccount
metadata:
  name: gl-003-steam-system-analyzer
  namespace: greenlang
  labels:
    app: gl-003-steam-system-analyzer
    agent: "GL-003"
  annotations:
    description: "Service account for GL-003 SteamSystemAnalyzer"

---
# Role - Define permissions within the namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: gl-003-steam-system-analyzer-role
  namespace: greenlang
  labels:
    app: gl-003-steam-system-analyzer
    agent: "GL-003"

rules:
  # Read ConfigMaps
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]

  # Read Secrets
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list"]

  # Read pods (for service discovery)
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list"]

  # Create events (for logging)
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]

---
# RoleBinding - Bind role to service account
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: gl-003-steam-system-analyzer-rolebinding
  namespace: greenlang
  labels:
    app: gl-003-steam-system-analyzer
    agent: "GL-003"

subjects:
  - kind: ServiceAccount
    name: gl-003-steam-system-analyzer
    namespace: greenlang

roleRef:
  kind: Role
  name: gl-003-steam-system-analyzer-role
  apiGroup: rbac.authorization.k8s.io
