# ============================================================================
# GL-007 FURNACEPERFORMANCEMONITOR - PIPELINE DEFINITION
# ============================================================================
#
# GreenLang v1.0 Pipeline Specification
# Real-time furnace performance monitoring with zero-hallucination guarantees
#
# Version: 1.0
# Author: GreenLang Industrial Furnace Team
# Performance: <3000ms end-to-end execution (optimization mode)
#
# ============================================================================

name: furnace-performance-monitoring
version: 1
description: Real-time furnace monitoring, optimization, and predictive maintenance with ASME PTC 4.1 compliance

# ----------------------------------------------------------------------------
# PIPELINE STEPS
# ----------------------------------------------------------------------------

steps:
  # ==========================================================================
  # STEP 1: VALIDATE INPUT DATA
  # ==========================================================================

  - name: validate-furnace-data
    agent: furnace-performance-monitor
    action: validate_inputs
    description: Validate furnace identification, real-time sensor data, and operational request

    inputs:
      operation_mode: ${inputs.operation_mode}
      furnace_identification: ${inputs.furnace_identification}
      real_time_data: ${inputs.real_time_data}
      configuration: ${inputs.configuration}

    outputs:
      validation_status: validation_result
      validated_data: clean_data
      validation_errors: errors

    error_handling:
      on_validation_failure:
        action: abort
        message: "Invalid furnace data or sensor readings"
        notify: operations_team

    performance:
      max_execution_time: 100ms
      timeout: 200ms

  # ==========================================================================
  # STEP 2: CALCULATE THERMAL EFFICIENCY
  # ==========================================================================

  - name: calculate-thermal-efficiency
    agent: furnace-performance-monitor
    action: calculate_thermal_efficiency
    description: Calculate ASME PTC 4.1 compliant thermal efficiency with full loss breakdown

    inputs:
      furnace_data: ${steps.validate-furnace-data.outputs.validated_data}

    outputs:
      efficiency_metrics: thermal_efficiency_result
      loss_breakdown: efficiency_losses
      improvement_potential: optimization_opportunities

    performance:
      max_execution_time: 500ms
      timeout: 1000ms

    guarantees:
      deterministic: true
      zero_hallucination: true
      accuracy: 98.5%

  # ==========================================================================
  # STEP 3: ANALYZE FUEL CONSUMPTION
  # ==========================================================================

  - name: analyze-fuel-consumption
    agent: furnace-performance-monitor
    action: analyze_fuel_consumption
    description: Analyze fuel consumption patterns and identify deviations

    inputs:
      consumption_data: ${steps.validate-furnace-data.outputs.validated_data.consumption_history}
      baseline_performance: ${inputs.baseline_performance}
      cost_parameters: ${inputs.cost_parameters}

    outputs:
      fuel_analysis: consumption_analysis_result
      anomalies: consumption_anomalies
      opportunities: fuel_optimization_opportunities

    performance:
      max_execution_time: 300ms
      timeout: 600ms

  # ==========================================================================
  # STEP 4: DETECT PERFORMANCE ANOMALIES
  # ==========================================================================

  - name: detect-anomalies
    agent: furnace-performance-monitor
    action: detect_performance_anomalies
    description: Detect anomalies using statistical process control

    inputs:
      real_time_data: ${steps.validate-furnace-data.outputs.validated_data.real_time}
      efficiency_result: ${steps.calculate-thermal-efficiency.outputs.efficiency_metrics}

    outputs:
      anomalies: detected_anomalies
      alerts: critical_alerts

    performance:
      max_execution_time: 200ms
      timeout: 400ms

  # ==========================================================================
  # STEP 5: PREDICT MAINTENANCE NEEDS (Conditional)
  # ==========================================================================

  - name: predict-maintenance
    agent: furnace-performance-monitor
    action: predict_maintenance_needs
    description: Predict equipment maintenance requirements
    condition: ${inputs.operation_mode} == 'predict'

    inputs:
      condition_data: ${steps.validate-furnace-data.outputs.validated_data.condition_monitoring}

    outputs:
      maintenance_predictions: predictions
      maintenance_schedule: schedule

    performance:
      max_execution_time: 2000ms
      timeout: 5000ms

  # ==========================================================================
  # STEP 6: OPTIMIZE OPERATING PARAMETERS (Conditional)
  # ==========================================================================

  - name: optimize-parameters
    agent: furnace-performance-monitor
    action: optimize_operating_parameters
    description: Optimize furnace operating parameters
    condition: ${inputs.operation_mode} == 'optimize'

    inputs:
      current_state: ${steps.validate-furnace-data.outputs.validated_data.current_operating_point}
      objectives: ${inputs.optimization_parameters}

    outputs:
      optimal_setpoints: optimized_parameters
      expected_performance: performance_forecast

    performance:
      max_execution_time: 3000ms
      timeout: 5000ms

  # ==========================================================================
  # STEP 7: GENERATE PERFORMANCE DASHBOARD
  # ==========================================================================

  - name: generate-dashboard
    agent: furnace-performance-monitor
    action: generate_performance_dashboard
    description: Generate comprehensive performance dashboard with 20+ KPIs

    inputs:
      efficiency: ${steps.calculate-thermal-efficiency.outputs.efficiency_metrics}
      fuel_analysis: ${steps.analyze-fuel-consumption.outputs.fuel_analysis}
      anomalies: ${steps.detect-anomalies.outputs.anomalies}

    outputs:
      dashboard: kpi_dashboard
      recommendations: actionable_recommendations

    performance:
      max_execution_time: 500ms
      timeout: 1000ms

# ----------------------------------------------------------------------------
# OUTPUTS
# ----------------------------------------------------------------------------

outputs:
  - name: furnace_performance_result
    description: Comprehensive furnace performance monitoring result
    schema:
      furnace_status: ${steps.validate-furnace-data.outputs.validation_result}
      performance_metrics: ${steps.calculate-thermal-efficiency.outputs.efficiency_metrics}
      fuel_analysis: ${steps.analyze-fuel-consumption.outputs.fuel_analysis}
      anomalies_alerts: ${steps.detect-anomalies.outputs.alerts}
      maintenance_predictions: ${steps.predict-maintenance.outputs.predictions}
      optimization_recommendations: ${steps.optimize-parameters.outputs.optimal_setpoints}
      kpi_dashboard: ${steps.generate-dashboard.outputs.dashboard}

# ----------------------------------------------------------------------------
# PERFORMANCE GUARANTEES
# ----------------------------------------------------------------------------

performance:
  max_total_latency_ms: 10000
  max_cost_per_execution_usd: 0.50
  deterministic: true
  zero_hallucination: true

# ----------------------------------------------------------------------------
# MONITORING
# ----------------------------------------------------------------------------

monitoring:
  metrics:
    - name: "efficiency_calculation_latency"
      type: "histogram"
    - name: "anomalies_detected_total"
      type: "counter"
    - name: "fuel_cost_savings_usd"
      type: "gauge"

  alerts:
    - name: "efficiency_degradation"
      condition: "efficiency < baseline - 3%"
      severity: "high"
    - name: "critical_anomaly"
      condition: "anomaly.severity == 'critical'"
      severity: "critical"
