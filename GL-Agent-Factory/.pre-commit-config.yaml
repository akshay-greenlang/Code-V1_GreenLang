# GreenLang Agent Factory - Pre-commit Configuration
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files
# Update hooks: pre-commit autoupdate

repos:
  # =============================================================================
  # General File Checks
  # =============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Prevent giant files from being committed
      - id: check-added-large-files
        args: ['--maxkb=1000']

      # Check for files that would conflict on case-insensitive filesystems
      - id: check-case-conflict

      # Check for files with names that would conflict on Windows
      - id: check-illegal-windows-names

      # Check for merge conflict markers
      - id: check-merge-conflict

      # Check for debugger imports and py37+ breakpoint()
      - id: debug-statements

      # Detect private keys
      - id: detect-private-key

      # Ensure files end with a newline
      - id: end-of-file-fixer
        exclude: '\.json$'

      # Remove trailing whitespace
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]

      # Check YAML files for syntax errors
      - id: check-yaml
        args: [--unsafe]

      # Check JSON files for syntax errors
      - id: check-json

      # Check TOML files for syntax errors
      - id: check-toml

      # Sort requirements.txt files
      - id: requirements-txt-fixer

      # Check for symlinks that don't point anywhere
      - id: check-symlinks

      # Prevent adding new files to the repo root
      - id: no-commit-to-branch
        args: ['--branch', 'main', '--branch', 'master']

  # =============================================================================
  # Python Code Formatting
  # =============================================================================
  - repo: https://github.com/psf/black
    rev: 24.3.0
    hooks:
      - id: black
        language_version: python3.11
        args:
          - --line-length=100
          - --target-version=py311

  # =============================================================================
  # Import Sorting
  # =============================================================================
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args:
          - --profile=black
          - --line-length=100
          - --multi-line=3
          - --trailing-comma
          - --force-grid-wrap=0
          - --use-parentheses
          - --ensure-newline-before-comments

  # =============================================================================
  # Python Linting (Ruff - Fast Alternative to Flake8, Pylint)
  # =============================================================================
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.3.4
    hooks:
      # Run the linter
      - id: ruff
        args:
          - --fix
          - --exit-non-zero-on-fix
          - --line-length=100
          - --select=E,F,W,I,N,UP,YTT,ANN,ASYNC,S,BLE,FBT,B,A,COM,C4,DTZ,T10,DJ,EM,EXE,ISC,ICN,G,INP,PIE,T20,PYI,PT,Q,RSE,RET,SLF,SLOT,SIM,TID,TCH,ARG,PTH,ERA,PD,PGH,PL,TRY,FLY,NPY,PERF,FURB,LOG,RUF
          - --ignore=ANN101,ANN102,ANN401,S101,PLR0913,TRY003
        types_or: [python, pyi]

      # Run the formatter
      - id: ruff-format
        types_or: [python, pyi]

  # =============================================================================
  # Type Checking (MyPy)
  # =============================================================================
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.9.0
    hooks:
      - id: mypy
        args:
          - --ignore-missing-imports
          - --no-strict-optional
          - --warn-unused-ignores
          - --warn-redundant-casts
          - --disallow-untyped-defs
          - --check-untyped-defs
        additional_dependencies:
          - types-requests
          - types-PyYAML
          - types-python-dateutil
          - pydantic>=2.0

  # =============================================================================
  # Security Scanning (Bandit)
  # =============================================================================
  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.8
    hooks:
      - id: bandit
        args:
          - -c=pyproject.toml
          - --recursive
          - --severity-level=medium
        additional_dependencies: ['bandit[toml]']
        exclude: tests/

  # =============================================================================
  # Secrets Detection
  # =============================================================================
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.4.0
    hooks:
      - id: detect-secrets
        args:
          - --baseline=.secrets.baseline
        exclude: package-lock\.json|\.secrets\.baseline

  # =============================================================================
  # Documentation Checks
  # =============================================================================
  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        args:
          - --convention=google
          - --add-ignore=D100,D104,D107,D203,D212,D213,D406,D407,D413
        exclude: tests/|migrations/

  # =============================================================================
  # Markdown Linting
  # =============================================================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.39.0
    hooks:
      - id: markdownlint
        args:
          - --disable=MD013  # Line length
          - --disable=MD033  # Inline HTML
          - --disable=MD041  # First line heading

  # =============================================================================
  # YAML Linting
  # =============================================================================
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        args:
          - -d={extends: relaxed, rules: {line-length: {max: 150}}}

  # =============================================================================
  # Shell Script Linting
  # =============================================================================
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        args: [--severity=warning]

  # =============================================================================
  # Dockerfile Linting
  # =============================================================================
  - repo: https://github.com/hadolint/hadolint
    rev: v2.12.0
    hooks:
      - id: hadolint-docker
        args:
          - --ignore=DL3008  # Pin versions in apt-get
          - --ignore=DL3013  # Pin versions in pip

  # =============================================================================
  # Commit Message Linting
  # =============================================================================
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v3.21.3
    hooks:
      - id: commitizen
        stages: [commit-msg]

  # =============================================================================
  # Python Upgrade Syntax
  # =============================================================================
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.15.2
    hooks:
      - id: pyupgrade
        args:
          - --py311-plus

  # =============================================================================
  # Dead Code Detection
  # =============================================================================
  - repo: https://github.com/jendrikseipp/vulture
    rev: v2.11
    hooks:
      - id: vulture
        args:
          - --min-confidence=80
        exclude: tests/

  # =============================================================================
  # Dependency Safety Check
  # =============================================================================
  - repo: https://github.com/pyupio/safety
    rev: 3.0.1
    hooks:
      - id: safety
        args:
          - --full-report
        files: requirements.*\.txt$

# =============================================================================
# CI Skip Configuration
# =============================================================================
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from pre-commit hooks

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_branch: ''
  autoupdate_commit_msg: '[pre-commit.ci] pre-commit autoupdate'
  autoupdate_schedule: weekly
  skip: [mypy, safety]  # Skip slow hooks in CI
  submodules: false

# =============================================================================
# Default Language Version
# =============================================================================
default_language_version:
  python: python3.11

# =============================================================================
# Exclude Patterns
# =============================================================================
exclude: |
  (?x)^(
    \.git/|
    \.venv/|
    venv/|
    \.env/|
    env/|
    node_modules/|
    __pycache__/|
    \.mypy_cache/|
    \.pytest_cache/|
    \.ruff_cache/|
    dist/|
    build/|
    \.eggs/|
    .*\.egg-info/|
    migrations/|
    \.terraform/|
    vendor/
  )
