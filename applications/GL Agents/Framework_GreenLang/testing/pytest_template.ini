# =============================================================================
# GreenLang Framework - Pytest Configuration Template
# =============================================================================
#
# Standard pytest configuration for GreenLang agents.
# Copy this file as pytest.ini to your agent's root directory and customize.
#
# Target Coverage: 85%+
# Author: GreenLang QA Team
# Version: 1.0.0
#
# =============================================================================

[pytest]
# =============================================================================
# Test Discovery
# =============================================================================

# Directories to search for tests
testpaths = tests

# Python files that contain tests
python_files =
    test_*.py
    *_test.py

# Python classes that contain tests
python_classes = Test*

# Python functions that are tests
python_functions = test_*


# =============================================================================
# Test Execution
# =============================================================================

# Default command line options
# -v: verbose output
# -ra: show extra test summary for all except passed
# --tb=short: shorter traceback format
# --strict-markers: treat unknown markers as errors
addopts =
    -v
    -ra
    --tb=short
    --strict-markers
    --showlocals
    --durations=10
    --color=yes

# Minimum pytest version required
minversion = 7.0

# Ignore deprecation warnings from dependencies
filterwarnings =
    ignore::DeprecationWarning:hypothesis.*:
    ignore::PendingDeprecationWarning

# Console output settings
console_output_style = progress

# Fail if no tests are collected (useful for CI)
# Uncomment in CI configuration:
# --strict-markers
# --fail-on


# =============================================================================
# Test Markers
# =============================================================================

markers =
    # Test categories
    unit: Unit tests (fast, isolated, no external dependencies)
    integration: Integration tests (may require external services)
    simulation: Simulation tests (digital twin, process modeling)
    performance: Performance tests (timing, throughput, memory)
    safety: Safety tests (boundaries, alarms, interlocks)
    determinism: Determinism tests (reproducibility, provenance)
    acceptance: Acceptance tests (SLA verification, workflows)
    golden: Golden value tests (NIST/IAPWS/EPA reference data)

    # Execution characteristics
    slow: Slow-running tests (>1 second)
    very_slow: Very slow tests (>10 seconds)
    flaky: Tests that may fail intermittently

    # Dependency markers
    requires_opcua: Tests requiring OPC-UA connection
    requires_kafka: Tests requiring Apache Kafka
    requires_database: Tests requiring database connection
    requires_redis: Tests requiring Redis connection
    requires_network: Tests requiring network access
    requires_hardware: Tests requiring physical hardware

    # Agent-specific markers
    gl001: GL-001 ThermalCommand tests
    gl002: GL-002 tests
    gl003: GL-003 tests
    gl004: GL-004 tests
    gl005: GL-005 tests
    gl006: GL-006 tests
    gl007: GL-007 tests
    gl008: GL-008 tests
    gl009: GL-009 tests
    gl010: GL-010 tests
    gl011: GL-011 tests
    gl012: GL-012 tests
    gl013: GL-013 tests
    gl014: GL-014 tests
    gl015: GL-015 tests
    gl016: GL-016 tests

    # Feature markers
    provenance: Provenance tracking tests
    api: API endpoint tests
    streaming: Streaming/real-time tests
    optimization: Optimization algorithm tests
    explainability: Explainability/audit tests


# =============================================================================
# Async Testing
# =============================================================================

# pytest-asyncio configuration
asyncio_mode = auto


# =============================================================================
# Logging
# =============================================================================

log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s (%(filename)s:%(lineno)s): %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S


# =============================================================================
# Coverage Configuration (pytest-cov)
# =============================================================================

# Note: These settings are for the [tool.coverage] section in pyproject.toml
# or coverage configuration in .coveragerc
# Pytest-cov is invoked with: pytest --cov=<package> --cov-report=...


# =============================================================================
# Timeout Configuration (pytest-timeout)
# =============================================================================

# Default timeout for all tests (seconds)
timeout = 30

# Timeout method: signal, thread, or auto
timeout_method = thread


# =============================================================================
# Parallel Execution (pytest-xdist)
# =============================================================================

# Run tests in parallel with: pytest -n auto
# Configuration for parallel execution when using pytest-xdist


# =============================================================================
# Environment Variables
# =============================================================================

# Set environment variables for tests
# Uses pytest-env plugin
env =
    GREENLANG_ENV=test
    GREENLANG_LOG_LEVEL=DEBUG
    GREENLANG_PROVENANCE_ENABLED=true


# =============================================================================
# Cache Configuration
# =============================================================================

# Cache directory for pytest
cache_dir = .pytest_cache


# =============================================================================
# Doctest Configuration
# =============================================================================

# Enable doctest collection from modules
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS


# =============================================================================
# JUnit XML Report (for CI/CD)
# =============================================================================

# Generate JUnit XML report with: pytest --junitxml=report.xml
junit_family = xunit2
junit_suite_name = GreenLang Agent Tests


# =============================================================================
# Notes for CI/CD Integration
# =============================================================================
#
# GitHub Actions example:
# ----------------------
# - name: Run tests
#   run: |
#     pytest tests/ \
#       --cov=src \
#       --cov-report=xml \
#       --cov-report=html \
#       --cov-fail-under=85 \
#       --junitxml=junit.xml \
#       -n auto
#
# GitLab CI example:
# -----------------
# test:
#   script:
#     - pytest tests/ --cov --cov-report=xml --junitxml=report.xml
#   coverage: '/TOTAL.*\s+(\d+%)/'
#   artifacts:
#     reports:
#       junit: report.xml
#       coverage_report:
#         coverage_format: cobertura
#         path: coverage.xml
#
# =============================================================================
