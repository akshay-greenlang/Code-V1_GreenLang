# ============================================================================
# GL-CBAM-APP - Production Environment Configuration
# ============================================================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control!
#
# Usage:
#   cp .env.production.example .env
#   # Edit .env with your actual values
#   docker-compose --env-file .env up -d
# ============================================================================

# ----------------------------------------------------------------------------
# APPLICATION SETTINGS
# ----------------------------------------------------------------------------

# Environment (development, staging, production)
APP_ENV=production

# Application version
APP_VERSION=1.0.0

# Build date (auto-set by CI/CD)
BUILD_DATE=

# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# API CONFIGURATION
# ----------------------------------------------------------------------------

# API port (exposed on host)
API_PORT=8000

# API title and description
API_TITLE=GL-CBAM-APP API
API_DESCRIPTION=GreenLang CBAM Importer Copilot - Backend API
API_VERSION=1.0.0

# API documentation
ENABLE_API_DOCS=true
ENABLE_REDOC=true

# ----------------------------------------------------------------------------
# DATABASE CONFIGURATION (PostgreSQL)
# ----------------------------------------------------------------------------

# PostgreSQL connection
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=cbam_user
POSTGRES_PASSWORD=CHANGE_ME_SECURE_PASSWORD_MIN_16_CHARS
POSTGRES_DB=cbam_db

# Database URL (auto-constructed from above)
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}

# Connection pool settings
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_ECHO=false

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION
# ----------------------------------------------------------------------------

# Redis connection
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
REDIS_DB=0

# Redis URL (auto-constructed from above)
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# Redis settings
REDIS_MAX_CONNECTIONS=50
REDIS_DECODE_RESPONSES=true

# Cache TTL (seconds)
CACHE_TTL_SHORT=300        # 5 minutes
CACHE_TTL_MEDIUM=3600      # 1 hour
CACHE_TTL_LONG=86400       # 24 hours

# ----------------------------------------------------------------------------
# SECURITY SETTINGS
# ----------------------------------------------------------------------------

# Secret key for session encryption, CSRF, etc.
# Generate with: openssl rand -base64 32
SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_32_CHAR_SECRET_KEY

# JWT settings
JWT_SECRET_KEY=CHANGE_ME_GENERATE_RANDOM_32_CHAR_JWT_SECRET
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Password hashing
PASSWORD_HASH_SCHEMES=bcrypt
PASSWORD_MIN_LENGTH=12

# API rate limiting
ENABLE_RATE_LIMITING=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------

# Allowed origins (comma-separated)
CORS_ORIGINS=https://cbam.greenlang.com,https://app.greenlang.com
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOW_HEADERS=Content-Type,Authorization,X-Requested-With
CORS_MAX_AGE=86400

# ----------------------------------------------------------------------------
# FILE UPLOAD SETTINGS
# ----------------------------------------------------------------------------

# Maximum upload size (MB)
MAX_UPLOAD_SIZE_MB=100

# Upload directory (inside container)
UPLOAD_DIR=/app/uploads

# Allowed file extensions
ALLOWED_UPLOAD_EXTENSIONS=.csv,.xlsx,.json,.yaml,.yml

# File processing timeout (seconds)
FILE_PROCESSING_TIMEOUT=300

# ----------------------------------------------------------------------------
# CBAM SPECIFIC SETTINGS
# ----------------------------------------------------------------------------

# Default reporting quarter
DEFAULT_QUARTER=Q4-2024

# EU CBAM Transitional Registry URL
CBAM_REGISTRY_URL=https://cbam-registry.ec.europa.eu

# Default emission factors path
EMISSION_FACTORS_PATH=/app/data/emission_factors.json

# CN codes path
CN_CODES_PATH=/app/data/cn_codes.json

# CBAM rules path
CBAM_RULES_PATH=/app/rules/cbam_rules.yaml

# Suppliers path
SUPPLIERS_PATH=/app/examples/demo_suppliers.yaml

# ----------------------------------------------------------------------------
# PERFORMANCE SETTINGS
# ----------------------------------------------------------------------------

# Worker processes (auto-detect: 0, manual: 1-8)
WORKER_PROCESSES=4

# Worker timeout (seconds)
WORKER_TIMEOUT=120

# Keep-alive (seconds)
KEEP_ALIVE=5

# Max requests per worker before restart
MAX_REQUESTS=1000
MAX_REQUESTS_JITTER=100

# ----------------------------------------------------------------------------
# MONITORING & OBSERVABILITY
# ----------------------------------------------------------------------------

# Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# Tracing (OpenTelemetry)
ENABLE_TRACING=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_SERVICE_NAME=gl-cbam-api

# Health checks
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PATH=/health

# ----------------------------------------------------------------------------
# LOGGING CONFIGURATION
# ----------------------------------------------------------------------------

# Log format (json or text)
LOG_FORMAT=json

# Log output (console, file, or both)
LOG_OUTPUT=both

# Log file path
LOG_FILE_PATH=/app/logs/app.log

# Log rotation
LOG_MAX_BYTES=10485760  # 10MB
LOG_BACKUP_COUNT=5

# Structured logging
ENABLE_STRUCTURED_LOGGING=true

# ----------------------------------------------------------------------------
# EXTERNAL SERVICES
# ----------------------------------------------------------------------------

# Email (SMTP)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=cbam@greenlang.com
SMTP_PASSWORD=CHANGE_ME_SMTP_PASSWORD
SMTP_FROM_EMAIL=cbam@greenlang.com
SMTP_FROM_NAME=GreenLang CBAM

# AWS (if using S3 for file storage)
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=us-east-1
AWS_S3_BUCKET=gl-cbam-uploads

# Sentry (error tracking)
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# ----------------------------------------------------------------------------
# PGADMIN CONFIGURATION (Optional)
# ----------------------------------------------------------------------------

# pgAdmin web interface
PGADMIN_PORT=5050
PGADMIN_EMAIL=admin@greenlang.com
PGADMIN_PASSWORD=CHANGE_ME_PGADMIN_PASSWORD

# ----------------------------------------------------------------------------
# FEATURE FLAGS
# ----------------------------------------------------------------------------

# Enable/disable features
ENABLE_API_DOCS=true
ENABLE_METRICS=true
ENABLE_TRACING=false
ENABLE_CACHING=true
ENABLE_RATE_LIMITING=true
ENABLE_BACKGROUND_TASKS=true

# Experimental features
ENABLE_EXPERIMENTAL_FEATURES=false

# ----------------------------------------------------------------------------
# BACKUP & DISASTER RECOVERY
# ----------------------------------------------------------------------------

# Database backup
ENABLE_DB_BACKUP=true
DB_BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM
DB_BACKUP_RETENTION_DAYS=30

# Backup storage
BACKUP_S3_BUCKET=gl-cbam-backups
BACKUP_S3_PREFIX=database/

# ----------------------------------------------------------------------------
# TIMEZONE & LOCALIZATION
# ----------------------------------------------------------------------------

# Timezone
TZ=UTC

# Locale
LOCALE=en_US.UTF-8

# ----------------------------------------------------------------------------
# DEVELOPMENT/DEBUG SETTINGS (Disable in production!)
# ----------------------------------------------------------------------------

# Debug mode (NEVER enable in production!)
DEBUG=false

# SQL query logging (performance impact!)
SQL_DEBUG=false

# Profiling
ENABLE_PROFILING=false

# Hot reload (development only)
RELOAD=false

# ============================================================================
# SECURITY CHECKLIST
# ============================================================================
#
# ✅ Change all passwords and secret keys
# ✅ Use strong, randomly generated secrets (min 32 characters)
# ✅ Never commit .env to version control (.gitignore)
# ✅ Rotate secrets regularly
# ✅ Use environment-specific configs (dev, staging, prod)
# ✅ Enable rate limiting and CORS in production
# ✅ Disable debug mode in production
# ✅ Use HTTPS/TLS for all external connections
# ✅ Restrict database access to application only
# ✅ Enable monitoring and alerting
# ✅ Regular backups and disaster recovery plan
#
# Generate secure secrets:
#   openssl rand -base64 32
#   python -c "import secrets; print(secrets.token_urlsafe(32))"
#
# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================
#
# Before deploying to production:
#
# 1. Configuration
#    ✅ Copy .env.production.example to .env
#    ✅ Update all CHANGE_ME values
#    ✅ Verify DATABASE_URL is correct
#    ✅ Verify REDIS_URL is correct
#
# 2. Security
#    ✅ Generate strong SECRET_KEY
#    ✅ Generate strong JWT_SECRET_KEY
#    ✅ Set strong database password
#    ✅ Configure CORS_ORIGINS
#    ✅ Enable rate limiting
#
# 3. Infrastructure
#    ✅ PostgreSQL is running and accessible
#    ✅ Redis is running and accessible
#    ✅ Storage volumes are configured
#    ✅ Backups are enabled
#
# 4. Monitoring
#    ✅ Configure Sentry for error tracking
#    ✅ Enable metrics collection
#    ✅ Set up log aggregation
#    ✅ Configure health checks
#
# 5. Testing
#    ✅ Run database migrations
#    ✅ Test API endpoints
#    ✅ Verify file uploads work
#    ✅ Test CBAM pipeline end-to-end
#
# ============================================================================
