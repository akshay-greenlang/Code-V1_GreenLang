[pytest]
# ============================================================================
# GL-CBAM-APP - Master Pytest Configuration
# ============================================================================
#
# Purpose: Execute all 320+ tests across both CBAM-Importer-Copilot and
#          CBAM-Refactored with comprehensive coverage reporting
#
# Usage:
#   pytest                              # Run all tests
#   pytest -m unit                      # Run only unit tests
#   pytest -m integration               # Run only integration tests
#   pytest -m performance               # Run only performance tests
#   pytest --cov                        # Run with coverage
#   pytest -k test_zero_hallucination   # Run specific test pattern
#
# Version: 1.0.0
# ============================================================================

# ----------------------------------------------------------------------------
# Test Discovery
# ----------------------------------------------------------------------------
testpaths =
    CBAM-Importer-Copilot/tests
    CBAM-Refactored/tests

python_files = test_*.py
python_classes = Test*
python_functions = test_*

# ----------------------------------------------------------------------------
# Output Options
# ----------------------------------------------------------------------------
addopts =
    -v
    --tb=short
    --strict-markers
    -ra
    --color=yes
    --maxfail=5
    --durations=10

# Disable warnings for cleaner output
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# ----------------------------------------------------------------------------
# Coverage Configuration (for pytest-cov)
# ----------------------------------------------------------------------------
# Enable with: pytest --cov
[coverage:run]
source =
    CBAM-Importer-Copilot/agents
    CBAM-Importer-Copilot/cli
    CBAM-Importer-Copilot/sdk
    CBAM-Importer-Copilot/provenance
    CBAM-Refactored/agents

branch = True
omit =
    */tests/*
    */test_*
    */__pycache__/*
    */conftest.py
    */examples/*
    */scripts/*
    */docs/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False
sort = Cover

# Exclude common patterns from coverage
exclude_lines =
    pragma: no cover
    def __repr__
    def __str__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod
    @overload
    pass

[coverage:html]
directory = htmlcov
title = GL-CBAM Test Coverage Report

# ----------------------------------------------------------------------------
# Test Markers
# ----------------------------------------------------------------------------
markers =
    unit: Unit tests (fast, isolated, no external dependencies)
    integration: Integration tests (test multiple components together)
    performance: Performance and benchmark tests
    compliance: CBAM compliance tests (CRITICAL - zero hallucination)
    security: Security-related tests
    slow: Slow-running tests (skip with -m 'not slow')
    smoke: Smoke tests (quick validation that basics work)
    e2e: End-to-end tests (full pipeline validation)

# ----------------------------------------------------------------------------
# Pytest Plugins
# ----------------------------------------------------------------------------
# Required plugins (install via requirements-test.txt):
#   - pytest-cov: Code coverage reporting
#   - pytest-benchmark: Performance benchmarking
#   - pytest-html: HTML test reports
#   - pytest-xdist: Parallel test execution

# ----------------------------------------------------------------------------
# Performance Settings
# ----------------------------------------------------------------------------
# Timeout for individual tests (prevent hanging)
timeout = 300

# Console output mode
console_output_style = progress

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = test-execution.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ----------------------------------------------------------------------------
# JUnit XML (for CI/CD integration)
# ----------------------------------------------------------------------------
junit_family = xunit2
junit_suite_name = GL-CBAM-APP Test Suite

# ----------------------------------------------------------------------------
# Notes
# ----------------------------------------------------------------------------
# Expected Test Count: 320+ tests
# Target Coverage: 80%+
# Critical Tests: Zero hallucination guarantee tests
# Performance Target: 20Ã— speedup vs traditional methods
#
# Run all tests with coverage:
#   pytest --cov --cov-report=html --cov-report=term
#
# Generate HTML report:
#   pytest --html=test-report.html --self-contained-html
#
# Parallel execution (faster):
#   pytest -n auto
#
# ============================================================================
