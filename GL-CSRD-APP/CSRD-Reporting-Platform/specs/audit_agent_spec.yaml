# ============================================================================
# AGENT SPECIFICATION: COMPLIANCE AUDIT & VALIDATION AGENT
# AgentSpec V2.0 Compliant
# ============================================================================

# ----------------------------------------------------------------------------
# SECTION 1: AGENT METADATA
# ----------------------------------------------------------------------------
agent_metadata:
  agent_id: "csrd_audit_agent"
  agent_name: "AuditAgent"
  display_name: "Compliance Audit & Validation Agent"
  version: "1.1.0"
  domain: "CSRD/ESG Reporting"
  subdomain: "Compliance Validation & Audit"
  agent_type: "validator"
  complexity: "high"
  priority: "critical"
  status: "production"
  deterministic: true
  llm_usage: false
  zero_hallucination: true

# ----------------------------------------------------------------------------
# SECTION 2: DESCRIPTION
# ----------------------------------------------------------------------------
description:
  purpose: |
    Validate CSRD report against all ESRS compliance requirements and generate
    external auditor package.

  strategic_context:
    global_impact: "Ensures audit-ready CSRD reports for regulatory compliance"
    opportunity: "Reduce audit preparation time by 80% with automated compliance checking"
    market_size: "CSRD audit services market estimated at €1B annually"
    technology_maturity: "TRL 8 (System complete and qualified)"

  capabilities:
    - "Execute 200+ ESRS compliance rule checks"
    - "Cross-reference validation"
    - "Calculation verification"
    - "Data lineage documentation"
    - "External auditor package generation"
    - "Compliance gap identification"

  key_features:
    - "<3 min for full validation of complete report"
    - "200+ compliance rules executed deterministically"
    - "100% deterministic checking - zero AI/LLM"
    - "Complete audit trail generation"
    - "Audit-ready package export"

  dependencies:
    - agent_id: "reporting_agent"
      relationship: "receives_data_from"
      data: "csrd_report_package"
    - agent_id: "calculator_agent"
      relationship: "receives_data_from"
      data: "calculation_audit_trail"

# ----------------------------------------------------------------------------
# INPUTS
# ----------------------------------------------------------------------------
inputs:
  primary_inputs:
    - name: "csrd_report_package"
      type: "zip"
      required: true
      source: "Output from ReportingAgent"

    - name: "calculation_audit_trail"
      type: "json"
      required: true
      source: "Output from CalculatorAgent"

  reference_data:
    - name: "esrs_compliance_rules"
      path: "rules/esrs_compliance_rules.yaml"
      description: "200+ ESRS compliance rules"
      required: true

# ----------------------------------------------------------------------------
# OUTPUTS
# ----------------------------------------------------------------------------
outputs:
  - name: "compliance_report"
    format: "json"
    description: "ESRS compliance validation results"
    structure:
      compliance_status: "PASS / FAIL / WARNING"
      total_rules_checked: "integer"
      rules_passed: "integer"
      rules_failed: "integer"
      errors: "array"
      warnings: "array"
      recommendations: "array"

  - name: "audit_package"
    format: "zip"
    description: "External auditor package"
    contents:
      - "audit_trail.json"
      - "calculation_documentation.pdf"
      - "source_data_references.json"
      - "compliance_checklist.pdf"

  - name: "quality_score"
    format: "json"
    description: "Overall data quality assessment"

# ----------------------------------------------------------------------------
# SECTION 3: TOOLS
# ----------------------------------------------------------------------------
tools:
  tools_list:
    - tool_id: "compliance_validator"
      name: "compliance-validator"
      deterministic: true
      category: "validation"
      description: "Execute ESRS compliance rules"

      parameters:
        type: "object"
        properties:
          report_data: {type: "object", description: "CSRD report data"}
          rules: {type: "array", description: "Compliance rules to check"}
        required: ["report_data", "rules"]

      returns:
        type: "object"
        properties:
          passed: {type: "number", description: "Rules passed"}
          failed: {type: "number", description: "Rules failed"}
          errors: {type: "array", description: "Error details"}

      implementation:
        method: "Rule engine execution"
        rules_file: "rules/esrs_compliance_rules.yaml"
        calculation_method: "Boolean rule evaluation"
        accuracy: "100% deterministic"
        validation: "Tested against ESRS requirements"
        standards: ["ESRS Set 1", "CSRD Directive"]

    - tool_id: "cross_reference_checker"
      name: "cross-reference-checker"
      deterministic: true
      category: "validation"
      description: "Validate cross-references in report"

      parameters:
        type: "object"
        properties:
          report_data: {type: "object", description: "Report data"}
        required: ["report_data"]

      returns:
        type: "object"
        properties:
          valid_refs: {type: "number", description: "Valid references"}
          broken_refs: {type: "array", description: "Broken references"}

      implementation:
        method: "Graph traversal validation"
        calculation_method: "Reference integrity checking"
        accuracy: "100% deterministic"
        validation: "Tested with known reference patterns"
        standards: ["ESRS Cross-Reference Requirements"]

    - tool_id: "calculation_verifier"
      name: "calculation-verifier"
      deterministic: true
      category: "validation"
      description: "Re-verify all calculations"

      parameters:
        type: "object"
        properties:
          original_results: {type: "object", description: "Original calculations"}
          audit_trail: {type: "object", description: "Calculation audit trail"}
        required: ["original_results", "audit_trail"]

      returns:
        type: "object"
        properties:
          verified: {type: "boolean", description: "All calculations match"}
          mismatches: {type: "array", description: "Any discrepancies"}

      implementation:
        method: "Re-execution and comparison"
        calculation_method: "Exact formula re-execution"
        accuracy: "100% deterministic"
        validation: "Bit-perfect reproducibility check"
        standards: ["GHG Protocol", "ESRS Calculation Requirements"]

    - tool_id: "lineage_documenter"
      name: "lineage-documenter"
      deterministic: true
      category: "documentation"
      description: "Generate complete data lineage"

      parameters:
        type: "object"
        properties:
          report_data: {type: "object", description: "Report data"}
          audit_trail: {type: "object", description: "Audit trail"}
        required: ["report_data", "audit_trail"]

      returns:
        type: "object"
        properties:
          lineage_graph: {type: "object", description: "Data flow graph"}
          documentation: {type: "string", description: "Lineage documentation"}

      implementation:
        method: "Graph generation and documentation"
        calculation_method: "Data provenance tracking"
        accuracy: "100% deterministic"
        validation: "Complete lineage verification"
        standards: ["Data Governance Best Practices"]

# ----------------------------------------------------------------------------
# SECTION 4: AI INTEGRATION
# ----------------------------------------------------------------------------
ai_integration:
  enabled: false
  model: "N/A - Deterministic validator agent"
  temperature: 0.0
  seed: 42
  provenance_tracking: true
  tool_choice: "N/A"
  max_iterations: 0
  budget_usd: 0.0
  rationale: "This is a deterministic compliance validation agent with ZERO AI/LLM usage"
  zero_hallucination_guarantee: true

# ----------------------------------------------------------------------------
# SECTION 5: SUB-AGENTS
# ----------------------------------------------------------------------------
sub_agents:
  enabled: false
  coordination_pattern: "N/A"
  sub_agent_list: []
  rationale: "This is a leaf-level agent with no sub-agents"

# ----------------------------------------------------------------------------
# PROCESSING WORKFLOW
# ----------------------------------------------------------------------------
processing_workflow:
  step_1_load_rules:
    name: "Load Compliance Rules"
    source: "rules/esrs_compliance_rules.yaml"
    count: "200+ rules"

  step_2_execute_rules:
    name: "Execute All Validation Rules"
    method: "Deterministic rule engine"
    process: |
      FOR each rule in compliance_rules:
        result = evaluate_rule(rule, report_data)
        record_result(rule_id, result, severity)

  step_3_cross_reference_validation:
    name: "Validate Cross-References"
    checks:
      - "Materiality → Disclosed standards"
      - "Calculations → Source data"
      - "XBRL tags → Metric values"

  step_4_calculation_verification:
    name: "Re-Verify All Calculations"
    method: "Re-run calculator formulas"
    check: "Results match original calculations"

  step_5_lineage_documentation:
    name: "Generate Data Lineage"
    output: "Complete data flow from source to report"

  step_6_auditor_package_generation:
    name: "Create Auditor Package"
    contents:
      - "Complete audit trail"
      - "Calculation documentation"
      - "Source references"
      - "Compliance checklist"

# ----------------------------------------------------------------------------
# SECTION 6: TESTING
# ----------------------------------------------------------------------------
testing:
  test_coverage_target: 0.80

  test_categories:
    - category: "unit_tests"
      description: "Test individual validation rules"
      count: 50
      examples:
        - "test_compliance_rule_execution"
        - "test_cross_reference_validation"
        - "test_calculation_verification"

    - category: "integration_tests"
      description: "Test full audit workflows"
      count: 10
      examples:
        - "test_complete_audit_workflow"
        - "test_auditor_package_generation"

    - category: "determinism_tests"
      description: "Verify reproducibility"
      count: 5
      examples:
        - "test_same_input_same_output_100_runs"
        - "test_rule_execution_deterministic"

    - category: "boundary_tests"
      description: "Test edge cases"
      count: 15
      examples:
        - "test_missing_data_handling"
        - "test_invalid_report_structure"
        - "test_calculation_mismatch_detection"

  performance_requirements:
    max_latency_ms: 180000  # 3 minutes
    max_cost_usd: 0.0
    accuracy_target: 1.0
    rules_per_second: "100+"

# ----------------------------------------------------------------------------
# SECTION 7: DEPLOYMENT
# ----------------------------------------------------------------------------
deployment:
  pack_id: "csrd/audit_agent"
  pack_version: "1.1.0"

  resource_requirements:
    memory_mb: 1024
    cpu_cores: 2
    gpu_required: false
    storage_mb: 500

  dependencies:
    python_packages:
      - "pydantic>=2.0,<3.0"
      - "pyyaml>=6.0,<7.0"
      - "pandas>=2.0,<3.0"

    greenlang_modules:
      - "greenlang.agents.base"
      - "greenlang.core.validation"

  api_endpoints:
    - endpoint: "/api/v1/csrd/audit/execute"
      method: "POST"
      authentication: "required"
      rate_limit: "20 req/min"

  environment_config:
    - name: "ESRS_COMPLIANCE_RULES_PATH"
      required: true
      description: "Path to compliance rules file"

# ----------------------------------------------------------------------------
# SECTION 8: DOCUMENTATION
# ----------------------------------------------------------------------------
documentation:
  readme_path: "docs/agents/audit_agent/README.md"
  api_docs_path: "docs/agents/audit_agent/API.md"

  example_use_cases:
    - title: "Full Compliance Validation"
      description: "Validate complete CSRD report"
      output_summary: "200+ rules checked, compliance status determined"

    - title: "Auditor Package Generation"
      description: "Create external auditor package"
      output_summary: "Complete audit trail and documentation package"

  guides:
    - "Getting Started with AuditAgent"
    - "Understanding Compliance Rules"
    - "Auditor Package Guide"

# ----------------------------------------------------------------------------
# SECTION 9: COMPLIANCE
# ----------------------------------------------------------------------------
compliance:
  zero_secrets: true

  standards:
    - "ESRS Set 1"
    - "CSRD Directive (EU 2022/2464)"
    - "ESEF Regulation"

  security:
    secret_scanning: "GL-SecScan validated"
    vulnerability_scanning: "pip-audit clean"
    sbom_generated: true
    code_signing: false

  data_privacy:
    pii_handling: "No PII processed"
    data_retention: "As per company policy"
    encryption: "Data in transit: TLS 1.3"

  zero_hallucination_guarantee: true

# ----------------------------------------------------------------------------
# PERFORMANCE
# ----------------------------------------------------------------------------
performance:
  target_processing_time: "<3 min"
  rules_per_second: "100+"

guarantees:
  deterministic: true
  complete_coverage: true
  zero_hallucination: true

# ----------------------------------------------------------------------------
# SECTION 10: METADATA
# ----------------------------------------------------------------------------
metadata:
  created_date: "2025-10-18"
  last_modified: "2025-10-18"
  review_status: "Upgraded to AgentSpec V2.0"

  authors:
    - name: "CSRD Platform Team"
      role: "Development"

  reviewers:
    - name: "Head of AI & Climate Intelligence"
      role: "Technical Review"
      status: "Pending"

  change_log:
    - version: "1.1.0"
      date: "2025-10-18"
      changes: "Upgraded to AgentSpec V2.0 compliance - Added agent_metadata, enhanced description, upgraded tools section, added ai_integration, sub_agents, testing, deployment, documentation, compliance, and metadata sections"
      author: "CSRD Platform Team"
      breaking_changes: false

    - version: "1.0.0"
      date: "2025-10-18"
      changes: "Initial release"
      author: "CSRD Platform Team"
      breaking_changes: false
