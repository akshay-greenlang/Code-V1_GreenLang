# ============================================================================
# AGENT SPECIFICATION: MULTI-STANDARD AGGREGATOR AGENT
# AgentSpec V2.0 Compliant
# ============================================================================

# ----------------------------------------------------------------------------
# SECTION 1: AGENT METADATA
# ----------------------------------------------------------------------------
agent_metadata:
  agent_id: "csrd_aggregator_agent"
  agent_name: "AggregatorAgent"
  display_name: "Multi-Standard Aggregator Agent"
  version: "1.1.0"
  domain: "CSRD/ESG Reporting"
  subdomain: "Data Aggregation & Benchmarking"
  agent_type: "aggregator"
  complexity: "medium"
  priority: "high"
  status: "production"
  deterministic: true
  llm_usage: false
  zero_hallucination: true

# ----------------------------------------------------------------------------
# SECTION 2: DESCRIPTION
# ----------------------------------------------------------------------------
description:
  purpose: |
    Aggregate ESG data across multiple reporting frameworks (TCFD, GRI, SASB → ESRS)
    and perform time-series analysis and benchmarking.

  strategic_context:
    global_impact: "Supports multi-framework reporting for companies transitioning to CSRD"
    opportunity: "Eliminate 70% of manual cross-framework mapping effort"
    market_size: "Multi-framework reporting market valued at €2B annually"
    technology_maturity: "TRL 8 (System complete and qualified)"

  capabilities:
    - "Cross-standard mapping (TCFD, GRI, SASB → ESRS)"
    - "Time-series aggregation and trend analysis"
    - "Comparative benchmarking against industry peers"
    - "Gap analysis across frameworks"
    - "Historical data alignment"
    - "Multi-year ESG performance tracking"

  key_features:
    - "<2 min processing for 10,000 metrics"
    - "Zero hallucination (deterministic mapping)"
    - "Support for multiple years of data"
    - "Industry benchmark comparison"
    - "100% reproducible aggregations"

  dependencies:
    - agent_id: "calculator_agent"
      relationship: "receives_data_from"
      data: "calculated_metrics"
    - agent_id: "reporting_agent"
      relationship: "provides_data_to"
      data: "aggregated_esg_data"
    - agent_id: "audit_agent"
      relationship: "provides_data_to"
      data: "trend_analysis"

# ----------------------------------------------------------------------------
# INPUTS
# ----------------------------------------------------------------------------
inputs:
  primary_inputs:
    - name: "calculated_metrics"
      type: "json"
      required: true
      source: "Output from CalculatorAgent"
      description: "ESRS-calculated metrics"

    - name: "tcfd_data"
      type: "json"
      required: false
      description: "TCFD climate disclosure data"

    - name: "gri_data"
      type: "json"
      required: false
      description: "GRI sustainability report data"

    - name: "sasb_data"
      type: "json"
      required: false
      description: "SASB industry metrics"

  reference_data:
    - name: "framework_mappings"
      path: "data/framework_mappings.json"
      description: "Cross-framework mapping tables"
      required: true

    - name: "industry_benchmarks"
      path: "data/industry_benchmarks.json"
      description: "Sector-specific ESG benchmarks"
      required: false

# ----------------------------------------------------------------------------
# OUTPUTS
# ----------------------------------------------------------------------------
outputs:
  - name: "aggregated_esg_data"
    format: "json"
    description: "Unified multi-standard ESG dataset"

  - name: "trend_analysis"
    format: "json"
    description: "Time-series trends and insights"

  - name: "gap_analysis"
    format: "json"
    description: "Coverage gaps across standards"

  - name: "benchmark_comparison"
    format: "json"
    description: "Comparison to industry benchmarks"

# ----------------------------------------------------------------------------
# SECTION 3: TOOLS
# ----------------------------------------------------------------------------
tools:
  tools_list:
    - tool_id: "cross_standard_mapper"
      name: "cross-standard-mapper"
      deterministic: true
      category: "lookup"
      description: "Map metrics across frameworks (TCFD/GRI/SASB → ESRS)"

      parameters:
        type: "object"
        properties:
          source_framework: {type: "string", description: "TCFD|GRI|SASB"}
          metric_code: {type: "string", description: "Metric code from source"}
        required: ["source_framework", "metric_code"]

      returns:
        type: "object"
        properties:
          esrs_code: {type: "string", description: "Mapped ESRS code"}
          mapping_confidence: {type: "string", description: "exact|partial|none"}

      implementation:
        method: "Database hash lookup"
        database: "data/framework_mappings.json"
        calculation_method: "Direct mapping via lookup table"
        accuracy: "100% deterministic"
        validation: "Tested against official crosswalk tables"
        standards: ["ESRS", "TCFD", "GRI", "SASB"]

    - tool_id: "time_series_aggregator"
      name: "time-series-aggregator"
      deterministic: true
      category: "aggregation"
      description: "Aggregate multi-year data"

      parameters:
        type: "object"
        properties:
          metric_code: {type: "string", description: "ESRS metric code"}
          time_series_data: {type: "array", description: "Multi-year values"}
        required: ["metric_code", "time_series_data"]

      returns:
        type: "object"
        properties:
          yoy_change: {type: "number", description: "Year-over-year % change"}
          cagr_3y: {type: "number", description: "3-year CAGR"}
          trend: {type: "string", description: "improving|declining|stable"}

      implementation:
        method: "Statistical aggregation"
        calculation_method: "CAGR = ((End/Start)^(1/Years)) - 1"
        accuracy: "100% deterministic"
        validation: "Tested with known time series"
        standards: ["Statistical Best Practices"]

    - tool_id: "benchmark_comparator"
      name: "benchmark-comparator"
      deterministic: true
      category: "analysis"
      description: "Compare to industry benchmarks"

      parameters:
        type: "object"
        properties:
          metric_code: {type: "string", description: "ESRS metric"}
          company_value: {type: "number", description: "Company metric value"}
          sector: {type: "string", description: "Industry sector"}
        required: ["metric_code", "company_value", "sector"]

      returns:
        type: "object"
        properties:
          sector_median: {type: "number", description: "Sector median value"}
          percentile: {type: "number", description: "Company percentile (0-100)"}
          vs_median: {type: "string", description: "above|below|at median"}

      implementation:
        method: "Statistical comparison"
        database: "data/industry_benchmarks.json"
        calculation_method: "Percentile ranking"
        accuracy: "100% deterministic"
        validation: "Tested with benchmark datasets"
        standards: ["Industry Benchmarking Standards"]

# ----------------------------------------------------------------------------
# SECTION 4: AI INTEGRATION
# ----------------------------------------------------------------------------
ai_integration:
  enabled: false
  model: "N/A - Deterministic aggregator agent"
  temperature: 0.0
  seed: 42
  provenance_tracking: true
  tool_choice: "N/A"
  max_iterations: 0
  budget_usd: 0.0
  rationale: "This is a deterministic data aggregation agent with ZERO AI/LLM usage"
  zero_hallucination_guarantee: true

# ----------------------------------------------------------------------------
# SECTION 5: SUB-AGENTS
# ----------------------------------------------------------------------------
sub_agents:
  enabled: false
  coordination_pattern: "N/A"
  sub_agent_list: []
  rationale: "This is a leaf-level agent with no sub-agents"

# ----------------------------------------------------------------------------
# PROCESSING WORKFLOW
# ----------------------------------------------------------------------------
processing_workflow:
  step_1_framework_integration:
    name: "Integrate Multi-Framework Data"
    method: "Deterministic mapping"
    process: |
      FOR each non-ESRS data source (TCFD, GRI, SASB):
        FOR each metric in source:
          mapped_esrs_code = framework_mappings[source][metric_code]
          IF mapped_esrs_code EXISTS:
            merge_into_aggregated_data(mapped_esrs_code, metric_value)
            add_source_reference(source, metric_code)

  step_2_time_series_aggregation:
    name: "Multi-Year Time Series"
    description: "Aggregate historical data"
    method: "Deterministic"

  step_3_trend_analysis:
    name: "Calculate Trends"
    metrics:
      - "Year-over-year % change"
      - "3-year CAGR"
      - "Trend direction (improving/declining/stable)"

  step_4_benchmark_comparison:
    name: "Industry Benchmarking"
    comparisons:
      - "Company vs sector median"
      - "Company vs sector top quartile"
      - "Percentile ranking"

  step_5_gap_analysis:
    name: "Identify Data Gaps"
    checks:
      - "Missing ESRS data points"
      - "Framework coverage comparison"
      - "Data quality assessment"

# ----------------------------------------------------------------------------
# SECTION 6: TESTING
# ----------------------------------------------------------------------------
testing:
  test_coverage_target: 0.80

  test_categories:
    - category: "unit_tests"
      description: "Test individual aggregation tools"
      count: 15
      examples:
        - "test_cross_standard_mapper_tcfd_to_esrs"
        - "test_time_series_aggregator_cagr"
        - "test_benchmark_comparator_percentile"

    - category: "integration_tests"
      description: "Test full aggregation workflows"
      count: 8
      examples:
        - "test_multi_framework_aggregation"
        - "test_complete_trend_analysis"
        - "test_benchmark_comparison_workflow"

    - category: "determinism_tests"
      description: "Verify reproducibility"
      count: 5
      examples:
        - "test_same_input_same_output_100_runs"
        - "test_aggregation_reproducibility"
        - "test_mapping_deterministic"

    - category: "boundary_tests"
      description: "Test edge cases"
      count: 10
      examples:
        - "test_empty_input_data"
        - "test_missing_framework_mappings"
        - "test_single_year_data"
        - "test_unmapped_metrics"

  performance_requirements:
    max_latency_ms: 120000  # 2 minutes for 10,000 metrics
    max_cost_usd: 0.0
    accuracy_target: 1.0
    throughput: "10000 metrics/2min"

# ----------------------------------------------------------------------------
# SECTION 7: DEPLOYMENT
# ----------------------------------------------------------------------------
deployment:
  pack_id: "csrd/aggregator_agent"
  pack_version: "1.1.0"

  resource_requirements:
    memory_mb: 1024
    cpu_cores: 2
    gpu_required: false
    storage_mb: 200

  dependencies:
    python_packages:
      - "pandas>=2.0,<3.0"
      - "numpy>=1.24,<2.0"
      - "pydantic>=2.0,<3.0"

    greenlang_modules:
      - "greenlang.agents.base"
      - "greenlang.core.aggregation"

  api_endpoints:
    - endpoint: "/api/v1/csrd/aggregator/execute"
      method: "POST"
      authentication: "required"
      rate_limit: "50 req/min"

  environment_config:
    - name: "FRAMEWORK_MAPPINGS_PATH"
      required: true
      description: "Path to framework mappings database"
    - name: "INDUSTRY_BENCHMARKS_PATH"
      required: false
      description: "Path to industry benchmarks database"

# ----------------------------------------------------------------------------
# SECTION 8: DOCUMENTATION
# ----------------------------------------------------------------------------
documentation:
  readme_path: "docs/agents/aggregator_agent/README.md"
  api_docs_path: "docs/agents/aggregator_agent/API.md"

  example_use_cases:
    - title: "Multi-Framework Aggregation"
      description: "Combine TCFD, GRI, and ESRS data"
      output_summary: "Unified dataset with all frameworks mapped"

    - title: "Time-Series Trend Analysis"
      description: "Analyze 5 years of GHG emissions data"
      output_summary: "YoY trends, CAGR, improvement trajectory"

    - title: "Industry Benchmarking"
      description: "Compare company to sector peers"
      output_summary: "Percentile rankings across all metrics"

  guides:
    - "Getting Started with AggregatorAgent"
    - "Framework Mapping Guide"
    - "Trend Analysis Interpretation"

# ----------------------------------------------------------------------------
# SECTION 9: COMPLIANCE
# ----------------------------------------------------------------------------
compliance:
  zero_secrets: true

  standards:
    - "ESRS Set 1"
    - "TCFD Recommendations"
    - "GRI Universal Standards"
    - "SASB Standards"

  security:
    secret_scanning: "GL-SecScan validated"
    vulnerability_scanning: "pip-audit clean"
    sbom_generated: true
    code_signing: false

  data_privacy:
    pii_handling: "No PII processed"
    data_retention: "As per company policy"
    encryption: "Data in transit: TLS 1.3"

  zero_hallucination_guarantee: true

# ----------------------------------------------------------------------------
# PERFORMANCE TARGETS
# ----------------------------------------------------------------------------
performance:
  target_processing_time: "<2 min for 10,000 metrics"
  memory_footprint: "<1 GB"

guarantees:
  deterministic: true
  zero_hallucination: true
  reproducible: true

# ----------------------------------------------------------------------------
# SECTION 10: METADATA
# ----------------------------------------------------------------------------
metadata:
  created_date: "2025-10-18"
  last_modified: "2025-10-18"
  review_status: "Upgraded to AgentSpec V2.0"

  authors:
    - name: "CSRD Platform Team"
      role: "Development"

  reviewers:
    - name: "Head of AI & Climate Intelligence"
      role: "Technical Review"
      status: "Pending"

  change_log:
    - version: "1.1.0"
      date: "2025-10-18"
      changes: "Upgraded to AgentSpec V2.0 compliance - Added agent_metadata, enhanced description, upgraded tools section, added ai_integration, sub_agents, testing, deployment, documentation, compliance, and metadata sections"
      author: "CSRD Platform Team"
      breaking_changes: false

    - version: "1.0.0"
      date: "2025-10-18"
      changes: "Initial release"
      author: "CSRD Platform Team"
      breaking_changes: false
