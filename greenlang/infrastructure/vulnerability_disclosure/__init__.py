# -*- coding: utf-8 -*-
"""
GreenLang Vulnerability Disclosure Program - SEC-010

Production-grade Vulnerability Disclosure Program (VDP) for the GreenLang
Climate OS platform. Provides vulnerability submission handling, triage
workflow, disclosure timeline management, researcher reputation tracking,
and bug bounty processing.

Key Features:
    - Secure vulnerability submission (public API, no auth required)
    - Auto-acknowledgment within 24 hours
    - CVSS 3.1 scoring and severity classification
    - Disclosure timeline management (7/30/60/90 day policies)
    - Duplicate detection via title/component similarity
    - Researcher hall of fame with reputation scoring
    - Bug bounty processing with quality/impact bonuses
    - Prometheus metrics for program analytics

Public API:
    - VulnerabilitySubmissionHandler: Handles incoming vulnerability reports.
    - TriageWorkflow: Manages triage state machine and CVSS scoring.
    - DisclosureTracker: Manages disclosure timelines and advisories.
    - ResearcherManager: Manages researcher profiles and reputation.
    - BountyProcessor: Handles bounty calculations and payments.

Models:
    - VulnerabilityReport: Core report submitted by researcher.
    - Submission: Full submission record with workflow state.
    - Researcher: Security researcher profile.
    - BountyPayment: Bounty payment record.
    - DisclosureAdvisory: Public security advisory.
    - Severity: Vulnerability severity levels.
    - SubmissionStatus: Submission workflow states.
    - PaymentStatus: Payment workflow states.

Configuration:
    - VDPConfig: Disclosure timelines, bounty tiers, notification settings.
    - get_config: Factory function for configuration singleton.

Example:
    >>> from greenlang.infrastructure.vulnerability_disclosure import (
    ...     VulnerabilitySubmissionHandler,
    ...     TriageWorkflow,
    ...     VulnerabilityReport,
    ...     Severity,
    ... )
    >>>
    >>> # Submit a vulnerability
    >>> handler = VulnerabilitySubmissionHandler()
    >>> report = VulnerabilityReport(
    ...     title="SQL Injection in User Search",
    ...     description="The search endpoint is vulnerable to SQL injection...",
    ...     steps_to_reproduce=["Navigate to /api/users/search", "Enter payload"],
    ...     impact="Full database access possible",
    ...     affected_component="user-service",
    ... )
    >>> submission = await handler.submit(report, "researcher@example.com")
    >>>
    >>> # Triage the submission
    >>> workflow = TriageWorkflow()
    >>> await workflow.triage(submission.submission_id, "analyst-123")
    >>> score, vector = workflow.calculate_cvss(
    ...     attack_vector="N",
    ...     attack_complexity="L",
    ...     privileges_required="N",
    ...     user_interaction="N",
    ...     scope="U",
    ...     confidentiality="H",
    ...     integrity="H",
    ...     availability="H",
    ... )
    >>> await workflow.confirm_vulnerability(
    ...     submission.submission_id,
    ...     Severity.CRITICAL,
    ...     score,
    ...     vector,
    ... )
"""

from __future__ import annotations

import logging

# Import configuration
from greenlang.infrastructure.vulnerability_disclosure.config import (
    VDPConfig,
    get_config,
    reset_config,
)

# Import models
from greenlang.infrastructure.vulnerability_disclosure.models import (
    BountyPayment,
    DisclosureAdvisory,
    IdentityVerificationMethod,
    PaymentStatus,
    Researcher,
    Severity,
    Submission,
    SubmissionStatus,
    VulnerabilityReport,
)

# Import core handlers
from greenlang.infrastructure.vulnerability_disclosure.submission_handler import (
    DuplicateSubmissionError,
    RateLimitError,
    SubmissionError,
    ValidationError,
    VulnerabilitySubmissionHandler,
)

# Import workflow
from greenlang.infrastructure.vulnerability_disclosure.triage_workflow import (
    CVSSCalculator,
    InvalidTransitionError,
    SubmissionNotFoundError,
    TriageError,
    TriageWorkflow,
)

# Import disclosure tracker
from greenlang.infrastructure.vulnerability_disclosure.disclosure_tracker import (
    DeadlineExtensionError,
    DisclosureError,
    DisclosureNotReadyError,
    DisclosureTracker,
)

# Import researcher manager
from greenlang.infrastructure.vulnerability_disclosure.researcher_manager import (
    DuplicateResearcherError,
    ResearcherError,
    ResearcherManager,
    ResearcherNotFoundError,
    VerificationError,
)

# Import bounty processor
from greenlang.infrastructure.vulnerability_disclosure.bounty_processor import (
    ApprovalError,
    BountyError,
    BountyProcessor,
    InvalidPaymentStateError,
    PaymentNotFoundError,
    PaymentProcessingError,
)

logger = logging.getLogger(__name__)

# ---------------------------------------------------------------------------
# Public API
# ---------------------------------------------------------------------------

__all__ = [
    # Configuration
    "VDPConfig",
    "get_config",
    "reset_config",
    # Core Handlers
    "VulnerabilitySubmissionHandler",
    "TriageWorkflow",
    "DisclosureTracker",
    "ResearcherManager",
    "BountyProcessor",
    # Models
    "VulnerabilityReport",
    "Submission",
    "Researcher",
    "BountyPayment",
    "DisclosureAdvisory",
    # Enums
    "Severity",
    "SubmissionStatus",
    "PaymentStatus",
    "IdentityVerificationMethod",
    # Utilities
    "CVSSCalculator",
    # Exceptions
    "SubmissionError",
    "DuplicateSubmissionError",
    "RateLimitError",
    "ValidationError",
    "TriageError",
    "InvalidTransitionError",
    "SubmissionNotFoundError",
    "DisclosureError",
    "DisclosureNotReadyError",
    "DeadlineExtensionError",
    "ResearcherError",
    "ResearcherNotFoundError",
    "DuplicateResearcherError",
    "VerificationError",
    "BountyError",
    "PaymentNotFoundError",
    "InvalidPaymentStateError",
    "ApprovalError",
    "PaymentProcessingError",
]

# Module version
__version__ = "1.0.0"
