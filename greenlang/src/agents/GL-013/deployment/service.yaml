# ==============================================================================
# GL-013 PREDICTMAINT - Kubernetes Service Manifest
# ==============================================================================
# Service configuration for exposing the predictive maintenance application
# Features:
#   - ClusterIP service for internal communication
#   - Headless service for StatefulSet (if needed)
#   - Separate metrics service for Prometheus scraping
# ==============================================================================
---
# ------------------------------------------------------------------------------
# Primary Application Service - ClusterIP
# ------------------------------------------------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: gl-013-predictmaint
  namespace: greenlang
  labels:
    app: gl-013-predictmaint
    app.kubernetes.io/name: gl-013-predictmaint
    app.kubernetes.io/component: predictive-maintenance
    app.kubernetes.io/part-of: greenlang-platform
    team: iota
    tier: backend
  annotations:
    description: "GL-013 PREDICTMAINT - Main application service"
    # Prometheus service discovery
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  # Session affinity for sticky sessions (optional)
  sessionAffinity: None
  # IP family configuration
  ipFamilyPolicy: SingleStack
  ipFamilies:
    - IPv4
  # Port configuration
  ports:
    # Main HTTP API port
    - name: http
      port: 80
      targetPort: 8000
      protocol: TCP
    # Metrics port for Prometheus
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP
  # Pod selector
  selector:
    app: gl-013-predictmaint

---
# ------------------------------------------------------------------------------
# Headless Service - For StatefulSet DNS resolution
# ------------------------------------------------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: gl-013-predictmaint-headless
  namespace: greenlang
  labels:
    app: gl-013-predictmaint
    app.kubernetes.io/name: gl-013-predictmaint
    app.kubernetes.io/component: predictive-maintenance
    service-type: headless
  annotations:
    description: "GL-013 PREDICTMAINT - Headless service for pod DNS"
spec:
  type: ClusterIP
  clusterIP: None
  publishNotReadyAddresses: true
  ports:
    - name: http
      port: 8000
      targetPort: 8000
      protocol: TCP
  selector:
    app: gl-013-predictmaint

---
# ------------------------------------------------------------------------------
# Metrics Service - Dedicated service for Prometheus scraping
# ------------------------------------------------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: gl-013-predictmaint-metrics
  namespace: greenlang
  labels:
    app: gl-013-predictmaint
    app.kubernetes.io/name: gl-013-predictmaint
    app.kubernetes.io/component: metrics
    service-type: metrics
  annotations:
    description: "GL-013 PREDICTMAINT - Metrics endpoint for Prometheus"
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  ports:
    - name: metrics
      port: 9090
      targetPort: 9090
      protocol: TCP
  selector:
    app: gl-013-predictmaint

---
# ------------------------------------------------------------------------------
# External Service - NodePort for development/testing (optional)
# ------------------------------------------------------------------------------
apiVersion: v1
kind: Service
metadata:
  name: gl-013-predictmaint-external
  namespace: greenlang
  labels:
    app: gl-013-predictmaint
    app.kubernetes.io/name: gl-013-predictmaint
    app.kubernetes.io/component: predictive-maintenance
    service-type: external
  annotations:
    description: "GL-013 PREDICTMAINT - External access service (dev only)"
spec:
  type: NodePort
  ports:
    - name: http
      port: 80
      targetPort: 8000
      nodePort: 30013
      protocol: TCP
  selector:
    app: gl-013-predictmaint
