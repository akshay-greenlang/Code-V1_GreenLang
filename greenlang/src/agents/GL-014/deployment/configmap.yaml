# ==============================================================================
# GL-014 EXCHANGER-PRO - Kubernetes ConfigMap
# ==============================================================================
# Non-sensitive configuration for the heat exchanger optimizer application
# Features:
#   - Database connection parameters (non-sensitive)
#   - Redis connection parameters (non-sensitive)
#   - Application settings
#   - Feature flags
#   - Heat exchanger analysis thresholds
#   - Economic parameters
#   - External service endpoints
# ==============================================================================
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gl-014-exchanger-pro-config
  namespace: greenlang
  labels:
    app: gl-014-exchanger-pro
    app.kubernetes.io/name: gl-014-exchanger-pro
    app.kubernetes.io/component: config
    app.kubernetes.io/part-of: greenlang-platform
    team: iota
  annotations:
    description: "GL-014 EXCHANGER-PRO - Application configuration"
data:
  # ==============================================================================
  # Application Settings
  # ==============================================================================
  ENVIRONMENT: "production"
  SERVICE_NAME: "gl-014-exchanger-pro"
  SERVICE_VERSION: "1.0.0"
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"
  DEBUG: "false"

  # API Configuration
  API_VERSION: "v1"
  API_PREFIX: "/api/v1"
  API_TITLE: "GL-014 EXCHANGER-PRO API"
  API_DESCRIPTION: "Heat Exchanger Optimizer Service for GreenLang Platform"

  # Server Configuration
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "8080"
  SERVER_WORKERS: "4"
  SERVER_TIMEOUT: "120"
  SERVER_KEEPALIVE: "5"
  GRPC_PORT: "50051"

  # ==============================================================================
  # Database Configuration (Non-Sensitive)
  # ==============================================================================
  DB_HOST: "postgresql.greenlang.svc.cluster.local"
  DB_PORT: "5432"
  DB_NAME: "gl014_exchanger_pro"
  DB_POOL_SIZE: "10"
  DB_MAX_OVERFLOW: "20"
  DB_POOL_TIMEOUT: "30"
  DB_POOL_RECYCLE: "1800"
  DB_ECHO: "false"

  # ==============================================================================
  # Redis Configuration (Non-Sensitive)
  # ==============================================================================
  REDIS_HOST: "redis.greenlang.svc.cluster.local"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  REDIS_MAX_CONNECTIONS: "100"
  REDIS_SOCKET_TIMEOUT: "5"
  REDIS_SOCKET_CONNECT_TIMEOUT: "5"
  REDIS_RETRY_ON_TIMEOUT: "true"

  # Cache Configuration
  CACHE_DEFAULT_TTL: "3600"
  CACHE_MAX_TTL: "86400"
  CACHE_PREFIX: "gl014:"

  # ==============================================================================
  # Process Historian Configuration (Non-Sensitive)
  # ==============================================================================
  HISTORIAN_HOST: "historian.greenlang.svc.cluster.local"
  HISTORIAN_PORT: "5450"
  HISTORIAN_PROTOCOL: "OSIsoft_PI"
  HISTORIAN_POLL_INTERVAL: "60"
  HISTORIAN_BATCH_SIZE: "1000"

  # ==============================================================================
  # Monitoring & Observability
  # ==============================================================================
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  METRICS_PATH: "/metrics"

  # OpenTelemetry Configuration
  OTEL_ENABLED: "true"
  OTEL_SERVICE_NAME: "gl-014-exchanger-pro"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://otel-collector.monitoring.svc.cluster.local:4317"
  OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
  OTEL_TRACES_SAMPLER: "parentbased_traceidratio"
  OTEL_TRACES_SAMPLER_ARG: "0.1"

  # Jaeger Configuration (if using Jaeger directly)
  JAEGER_AGENT_HOST: "jaeger-agent.monitoring.svc.cluster.local"
  JAEGER_AGENT_PORT: "6831"

  # ==============================================================================
  # Heat Exchanger Analysis Configuration
  # ==============================================================================
  # Model Configuration
  MODEL_UPDATE_INTERVAL: "3600"
  MODEL_STORAGE_PATH: "/app/models"
  MODEL_MAX_VERSIONS: "5"

  # Calculation Configuration
  CALCULATION_BATCH_SIZE: "100"
  CALCULATION_TIMEOUT: "60"
  CALCULATION_CACHE_TTL: "300"

  # Fouling Thresholds (m2-K/W)
  FOULING_THRESHOLD_LIGHT: "0.0001"
  FOULING_THRESHOLD_MODERATE: "0.0003"
  FOULING_THRESHOLD_HEAVY: "0.0005"
  FOULING_THRESHOLD_SEVERE: "0.001"
  FOULING_THRESHOLD_CRITICAL: "0.002"

  # Performance Thresholds (%)
  EFFICIENCY_THRESHOLD_OPTIMAL: "95.0"
  EFFICIENCY_THRESHOLD_GOOD: "85.0"
  EFFICIENCY_THRESHOLD_DEGRADED: "75.0"
  EFFICIENCY_THRESHOLD_POOR: "65.0"
  EFFICIENCY_THRESHOLD_CRITICAL: "50.0"

  # U-Value Ratio Thresholds
  U_RATIO_OPTIMAL: "0.95"
  U_RATIO_GOOD: "0.85"
  U_RATIO_DEGRADED: "0.70"
  U_RATIO_POOR: "0.55"
  U_RATIO_CRITICAL: "0.40"

  # Approach Temperature Thresholds (K)
  APPROACH_OPTIMAL: "5.0"
  APPROACH_ACCEPTABLE: "10.0"
  APPROACH_DEGRADED: "15.0"
  APPROACH_POOR: "25.0"

  # Fouling Model Parameters
  FOULING_TIME_CONSTANT_DAYS: "180.0"
  FOULING_MAX_FACTOR: "0.002"
  FOULING_RATE_ACCELERATION_THRESHOLD: "0.00001"

  # Safety Limits
  MAX_PRESSURE_DROP_RATIO: "2.0"
  MAX_TEMPERATURE_APPROACH_K: "50.0"
  MIN_FLOW_RATIO: "0.5"
  MAX_TUBE_VELOCITY_M_S: "3.0"
  MIN_TUBE_VELOCITY_M_S: "0.5"

  # ==============================================================================
  # Economic Parameters
  # ==============================================================================
  ELECTRICITY_COST_PER_KWH: "0.10"
  STEAM_COST_PER_KG: "0.03"
  COOLING_WATER_COST_PER_M3: "0.50"
  DOWNTIME_COST_PER_HOUR: "5000.0"
  CLEANING_LABOR_COST_PER_HOUR: "150.0"
  CURRENCY: "USD"

  # Cleaning Costs (USD)
  CHEMICAL_CLEANING_COST: "15000.0"
  MECHANICAL_CLEANING_COST: "25000.0"
  HYDROBLAST_CLEANING_COST: "35000.0"
  OFFLINE_CHEMICAL_COST: "20000.0"
  ONLINE_CHEMICAL_COST: "8000.0"

  # Cleaning Downtime (hours)
  CHEMICAL_DOWNTIME_HOURS: "24.0"
  MECHANICAL_DOWNTIME_HOURS: "48.0"
  HYDROBLAST_DOWNTIME_HOURS: "36.0"
  OFFLINE_CHEMICAL_HOURS: "36.0"
  ONLINE_CHEMICAL_HOURS: "0.0"

  # Cleaning Effectiveness (%)
  CHEMICAL_EFFECTIVENESS: "85.0"
  MECHANICAL_EFFECTIVENESS: "95.0"
  HYDROBLAST_EFFECTIVENESS: "90.0"

  # ==============================================================================
  # Feature Flags
  # ==============================================================================
  FEATURE_FOULING_PREDICTION: "true"
  FEATURE_CLEANING_OPTIMIZATION: "true"
  FEATURE_ECONOMIC_ANALYSIS: "true"
  FEATURE_PERFORMANCE_TRACKING: "true"
  FEATURE_REAL_TIME_MONITORING: "true"
  FEATURE_BATCH_PROCESSING: "true"
  FEATURE_API_RATE_LIMITING: "true"
  FEATURE_GRPC_ENABLED: "true"
  FEATURE_CMMS_INTEGRATION: "true"
  FEATURE_HISTORIAN_INTEGRATION: "true"

  # ==============================================================================
  # Rate Limiting
  # ==============================================================================
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS_PER_MINUTE: "100"
  RATE_LIMIT_BURST_SIZE: "20"
  RATE_LIMIT_WINDOW_SIZE: "60"

  # ==============================================================================
  # External Services
  # ==============================================================================
  # MQTT Message Queue
  MQTT_BROKER_HOST: "mqtt.greenlang.svc.cluster.local"
  MQTT_BROKER_PORT: "1883"
  MQTT_CLIENT_ID: "gl-014-exchanger-pro"
  MQTT_KEEPALIVE: "60"
  MQTT_QOS: "1"
  MQTT_TOPIC_PREFIX: "greenlang/gl-014"

  # OPC UA Server
  OPCUA_SERVER_URL: "opc.tcp://opcua.greenlang.svc.cluster.local:4840"
  OPCUA_NAMESPACE: "ns=2"
  OPCUA_SECURITY_POLICY: "Basic256Sha256"

  # Modbus Gateway
  MODBUS_HOST: "modbus-gateway.greenlang.svc.cluster.local"
  MODBUS_PORT: "502"
  MODBUS_UNIT_ID: "1"

  # CMMS Integration
  CMMS_HOST: "cmms.greenlang.svc.cluster.local"
  CMMS_PORT: "8000"
  CMMS_TYPE: "SAP_PM"

  # ==============================================================================
  # Health Check Configuration
  # ==============================================================================
  HEALTH_CHECK_ENABLED: "true"
  HEALTH_CHECK_PATH: "/health"
  HEALTH_CHECK_INTERVAL: "30"
  HEALTH_CHECK_TIMEOUT: "10"
  HEALTH_CHECK_DB_ENABLED: "true"
  HEALTH_CHECK_REDIS_ENABLED: "true"
  HEALTH_CHECK_HISTORIAN_ENABLED: "true"

  # ==============================================================================
  # Application YAML Configuration
  # ==============================================================================
  application.yaml: |
    # GL-014 EXCHANGER-PRO Application Configuration
    # This file is mounted at /app/config/application.yaml

    application:
      name: gl-014-exchanger-pro
      version: 1.0.0
      environment: production

    server:
      host: 0.0.0.0
      port: 8080
      grpc_port: 50051
      workers: 4
      timeout: 120
      cors:
        enabled: true
        origins:
          - "https://app.greenlang.io"
          - "https://api.greenlang.io"
          - "https://heatexchanger.greenlang.io"
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
        allow_headers:
          - "*"
        allow_credentials: true

    database:
      pool:
        min_size: 5
        max_size: 20
        timeout: 30
        recycle: 1800

    cache:
      backend: redis
      default_ttl: 3600
      key_prefix: "gl014:"

    monitoring:
      prometheus:
        enabled: true
        port: 9090
        path: /metrics
      tracing:
        enabled: true
        sampler: 0.1

    heat_exchanger:
      analysis:
        calculation_timeout: 60
        batch_size: 100
      fouling:
        thresholds:
          light: 0.0001
          moderate: 0.0003
          heavy: 0.0005
          severe: 0.001
          critical: 0.002
        model:
          time_constant_days: 180
          max_factor: 0.002
      performance:
        efficiency_thresholds:
          optimal: 95.0
          good: 85.0
          degraded: 75.0
          poor: 65.0
          critical: 50.0
        u_ratio_thresholds:
          optimal: 0.95
          good: 0.85
          degraded: 0.70
          poor: 0.55
          critical: 0.40

    economics:
      currency: USD
      energy_costs:
        electricity_per_kwh: 0.10
        steam_per_kg: 0.03
        cooling_water_per_m3: 0.50
      operations:
        downtime_per_hour: 5000.0
        cleaning_labor_per_hour: 150.0
      cleaning:
        chemical:
          cost: 15000.0
          downtime_hours: 24.0
          effectiveness: 0.85
        mechanical:
          cost: 25000.0
          downtime_hours: 48.0
          effectiveness: 0.95
        hydroblast:
          cost: 35000.0
          downtime_hours: 36.0
          effectiveness: 0.90

    integrations:
      historian:
        enabled: true
        protocol: OSIsoft_PI
        poll_interval: 60
      cmms:
        enabled: true
        type: SAP_PM
        publish_interval: 3600
      mqtt:
        enabled: true
        qos: 1
        topic_prefix: "greenlang/gl-014"
