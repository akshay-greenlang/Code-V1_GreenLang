# ============================================================================
# GL-005 COMBUSTIONCONTROLAGENT - GREENLANG PACK DEFINITION
# ============================================================================
#
# Production-grade real-time combustion control for industrial facilities.
# Zero-hallucination deterministic control with SIL-2 safety rating.
#
# Version: 1.0.0
# Author: GreenLang Industrial Control Systems Team
# License: Apache-2.0
# Compliance: ASME PTC 4.1, NFPA 85, IEC 61508, EPA 40 CFR Part 60
#
# ============================================================================

# ----------------------------------------------------------------------------
# PACK METADATA
# ----------------------------------------------------------------------------

name: gl-005-combustion-control-agent
version: 1.0.0
kind: pack
display_name: GL-005 CombustionControlAgent
tagline: Zero-hallucination real-time combustion control with SIL-2 safety

author:
  name: GreenLang Industrial Control Systems Team
  email: gl-005@greenlang.ai
  organization: GreenLang

description: |
  Production-grade real-time combustion control agent for industrial facilities.

  Provides automated control of combustion processes to ensure consistent heat
  output, optimal fuel efficiency, and emissions compliance. Uses classical PID
  control with ZERO HALLUCINATION guarantee for all critical calculations.

  Key Features:
  - Real-time cascade PID control (<100ms loop time)
  - Multi-objective optimization (efficiency + emissions + stability)
  - Zero-hallucination deterministic algorithms
  - SIL-2 rated safety interlocks
  - DCS/PLC/CEMS integration (Modbus TCP, OPC UA)
  - Complete audit trail with SHA-256 provenance

  Performance:
  - <100ms control loop cycle time
  - <50ms control decision latency
  - ±0.5% setpoint tracking accuracy
  - 99.95% system uptime

  Market Impact:
  - Total Addressable Market: $8B annually
  - Target Market Capture: 10% by 2030 ($800M)
  - Fuel Savings Potential: 10-20% reduction
  - Carbon Reduction: 50 Mt CO2e/year
  - ROI: 12-18 month payback period

category: industrial-control
tags:
  - combustion-control
  - real-time-control
  - pid-controller
  - emissions-control
  - zero-hallucination
  - deterministic
  - safety-critical
  - sil-2
  - asme-ptc-4-1
  - nfpa-85
  - industrial-automation
  - process-control

license: Apache-2.0

# ----------------------------------------------------------------------------
# AGENTS
# ----------------------------------------------------------------------------

agents:
  # ==========================================================================
  # AGENT 1: DATA INTAKE AGENT
  # ==========================================================================

  - name: data-intake-agent
    display_name: Data Intake Agent
    type: data_acquisition
    description: |
      High-frequency data acquisition from industrial control systems.

      Responsibilities:
      - Real-time data acquisition from DCS, PLC, CEMS (100 Hz)
      - Protocol translation (Modbus TCP, OPC UA → JSON)
      - Data quality validation (range checks, rate-of-change limits)
      - Temporal synchronization across data sources
      - Outlier detection and filtering
      - Engineering unit conversion

      Performance: <20ms acquisition latency
      Determinism: GUARANTEED

    implementation:
      language: python
      entry_point: agents/data_intake_agent.py
      class: DataIntakeAgent

    inputs:
      - name: dcs_endpoints
        description: DCS Modbus TCP registers or OPC UA nodes
        format: json
        schema: |
          {
            "protocol": "modbus_tcp" | "opcua",
            "host": "string",
            "port": integer,
            "tags": [
              {
                "name": "string",
                "register": integer,
                "data_type": "float32" | "int16" | "uint16",
                "units": "string"
              }
            ]
          }
        required: true

      - name: plc_endpoints
        description: PLC OPC UA subscriptions
        format: json
        required: true

      - name: cems_endpoints
        description: CEMS analyzer Modbus registers
        format: json
        required: true

    outputs:
      - name: validated_sensor_data
        description: Quality-validated sensor readings
        format: json
        schema: |
          {
            "timestamp": "ISO8601",
            "fuel_flow_kg_hr": number,
            "air_flow_m3_hr": number,
            "o2_percent": number,
            "nox_ppm": number,
            "co_ppm": number,
            "heat_output_mw": number,
            "data_quality_percent": number
          }

    tools:
      - read_combustion_data
      - validate_sensor_data
      - synchronize_data_streams

  # ==========================================================================
  # AGENT 2: COMBUSTION ANALYSIS AGENT
  # ==========================================================================

  - name: combustion-analysis-agent
    display_name: Combustion Analysis Agent
    type: analyzer
    description: |
      Real-time combustion efficiency and emissions analysis.

      Responsibilities:
      - Combustion efficiency calculation (ASME PTC 4.1 indirect method)
      - Heat loss analysis (stack, radiation, moisture, unburnt)
      - Thermal efficiency determination (direct method)
      - Emissions calculation (CO2, NOx, CO mass rates)
      - Flame stability monitoring
      - Performance scoring (0-100 scale)

      Standards: ASME PTC 4.1, EN 12952, ISO 50001
      Determinism: GUARANTEED (no ML/LLM)

    implementation:
      language: python
      entry_point: agents/combustion_analysis_agent.py
      class: CombustionAnalysisAgent

    inputs:
      - name: sensor_data
        description: Validated sensor data from DataIntakeAgent
        format: json
        required: true

      - name: fuel_properties
        description: Fuel composition and heating value
        format: json
        required: true

    outputs:
      - name: performance_metrics
        description: Comprehensive combustion performance analysis
        format: json
        schema: |
          {
            "combustion_efficiency_percent": number,
            "thermal_efficiency_percent": number,
            "excess_air_percent": number,
            "heat_losses": {
              "dry_flue_gas_percent": number,
              "moisture_percent": number,
              "unburnt_percent": number,
              "radiation_percent": number
            },
            "emissions": {
              "co2_kg_hr": number,
              "nox_ppm": number,
              "co_ppm": number
            },
            "performance_score": number
          }

    tools:
      - analyze_combustion_efficiency
      - calculate_heat_output
      - monitor_flame_stability

  # ==========================================================================
  # AGENT 3: CONTROL OPTIMIZER AGENT
  # ==========================================================================

  - name: control-optimizer-agent
    display_name: Control Optimizer Agent
    type: optimizer
    description: |
      Multi-objective optimization and PID control calculation.

      Responsibilities:
      - Cascade PID control (primary: heat output, secondary: O2)
      - Multi-objective optimization (efficiency + emissions + stability)
      - Feedforward compensation (fuel quality, ambient temp, load)
      - Anti-windup protection
      - Rate limiting and ramp control
      - Setpoint tracking

      Control Theory: Classical PID (textbook implementations)
      Optimization: Weighted sum, Pareto front, NSGA-II
      Determinism: GUARANTEED

    implementation:
      language: python
      entry_point: agents/control_optimizer_agent.py
      class: ControlOptimizerAgent

    inputs:
      - name: performance_metrics
        description: Current combustion performance from AnalysisAgent
        format: json
        required: true

      - name: control_setpoints
        description: Heat demand and emissions limits
        format: json
        schema: |
          {
            "heat_demand_mw": number,
            "o2_setpoint_percent": number,
            "emissions_limits": {
              "max_nox_ppm": number,
              "max_co_ppm": number
            },
            "safety_limits": {
              "max_fuel_flow_kg_hr": number,
              "min_o2_percent": number
            }
          }
        required: true

    outputs:
      - name: optimal_control_commands
        description: Optimized fuel and air setpoints
        format: json
        schema: |
          {
            "optimal_fuel_flow_kg_hr": number,
            "optimal_air_damper_percent": number,
            "predicted_efficiency_percent": number,
            "predicted_nox_ppm": number,
            "optimization_score": number,
            "convergence_status": string
          }

    tools:
      - optimize_fuel_air_ratio
      - calculate_pid_setpoints
      - adjust_burner_settings

  # ==========================================================================
  # AGENT 4: COMMAND EXECUTION AGENT
  # ==========================================================================

  - name: command-execution-agent
    display_name: Command Execution Agent
    type: executor
    description: |
      Safe execution of control commands to DCS/PLC.

      Responsibilities:
      - Pre-execution safety validation
      - Command execution (Modbus write, OPC UA method call)
      - Rate limiting and ramp control
      - Readback verification
      - Rollback on failure
      - Execution logging

      Safety: Triple-redundant interlocks (SIL-2)
      Determinism: GUARANTEED

    implementation:
      language: python
      entry_point: agents/command_execution_agent.py
      class: CommandExecutionAgent

    inputs:
      - name: control_commands
        description: Control commands from OptimizerAgent
        format: json
        required: true

      - name: safety_state
        description: Current safety interlock status
        format: json
        required: true

    outputs:
      - name: execution_result
        description: Command execution status and verification
        format: json
        schema: |
          {
            "execution_status": "success" | "failed" | "safety_blocked",
            "fuel_valve_position_percent": number,
            "air_damper_position_percent": number,
            "execution_time_ms": number,
            "safety_checks_passed": boolean,
            "errors": [string]
          }

    tools:
      - write_control_commands
      - validate_safety_interlocks

  # ==========================================================================
  # AGENT 5: AUDIT AND SAFETY AGENT
  # ==========================================================================

  - name: audit-and-safety-agent
    display_name: Audit and Safety Agent
    type: monitor
    description: |
      Continuous safety monitoring and audit trail management.

      Responsibilities:
      - Safety interlock monitoring (every 100ms)
      - Compliance logging (EPA, NFPA, ASME)
      - Provenance tracking (SHA-256 hash chains)
      - Report generation (performance, compliance, safety)
      - Alarm management
      - Emergency shutdown coordination

      Safety Rating: SIL-2 (IEC 61508)
      Audit Trail: Complete with SHA-256 provenance

    implementation:
      language: python
      entry_point: agents/audit_and_safety_agent.py
      class: AuditAndSafetyAgent

    inputs:
      - name: all_sensor_data
        description: Complete sensor data for safety checks
        format: json
        required: true

      - name: all_control_actions
        description: All control decisions for audit trail
        format: json
        required: true

    outputs:
      - name: safety_status
        description: Safety system status and violations
        format: json
        schema: |
          {
            "safety_status": "ok" | "warning" | "critical",
            "all_interlocks_ok": boolean,
            "active_violations": [
              {
                "violation_type": string,
                "severity": string,
                "action_required": string
              }
            ]
          }

      - name: provenance_record
        description: Complete calculation audit trail
        format: json
        schema: |
          {
            "provenance_hash": "SHA-256",
            "calculation_reproducible": boolean,
            "audit_trail_complete": boolean,
            "regulatory_compliant": boolean
          }

    tools:
      - generate_control_report
      - track_provenance

# ----------------------------------------------------------------------------
# PIPELINE
# ----------------------------------------------------------------------------

pipeline:
  name: combustion-control-pipeline
  description: End-to-end real-time combustion control workflow

  stages:
    - stage: 1
      name: Data Acquisition
      description: Acquire and validate sensor data from DCS/PLC/CEMS
      estimated_time: 10%
      target_latency_ms: 20
      agent: data-intake-agent
      action: read_and_validate_data

    - stage: 2
      name: Combustion Analysis
      description: Calculate efficiency and emissions using ASME PTC 4.1
      estimated_time: 20%
      target_latency_ms: 30
      agent: combustion-analysis-agent
      action: analyze_performance

    - stage: 3
      name: Control Optimization
      description: Calculate optimal fuel/air setpoints using PID + optimization
      estimated_time: 40%
      target_latency_ms: 40
      agent: control-optimizer-agent
      action: optimize_control

    - stage: 4
      name: Command Execution
      description: Execute control commands with safety validation
      estimated_time: 20%
      target_latency_ms: 30
      agent: command-execution-agent
      action: execute_commands

    - stage: 5
      name: Audit and Safety
      description: Log provenance and verify safety interlocks
      estimated_time: 10%
      target_latency_ms: 20
      agent: audit-and-safety-agent
      action: log_and_monitor

  performance:
    target_total_time: 100ms
    target_throughput: 10 control cycles per second

# ----------------------------------------------------------------------------
# DEPENDENCIES
# ----------------------------------------------------------------------------

dependencies:
  python: ">=3.11"

  packages:
    # Core framework
    - name: fastapi
      version: ">=0.109.0"
      purpose: API framework for REST endpoints

    - name: uvicorn
      version: ">=0.27.0"
      purpose: ASGI web server

    - name: pydantic
      version: ">=2.5.0"
      purpose: Data validation and schemas

    # Industrial protocols
    - name: pymodbus
      version: ">=3.5.4"
      purpose: Modbus TCP/RTU client

    - name: asyncua
      version: ">=1.0.4"
      purpose: OPC UA client (async)

    # Control algorithms
    - name: numpy
      version: ">=1.26.2"
      purpose: Numerical computations for control algorithms

    - name: scipy
      version: ">=1.11.4"
      purpose: Scientific computing (optimization, PID tuning)

    - name: simple-pid
      version: ">=2.0.0"
      purpose: PID controller implementation

    - name: cvxpy
      version: ">=1.4.1"
      purpose: Convex optimization (multi-objective)

    # Data processing
    - name: pandas
      version: ">=2.1.4"
      purpose: Time-series data processing

    # Database
    - name: asyncpg
      version: ">=0.29.0"
      purpose: PostgreSQL async driver

    - name: sqlalchemy
      version: ">=2.0.23"
      purpose: ORM for database operations

    - name: alembic
      version: ">=1.13.1"
      purpose: Database migrations

    # Caching
    - name: redis
      version: ">=5.0.1"
      purpose: Real-time state caching

    # Security
    - name: cryptography
      version: ">=41.0.7"
      purpose: Encryption and certificate management

    - name: python-jose
      version: ">=3.3.0"
      purpose: JWT token handling

    - name: hvac
      version: ">=2.1.0"
      purpose: HashiCorp Vault integration

    # Monitoring
    - name: prometheus-client
      version: ">=0.19.0"
      purpose: Metrics collection and export

    - name: opentelemetry-api
      version: ">=1.21.0"
      purpose: Distributed tracing

    - name: structlog
      version: ">=23.2.0"
      purpose: Structured logging

# ----------------------------------------------------------------------------
# DATA & REFERENCE FILES
# ----------------------------------------------------------------------------

data:
  - path: data/fuel_properties.json
    description: Thermodynamic properties of fuels (natural gas, oil, coal, biomass)
    format: json
    size: 800 lines
    sources: [Engineering ToolBox, Perry's Chemical Engineers' Handbook]

  - path: data/asme_ptc_coefficients.json
    description: ASME PTC 4.1 calculation coefficients and correlations
    format: json
    size: 600 lines
    source: ASME PTC 4.1

  - path: data/pid_tuning_rules.json
    description: PID tuning rules (Ziegler-Nichols, Cohen-Coon, IMC)
    format: json
    size: 300 lines
    sources: [Control Engineering textbooks]

# ----------------------------------------------------------------------------
# SCHEMAS
# ----------------------------------------------------------------------------

schemas:
  - path: schemas/sensor_data.schema.json
    description: Input sensor data contract
    format: json-schema
    size: 400 lines

  - path: schemas/control_commands.schema.json
    description: Output control commands contract
    format: json-schema
    size: 300 lines

  - path: schemas/provenance.schema.json
    description: Provenance record contract
    format: json-schema
    size: 250 lines

# ----------------------------------------------------------------------------
# DEPLOYMENT
# ----------------------------------------------------------------------------

deployment:
  kubernetes:
    manifests_path: deployment/
    kustomize_base: deployment/kustomize/base/
    environments: [development, staging, production]
    namespace: greenlang

  ci_cd:
    ci_workflow: .github/workflows/gl-005-ci.yaml
    cd_workflow: .github/workflows/gl-005-cd.yaml
    scheduled_workflow: .github/workflows/gl-005-scheduled.yaml

  resource_requirements:
    memory_mb: 512
    cpu_cores: 2
    gpu_required: false
    disk_space_gb: 10
    network_bandwidth_mbps: 100  # High bandwidth for 100 Hz data

  deployment_environments:
    development:
      replicas: 1
      auto_scaling: false

    staging:
      replicas: 2
      auto_scaling: true
      min_replicas: 2
      max_replicas: 4

    production:
      replicas: 3
      auto_scaling: true
      min_replicas: 3
      max_replicas: 10
      multi_region: true

# ----------------------------------------------------------------------------
# QUALITY GUARANTEES
# ----------------------------------------------------------------------------

guarantees:
  zero_hallucination: true
  deterministic: true
  reproducible: true
  audit_trail: complete
  safety_rated: SIL-2
  control_latency_ms: <100
  setpoint_tracking_accuracy_percent: 0.5

  performance:
    - <100ms control loop cycle time
    - <50ms control decision latency
    - <20ms Modbus read latency
    - <100ms OPC UA subscription delay
    - 10,000 sensor points/sec throughput

  accuracy_targets:
    efficiency_calculation: 98%
    emissions_calculation: 99%
    control_tracking: 99.5%

# ----------------------------------------------------------------------------
# COMPLIANCE
# ----------------------------------------------------------------------------

compliance:
  zero_secrets: true

  standards:
    - name: ASME PTC 4.1
      description: Fired Steam Generators Performance Test Codes
      scope: Efficiency calculation methodology

    - name: NFPA 85
      description: Boiler and Combustion Systems Hazards Code
      scope: Safety interlocks and emergency shutdown

    - name: IEC 61508
      description: Functional Safety of Electrical/Electronic/Programmable Systems
      scope: Safety-critical control (SIL-2)

    - name: EPA 40 CFR Part 60
      description: Standards of Performance for New Stationary Sources
      scope: Emissions monitoring and reporting

    - name: ISO 50001:2018
      description: Energy Management Systems
      scope: Performance KPIs and continuous improvement

  security_requirements:
    authentication: JWT with RS256 signature
    authorization: RBAC with least privilege
    encryption_at_rest: AES-256-GCM
    encryption_in_transit: TLS 1.3
    audit_logging: Complete with tamper-proof storage
    vulnerability_scanning: Weekly with zero high/critical
    secrets_management: HashiCorp Vault with auto-rotation

  data_governance:
    data_classification: Confidential
    retention_period: 7 years (regulatory compliance)
    backup_frequency: Hourly incremental, daily full
    disaster_recovery: RPO 15 minutes, RTO 1 hour

# ----------------------------------------------------------------------------
# METADATA
# ----------------------------------------------------------------------------

metadata:
  created: 2025-01-18
  updated: 2025-01-18
  greenlang_version: ">=1.0.0"
  pack_schema_version: 1.0

  repository:
    url: https://github.com/akshay-greenlang/Code-V1_GreenLang
    path: GreenLang_2030/agent_foundation/agents/GL-005

  documentation:
    readme: README.md
    architecture: docs/ARCHITECTURE.md
    tools: tools.py
    configuration: docs/CONFIGURATION_SCHEMA.md
    api: docs/API_REFERENCE.md

  support:
    team: Industrial Control Systems
    email: gl-005@greenlang.ai
    slack: "#gl-005-combustion-control"
    documentation: https://docs.greenlang.ai/agents/GL-005
    issue_tracker: https://github.com/greenlang/agents/issues?label=GL-005

  keywords:
    - combustion-control
    - real-time-control
    - pid-controller
    - industrial-automation
    - zero-hallucination
    - safety-critical
    - sil-2
    - process-control
    - emissions-control

# ============================================================================
# END OF PACK DEFINITION - GL-005 CombustionControlAgent
# ============================================================================
