# GL-003 SteamSystemAnalyzer Agent Specification
# Version: 1.0.0
# Date: 2025-11-17
# Status: PRODUCTION-READY

# ============================================================================
# SECTION 1: AGENT METADATA
# ============================================================================

agent_metadata:
  agent_id: "GL-003"
  name: "SteamSystemAnalyzer"
  version: "1.0.0"
  category: "Steam Systems"
  domain: "Industrial Steam Distribution and Efficiency"
  type: "Analyzer/Optimizer"
  complexity: "High"
  priority: "P0"  # Critical for energy efficiency
  market_size_usd: "$8B"
  target_deployment: "Q4 2025"
  regulatory_frameworks:
    - "ISO 50001:2018 Energy Management Systems"
    - "ASME PTC 19.1 Test Uncertainty"
    - "ASME Steam Tables Thermodynamic Properties"
    - "EPA Mandatory Greenhouse Gas Reporting Rule"
    - "DOE Steam System Assessment Tool (SSAT)"
    - "EU Energy Efficiency Directive 2012/27/EU"
    - "OSHA Process Safety Management (PSM)"

  business_metrics:
    total_addressable_market: "$8B annually"
    realistic_market_capture: "15% by 2030 ($1.2B)"
    carbon_reduction_potential: "150 Mt CO2e/year"
    average_cost_savings: "10-30% steam system costs"
    average_efficiency_gain: "15-25% energy savings"
    roi_range: "6-24 months payback"
    typical_plant_savings: "$50k-$300k/year"

  technical_classification:
    agent_type: "specialized_analyzer_optimizer"
    optimization_scope: "facility_wide_steam_system"
    sub_agent_coordination: true  # Coordinates with GL-002 (Boiler)
    integration_complexity: "high"
    real_time_requirements: true
    data_volume: "high"  # 100-1000 data points/sec
    calculation_complexity: "high"  # Thermodynamic calculations

  key_differentiators:
    - "Comprehensive steam trap monitoring (450+ traps typical)"
    - "Real-time leak detection and quantification"
    - "ASME-grade thermodynamic accuracy"
    - "Multi-pressure network optimization"
    - "Condensate recovery optimization"
    - "Economic impact quantification"
    - "Regulatory compliance automation"

# ============================================================================
# SECTION 2: DESCRIPTION
# ============================================================================

description:
  purpose: |
    Optimizes steam distribution systems for maximum energy efficiency and minimal losses.
    Analyzes steam generation, distribution networks, trap performance, leak detection,
    condensate recovery, and economic impact. Provides real-time monitoring, predictive
    maintenance, and automated optimization recommendations. Ensures compliance with
    ISO 50001, ASME standards, EPA regulations, and facility-specific requirements.

  strategic_context:
    global_impact: |
      Steam systems account for 30% of industrial energy use globally. Typical steam
      systems lose 10-30% of generated steam through leaks, failed traps, poor insulation,
      and inefficient condensate recovery. DOE studies show average payback of 1-3 years
      for steam system optimization investments.

    market_opportunity: |
      - 80% of industrial facilities use steam systems
      - Average facility has 200-500 steam traps (10-15% failure rate typical)
      - Steam losses typically 10-30% of generation
      - $8B annual opportunity in steam system optimization
      - Growing regulatory pressure on energy efficiency

    technology_readiness: "TRL 9 - Commercial deployment with proven savings"

    competitive_advantage: |
      Only platform combining:
      - ASME-grade thermodynamic calculations
      - Real-time multi-protocol data integration
      - Comprehensive trap population management
      - Economic optimization with multi-objective constraints
      - Regulatory compliance automation

  capabilities:
    core_analysis:
      - "Real-time steam generation and consumption monitoring"
      - "Multi-pressure network flow analysis and balancing"
      - "Steam quality analysis (dryness fraction, superheat)"
      - "Pressure drop calculation and optimization"
      - "Heat loss analysis (radiation, convection, conduction)"
      - "Energy balance calculation across system boundaries"

    trap_monitoring:
      - "Comprehensive trap population management (200-1000+ traps)"
      - "Real-time trap health monitoring and failure detection"
      - "Trap type identification and performance analysis"
      - "Economic impact quantification per trap"
      - "Maintenance prioritization and scheduling"
      - "Trap population optimization recommendations"

    leak_detection:
      - "Statistical leak detection from flow patterns"
      - "Acoustic monitoring integration"
      - "Thermal imaging analysis integration"
      - "Leak size quantification (kg/hr)"
      - "Economic impact calculation per leak"
      - "Repair prioritization matrix"

    condensate_recovery:
      - "Condensate return rate monitoring"
      - "Flash steam recovery analysis"
      - "Condensate pump performance monitoring"
      - "Water treatment cost optimization"
      - "Feedwater quality impact analysis"
      - "Recovery system efficiency optimization"

    economic_analysis:
      - "Steam cost calculation (fuel + water + treatment)"
      - "Loss quantification in monetary terms"
      - "ROI analysis for improvement projects"
      - "Carbon footprint calculation and pricing"
      - "Multi-year financial projections"
      - "Sensitivity analysis for key parameters"

  dependencies:
    - system: "GL-002 BoilerEfficiencyOptimizer"
      relationship: "receives_data_from"
      data_type: "steam generation data, boiler efficiency"
      frequency: "real-time (every 5-60 seconds)"
      criticality: "high"

    - system: "GL-001 ProcessHeatOrchestrator"
      relationship: "coordinates_with"
      data_type: "optimization directives, steam demand forecasts"
      frequency: "every 5-15 minutes"
      criticality: "medium"

    - system: "SCADA/DCS"
      relationship: "receives_data_from"
      data_type: "real-time sensor readings (flow, pressure, temperature)"
      frequency: "every 1-60 seconds"
      criticality: "critical"

    - system: "Steam Flow Meters"
      relationship: "integrates_with"
      data_type: "steam flow measurements"
      frequency: "real-time"
      criticality: "critical"

    - system: "Trap Monitoring System"
      relationship: "integrates_with"
      data_type: "trap health status, acoustic signatures"
      frequency: "every 1-15 minutes"
      criticality: "medium"

    - system: "ERP/CMMS"
      relationship: "coordinates_with"
      data_type: "maintenance schedules, cost data"
      frequency: "hourly to daily"
      criticality: "low"

# ============================================================================
# SECTION 3: TOOLS (Deterministic, Zero-Hallucination)
# ============================================================================

tools:
  tool_architecture:
    design_pattern: "tool_first"
    deterministic: true
    hallucination_prevention: "all_numeric_calculations_via_tools"
    provenance_tracking: true
    calculation_standards: ["ASME", "ISO", "DOE"]
    unit_consistency: "SI units primary, US customary secondary"

  tools_list:
    # ========================================================================
    # Tool 1: Steam System Balance Calculator
    # ========================================================================
    - tool_id: "calculate_steam_balance"
      name: "calculate_steam_balance"
      category: "calculation"
      deterministic: true
      priority: "high"

      description: |
        Calculates complete steam system mass and energy balance using ASME
        thermodynamic properties. Identifies losses, inefficiencies, and
        optimization opportunities across generation, distribution, and utilization.

      parameters:
        type: "object"
        properties:
          system_configuration:
            type: "object"
            properties:
              plant_id: {type: "string"}
              network_id: {type: "string"}
              pressure_levels:
                type: "array"
                items:
                  type: "object"
                  properties:
                    level_name: {type: "string"}
                    pressure_bar: {type: "number", minimum: 0.5, maximum: 200}
                    pipe_length_m: {type: "number", minimum: 0}
                    pipe_diameter_mm: {type: "number", minimum: 25}
                    insulation_type: {type: "string", enum: ["none", "mineral_wool", "fiberglass", "calcium_silicate"]}
                    insulation_thickness_mm: {type: "number", minimum: 0}

          generation_data:
            type: "object"
            properties:
              total_steam_generated_kg_hr: {type: "number", minimum: 0}
              generation_pressure_bar: {type: "number", minimum: 0}
              generation_temperature_c: {type: "number", minimum: 100}
              steam_quality: {type: "number", minimum: 0, maximum: 1}
              feedwater_temperature_c: {type: "number"}
              boiler_efficiency_percent: {type: "number", minimum: 50, maximum: 100}

          consumption_data:
            type: "array"
            items:
              type: "object"
              properties:
                consumer_id: {type: "string"}
                consumer_type: {type: "string"}
                steam_consumption_kg_hr: {type: "number", minimum: 0}
                inlet_pressure_bar: {type: "number"}
                inlet_temperature_c: {type: "number"}
                outlet_condition: {type: "string", enum: ["condensate", "vent", "process"]}

          condensate_data:
            type: "object"
            properties:
              total_condensate_returned_kg_hr: {type: "number", minimum: 0}
              return_temperature_c: {type: "number"}
              return_quality: {type: "string", enum: ["clean", "contaminated"]}
              flash_recovery_enabled: {type: "boolean"}

          environmental_conditions:
            type: "object"
            properties:
              ambient_temperature_c: {type: "number"}
              wind_speed_m_s: {type: "number", minimum: 0}
              humidity_percent: {type: "number", minimum: 0, maximum: 100}

        required: ["system_configuration", "generation_data"]

      returns:
        type: "object"
        properties:
          mass_balance:
            type: "object"
            properties:
              steam_generated_kg_hr: {type: "number"}
              steam_consumed_kg_hr: {type: "number"}
              steam_losses_kg_hr: {type: "number"}
              condensate_generated_kg_hr: {type: "number"}
              condensate_returned_kg_hr: {type: "number"}
              condensate_recovery_percent: {type: "number"}
              makeup_water_required_kg_hr: {type: "number"}
              balance_closure_percent: {type: "number"}

          energy_balance:
            type: "object"
            properties:
              total_energy_generated_gj_hr: {type: "number"}
              useful_energy_delivered_gj_hr: {type: "number"}
              energy_losses_gj_hr: {type: "number"}
              system_efficiency_percent: {type: "number"}
              specific_energy_consumption_gj_per_ton: {type: "number"}

          loss_breakdown:
            type: "object"
            properties:
              pipe_radiation_loss_kg_hr: {type: "number"}
              pipe_radiation_loss_percent: {type: "number"}
              valve_flange_loss_kg_hr: {type: "number"}
              valve_flange_loss_percent: {type: "number"}
              trap_loss_kg_hr: {type: "number"}
              trap_loss_percent: {type: "number"}
              leak_loss_kg_hr: {type: "number"}
              leak_loss_percent: {type: "number"}
              flash_loss_kg_hr: {type: "number"}
              flash_loss_percent: {type: "number"}
              unaccounted_loss_kg_hr: {type: "number"}
              unaccounted_loss_percent: {type: "number"}

          economic_impact:
            type: "object"
            properties:
              steam_generation_cost_usd_hr: {type: "number"}
              energy_loss_cost_usd_hr: {type: "number"}
              water_loss_cost_usd_hr: {type: "number"}
              treatment_cost_usd_hr: {type: "number"}
              total_loss_cost_usd_hr: {type: "number"}
              annual_loss_cost_usd: {type: "number"}

          carbon_footprint:
            type: "object"
            properties:
              co2_emissions_kg_hr: {type: "number"}
              co2_emissions_tons_yr: {type: "number"}
              carbon_cost_usd_hr: {type: "number"}

          improvement_potential:
            type: "object"
            properties:
              theoretical_minimum_losses_percent: {type: "number"}
              practical_improvement_percent: {type: "number"}
              potential_savings_usd_yr: {type: "number"}

      implementation:
        physics_formula: |
          Mass Balance:
            m_generated = m_consumed + m_losses
            m_losses = m_pipe + m_trap + m_leak + m_flash + m_unaccounted

          Energy Balance:
            E_in = m_steam × (h_steam - h_feedwater)
            E_out = m_consumed × (h_steam - h_condensate)
            E_loss = E_in - E_out
            η_system = E_out / E_in × 100

          Pipe Radiation Loss:
            Q_rad = ε × σ × A × (T_surface^4 - T_ambient^4)
            Q_conv = h_conv × A × (T_surface - T_ambient)
            m_loss = (Q_rad + Q_conv) / h_fg

        standards: ["ASME Steam Tables", "ISO 12241", "DOE SSAT"]
        accuracy: "±3% mass balance, ±5% energy balance"
        validation_method: "Cross-check with metered data, closure < 5%"

    # ========================================================================
    # Tool 2: Steam Trap Performance Analyzer
    # ========================================================================
    - tool_id: "analyze_trap_performance"
      name: "analyze_trap_performance"
      category: "analysis"
      deterministic: true
      priority: "high"

      description: |
        Analyzes steam trap population health, identifies failed traps, quantifies
        losses, and prioritizes maintenance actions. Supports thermostatic, mechanical,
        and thermodynamic trap types with specific failure signatures.

      parameters:
        type: "object"
        properties:
          trap_population:
            type: "array"
            items:
              type: "object"
              properties:
                trap_id: {type: "string"}
                trap_type: {type: "string", enum: ["thermostatic", "mechanical_float", "mechanical_inverted_bucket", "thermodynamic", "orifice"]}
                location: {type: "string"}
                installation_date: {type: "string", format: "date"}
                last_inspection_date: {type: "string", format: "date"}
                pressure_upstream_bar: {type: "number"}
                pressure_downstream_bar: {type: "number"}
                temperature_upstream_c: {type: "number"}
                temperature_downstream_c: {type: "number"}
                condensate_load_kg_hr: {type: "number"}
                operating_hours_yr: {type: "number"}

          monitoring_data:
            type: "object"
            properties:
              temperature_readings:
                type: "array"
                items:
                  type: "object"
                  properties:
                    trap_id: {type: "string"}
                    timestamp: {type: "string", format: "date-time"}
                    upstream_temp_c: {type: "number"}
                    downstream_temp_c: {type: "number"}

              acoustic_data:
                type: "array"
                items:
                  type: "object"
                  properties:
                    trap_id: {type: "string"}
                    timestamp: {type: "string", format: "date-time"}
                    sound_level_db: {type: "number"}
                    frequency_hz: {type: "number"}
                    pattern: {type: "string"}

          failure_criteria:
            type: "object"
            properties:
              temperature_delta_threshold_c: {type: "number", default: 5}
              acoustic_threshold_db: {type: "number", default: 65}
              efficiency_threshold_percent: {type: "number", default: 85}

          economic_parameters:
            type: "object"
            properties:
              steam_cost_usd_per_1000kg: {type: "number"}
              operating_hours_per_year: {type: "number", default: 8760}

        required: ["trap_population", "economic_parameters"]

      returns:
        type: "object"
        properties:
          population_summary:
            type: "object"
            properties:
              total_traps: {type: "integer"}
              operational_traps: {type: "integer"}
              failed_open_traps: {type: "integer"}
              failed_closed_traps: {type: "integer"}
              degraded_traps: {type: "integer"}
              unknown_status_traps: {type: "integer"}
              failure_rate_percent: {type: "number"}

          failed_trap_details:
            type: "array"
            items:
              type: "object"
              properties:
                trap_id: {type: "string"}
                trap_type: {type: "string"}
                location: {type: "string"}
                failure_mode: {type: "string", enum: ["blown_open", "blocked", "leaking", "degraded"]}
                failure_confidence: {type: "number"}
                steam_loss_kg_hr: {type: "number"}
                energy_loss_kw: {type: "number"}
                cost_impact_usd_hr: {type: "number"}
                annual_cost_impact_usd: {type: "number"}
                repair_priority: {type: "string", enum: ["critical", "high", "medium", "low"]}
                recommended_action: {type: "string"}
                estimated_repair_cost_usd: {type: "number"}
                payback_months: {type: "number"}

          total_losses:
            type: "object"
            properties:
              total_steam_loss_kg_hr: {type: "number"}
              total_energy_loss_gj_hr: {type: "number"}
              total_cost_impact_usd_hr: {type: "number"}
              annual_cost_impact_usd: {type: "number"}
              potential_savings_usd_yr: {type: "number"}

          maintenance_recommendations:
            type: "array"
            items:
              type: "object"
              properties:
                recommendation_type: {type: "string"}
                trap_count: {type: "integer"}
                estimated_cost_usd: {type: "number"}
                expected_savings_usd_yr: {type: "number"}
                priority: {type: "integer"}

      implementation:
        failure_detection_logic: |
          1. Blown Open (steam blowing through):
             - Downstream temp > (Upstream temp - 5°C)
             - High acoustic level (> 65 dB)
             - Continuous discharge pattern
             Loss = Steam flow through orifice (sonic/subsonic)

          2. Blocked (no condensate discharge):
             - Downstream temp < Saturation temp at downstream pressure
             - Low/no acoustic signal
             - Process backup or reduced efficiency
             Loss = Condensate backup impact on process

          3. Leaking (partial steam loss):
             - Moderate temp differential
             - Moderate acoustic level
             - Intermittent/irregular discharge
             Loss = Calculated from orifice flow equations

        loss_calculation: |
          For blown open trap:
            Flow depends on pressure ratio (sonic vs subsonic)

            If P_down/P_up < 0.528 (sonic):
              m_steam = 0.667 × A × P_up / sqrt(T_up)

            If P_down/P_up >= 0.528 (subsonic):
              m_steam = A × sqrt(2 × ρ × (P_up - P_down))

          Energy Loss = m_steam × h_fg
          Cost = Energy Loss × Steam Cost

        standards: ["DOE Steam Tip #10", "Spirax Sarco Engineering Handbook"]
        accuracy: "±15% loss estimation for failed traps"

    # ========================================================================
    # Tool 3: Leak Detection and Quantification
    # ========================================================================
    - tool_id: "detect_and_quantify_leaks"
      name: "detect_and_quantify_leaks"
      category: "detection"
      deterministic: true
      priority: "high"

      description: |
        Detects steam leaks using statistical analysis, acoustic monitoring, and
        thermal imaging data. Quantifies leak size, energy loss, and economic impact.
        Prioritizes repairs based on ROI analysis.

      parameters:
        type: "object"
        properties:
          detection_method:
            type: "string"
            enum: ["statistical", "acoustic", "thermal", "combined"]
            default: "combined"

          system_data:
            type: "object"
            properties:
              steam_flow_measurements:
                type: "array"
                items:
                  type: "object"
                  properties:
                    meter_id: {type: "string"}
                    location: {type: "string"}
                    timestamp: {type: "string", format: "date-time"}
                    flow_kg_hr: {type: "number"}
                    pressure_bar: {type: "number"}
                    temperature_c: {type: "number"}

              baseline_consumption:
                type: "object"
                properties:
                  expected_flow_kg_hr: {type: "number"}
                  variability_percent: {type: "number"}
                  seasonal_factors: {type: "object"}

          acoustic_survey_data:
            type: "array"
            items:
              type: "object"
              properties:
                survey_id: {type: "string"}
                location: {type: "string"}
                component_type: {type: "string"}
                sound_level_db: {type: "number"}
                frequency_peak_hz: {type: "number"}
                leak_detected: {type: "boolean"}
                leak_severity: {type: "string"}

          thermal_survey_data:
            type: "array"
            items:
              type: "object"
              properties:
                survey_id: {type: "string"}
                location: {type: "string"}
                component_type: {type: "string"}
                temperature_c: {type: "number"}
                ambient_temperature_c: {type: "number"}
                leak_detected: {type: "boolean"}

          sensitivity_settings:
            type: "object"
            properties:
              min_leak_size_kg_hr: {type: "number", default: 5}
              confidence_threshold: {type: "number", default: 0.8}
              statistical_significance: {type: "number", default: 0.05}

          economic_parameters:
            type: "object"
            properties:
              steam_cost_usd_per_1000kg: {type: "number"}
              repair_cost_per_leak_usd: {type: "number", default: 500}
              labor_rate_usd_per_hour: {type: "number", default: 75}

        required: ["detection_method", "system_data", "economic_parameters"]

      returns:
        type: "object"
        properties:
          detected_leaks:
            type: "array"
            items:
              type: "object"
              properties:
                leak_id: {type: "string"}
                location: {type: "string"}
                component_type: {type: "string"}
                detection_method: {type: "string"}
                detection_confidence: {type: "number"}
                leak_size_kg_hr: {type: "number"}
                leak_size_category: {type: "string", enum: ["small", "medium", "large", "critical"]}
                pressure_bar: {type: "number"}
                temperature_c: {type: "number"}
                energy_loss_kw: {type: "number"}
                cost_impact_usd_hr: {type: "number"}
                annual_cost_impact_usd: {type: "number"}
                repair_cost_usd: {type: "number"}
                payback_days: {type: "number"}
                priority_score: {type: "number"}
                priority_level: {type: "string", enum: ["critical", "high", "medium", "low"]}
                recommended_action: {type: "string"}
                repair_urgency: {type: "string"}

          summary_statistics:
            type: "object"
            properties:
              total_leaks_detected: {type: "integer"}
              leaks_by_size:
                type: "object"
                properties:
                  small: {type: "integer"}
                  medium: {type: "integer"}
                  large: {type: "integer"}
                  critical: {type: "integer"}
              leaks_by_component:
                type: "object"
              total_steam_loss_kg_hr: {type: "number"}
              total_energy_loss_gj_hr: {type: "number"}
              total_cost_impact_usd_hr: {type: "number"}
              annual_cost_impact_usd: {type: "number"}
              total_repair_cost_usd: {type: "number"}
              average_payback_days: {type: "number"}

          prioritized_repair_list:
            type: "array"
            items:
              type: "object"
              properties:
                rank: {type: "integer"}
                leak_id: {type: "string"}
                location: {type: "string"}
                annual_savings_usd: {type: "number"}
                repair_cost_usd: {type: "number"}
                payback_days: {type: "number"}
                priority_level: {type: "string"}

      implementation:
        statistical_detection: |
          1. Establish baseline consumption patterns
          2. Calculate expected flow based on production/weather
          3. Compare actual vs expected with statistical tests
          4. Identify anomalies exceeding confidence threshold
          5. Isolate leak location through metering network analysis

        leak_size_estimation: |
          Orifice Flow Equation (steam leaks typically sonic):

          For sonic flow (P_down/P_up < 0.528):
            m = C × A × P_up × sqrt(k / (R × T)) × ((2/(k+1))^((k+1)/(2(k-1))))

          Where:
            m = mass flow rate (kg/s)
            C = discharge coefficient (0.6-0.8)
            A = orifice area (m²)
            P_up = upstream pressure (Pa)
            k = specific heat ratio (1.3 for steam)
            R = gas constant for steam
            T = absolute temperature (K)

          Estimate orifice size from acoustic/visual/thermal data

        energy_loss_calculation: |
          E_loss = m_leak × h_fg

          Where:
            m_leak = leak mass flow rate (kg/s)
            h_fg = latent heat of vaporization at system pressure (kJ/kg)

        standards: ["DOE Steam Tip #06", "ASME PTC 19.5"]
        accuracy: "±20% for leak size estimation, ±10% for cost impact"

    # ========================================================================
    # Tool 4: Pressure Drop Calculator
    # ========================================================================
    - tool_id: "calculate_pressure_drop"
      name: "calculate_pressure_drop"
      category: "calculation"
      deterministic: true
      priority: "medium"

      description: |
        Calculates pressure drop through steam distribution network including
        pipes, fittings, valves, and equipment. Identifies excessive pressure
        drops and optimization opportunities.

      parameters:
        type: "object"
        properties:
          pipe_network:
            type: "array"
            items:
              type: "object"
              properties:
                segment_id: {type: "string"}
                pipe_length_m: {type: "number", minimum: 0}
                pipe_diameter_mm: {type: "number", minimum: 25}
                pipe_roughness_mm: {type: "number", default: 0.045}
                elevation_change_m: {type: "number"}
                fittings:
                  type: "array"
                  items:
                    type: "object"
                    properties:
                      fitting_type: {type: "string"}
                      quantity: {type: "integer"}
                      k_factor: {type: "number"}

          flow_conditions:
            type: "object"
            properties:
              mass_flow_rate_kg_hr: {type: "number", minimum: 0}
              inlet_pressure_bar: {type: "number", minimum: 0}
              inlet_temperature_c: {type: "number"}
              steam_quality: {type: "number", minimum: 0, maximum: 1}

        required: ["pipe_network", "flow_conditions"]

      returns:
        type: "object"
        properties:
          segment_analysis:
            type: "array"
            items:
              type: "object"
              properties:
                segment_id: {type: "string"}
                pressure_drop_bar: {type: "number"}
                pressure_drop_percent: {type: "number"}
                velocity_m_s: {type: "number"}
                reynolds_number: {type: "number"}
                flow_regime: {type: "string"}
                outlet_pressure_bar: {type: "number"}
                outlet_temperature_c: {type: "number"}
                friction_loss_bar: {type: "number"}
                fitting_loss_bar: {type: "number"}
                elevation_loss_bar: {type: "number"}

          total_pressure_drop:
            type: "object"
            properties:
              total_drop_bar: {type: "number"}
              total_drop_percent: {type: "number"}
              final_pressure_bar: {type: "number"}
              acceptable: {type: "boolean"}

          optimization_recommendations:
            type: "array"
            items:
              type: "object"
              properties:
                segment_id: {type: "string"}
                issue: {type: "string"}
                current_diameter_mm: {type: "number"}
                recommended_diameter_mm: {type: "number"}
                expected_improvement_percent: {type: "number"}
                estimated_cost_usd: {type: "number"}

      implementation:
        darcy_weisbach: |
          ΔP = f × (L/D) × (ρ × v²/2)

          Where:
            f = friction factor (from Moody chart or Colebrook equation)
            L = pipe length (m)
            D = pipe diameter (m)
            ρ = fluid density (kg/m³)
            v = flow velocity (m/s)

        fittings_loss: |
          ΔP_fittings = Σ(K × ρ × v²/2)

          K factors for common fittings:
            - 90° elbow: K = 0.9
            - 45° elbow: K = 0.4
            - Tee (flow through): K = 0.6
            - Gate valve (fully open): K = 0.15
            - Globe valve (fully open): K = 10

        standards: ["ASME B31.1", "Crane TP-410"]
        accuracy: "±10% pressure drop calculation"

    # ========================================================================
    # Tool 5: Condensate Recovery Optimizer
    # ========================================================================
    - tool_id: "optimize_condensate_recovery"
      name: "optimize_condensate_recovery"
      category: "optimization"
      deterministic: true
      priority: "medium"

      description: |
        Optimizes condensate recovery system performance including return rates,
        flash steam recovery, pump efficiency, and water treatment costs.

      parameters:
        type: "object"
        properties:
          current_system:
            type: "object"
            properties:
              total_condensate_generated_kg_hr: {type: "number"}
              condensate_returned_kg_hr: {type: "number"}
              return_temperature_c: {type: "number"}
              flash_recovery_enabled: {type: "boolean"}
              deaeration_enabled: {type: "boolean"}
              pumping_system:
                type: "object"
                properties:
                  pump_count: {type: "integer"}
                  pump_capacity_kg_hr: {type: "number"}
                  pump_efficiency_percent: {type: "number"}
                  pump_power_kw: {type: "number"}

          loss_points:
            type: "array"
            items:
              type: "object"
              properties:
                loss_point_id: {type: "string"}
                location: {type: "string"}
                condensate_lost_kg_hr: {type: "number"}
                loss_reason: {type: "string"}
                recovery_feasible: {type: "boolean"}

          water_economics:
            type: "object"
            properties:
              makeup_water_cost_usd_per_m3: {type: "number"}
              treatment_cost_usd_per_m3: {type: "number"}
              disposal_cost_usd_per_m3: {type: "number"}
              energy_to_heat_feedwater_gj_per_m3: {type: "number"}

        required: ["current_system", "water_economics"]

      returns:
        type: "object"
        properties:
          current_performance:
            type: "object"
            properties:
              recovery_rate_percent: {type: "number"}
              condensate_returned_kg_hr: {type: "number"}
              condensate_lost_kg_hr: {type: "number"}
              flash_steam_recovered_kg_hr: {type: "number"}
              energy_recovered_gj_hr: {type: "number"}
              water_cost_savings_usd_hr: {type: "number"}
              treatment_cost_savings_usd_hr: {type: "number"}
              energy_cost_savings_usd_hr: {type: "number"}

          optimization_opportunities:
            type: "array"
            items:
              type: "object"
              properties:
                opportunity_id: {type: "string"}
                description: {type: "string"}
                condensate_recovery_increase_kg_hr: {type: "number"}
                energy_savings_gj_yr: {type: "number"}
                cost_savings_usd_yr: {type: "number"}
                implementation_cost_usd: {type: "number"}
                payback_months: {type: "number"}
                priority: {type: "string"}

          optimized_system:
            type: "object"
            properties:
              target_recovery_rate_percent: {type: "number"}
              additional_recovery_kg_hr: {type: "number"}
              total_savings_usd_yr: {type: "number"}
              total_investment_usd: {type: "number"}
              overall_payback_months: {type: "number"}

      implementation:
        flash_steam_calculation: |
          Flash steam formation when condensate pressure drops:

          x_flash = (h_1 - h_f2) / h_fg2

          Where:
            x_flash = flash steam fraction
            h_1 = enthalpy of condensate at high pressure
            h_f2 = enthalpy of saturated liquid at low pressure
            h_fg2 = latent heat at low pressure

        energy_recovery_value: |
          E_recovery = m_condensate × Cp × (T_return - T_makeup)

          Value = E_recovery × (Fuel_cost / Boiler_efficiency)

        standards: ["DOE Steam Tip #23", "DOE Steam Tip #26"]
        accuracy: "±5% energy value calculation"

    # ========================================================================
    # Tool 6: Economic Impact Analyzer
    # ========================================================================
    - tool_id: "analyze_economic_impact"
      name: "analyze_economic_impact"
      category: "analysis"
      deterministic: true
      priority: "high"

      description: |
        Calculates comprehensive economic impact of steam system losses including
        fuel costs, water costs, treatment costs, carbon pricing, and ROI analysis
        for improvement projects.

      parameters:
        type: "object"
        properties:
          system_losses:
            type: "object"
            properties:
              steam_losses_kg_hr: {type: "number"}
              energy_losses_gj_hr: {type: "number"}
              condensate_losses_kg_hr: {type: "number"}
              breakdown_by_category:
                type: "object"
                properties:
                  pipe_losses_kg_hr: {type: "number"}
                  trap_losses_kg_hr: {type: "number"}
                  leak_losses_kg_hr: {type: "number"}
                  flash_losses_kg_hr: {type: "number"}

          cost_parameters:
            type: "object"
            properties:
              fuel_cost_usd_per_gj: {type: "number"}
              electricity_cost_usd_per_kwh: {type: "number"}
              water_cost_usd_per_m3: {type: "number"}
              treatment_cost_usd_per_m3: {type: "number"}
              disposal_cost_usd_per_m3: {type: "number"}
              carbon_price_usd_per_ton: {type: "number"}
              boiler_efficiency_percent: {type: "number"}
              operating_hours_per_year: {type: "number", default: 8760}

          improvement_projects:
            type: "array"
            items:
              type: "object"
              properties:
                project_id: {type: "string"}
                description: {type: "string"}
                loss_reduction_kg_hr: {type: "number"}
                implementation_cost_usd: {type: "number"}
                annual_maintenance_cost_usd: {type: "number", default: 0}
                project_lifetime_years: {type: "number", default: 10}

          financial_parameters:
            type: "object"
            properties:
              discount_rate: {type: "number", default: 0.08}
              inflation_rate: {type: "number", default: 0.03}
              tax_rate: {type: "number", default: 0.21}

        required: ["system_losses", "cost_parameters"]

      returns:
        type: "object"
        properties:
          current_costs:
            type: "object"
            properties:
              fuel_cost_usd_hr: {type: "number"}
              fuel_cost_usd_yr: {type: "number"}
              water_cost_usd_hr: {type: "number"}
              water_cost_usd_yr: {type: "number"}
              treatment_cost_usd_hr: {type: "number"}
              treatment_cost_usd_yr: {type: "number"}
              carbon_cost_usd_hr: {type: "number"}
              carbon_cost_usd_yr: {type: "number"}
              total_cost_usd_hr: {type: "number"}
              total_cost_usd_yr: {type: "number"}

          cost_breakdown_by_category:
            type: "object"
            properties:
              pipe_losses_usd_yr: {type: "number"}
              trap_losses_usd_yr: {type: "number"}
              leak_losses_usd_yr: {type: "number"}
              flash_losses_usd_yr: {type: "number"}

          project_financials:
            type: "array"
            items:
              type: "object"
              properties:
                project_id: {type: "string"}
                description: {type: "string"}
                annual_savings_usd: {type: "number"}
                implementation_cost_usd: {type: "number"}
                simple_payback_months: {type: "number"}
                npv_usd: {type: "number"}
                irr_percent: {type: "number"}
                benefit_cost_ratio: {type: "number"}
                recommendation: {type: "string"}
                priority: {type: "integer"}

          portfolio_analysis:
            type: "object"
            properties:
              total_investment_usd: {type: "number"}
              total_annual_savings_usd: {type: "number"}
              portfolio_payback_months: {type: "number"}
              portfolio_npv_usd: {type: "number"}
              portfolio_irr_percent: {type: "number"}

      implementation:
        cost_calculation: |
          Fuel Cost = (Energy Loss / Boiler Efficiency) × Fuel Unit Cost

          Water Cost = (Steam Loss + Condensate Loss) × Water Unit Cost

          Treatment Cost = Makeup Water × Treatment Unit Cost

          Carbon Cost = (Fuel Energy / Boiler Efficiency) × Emission Factor × Carbon Price

        npv_calculation: |
          NPV = Σ[t=1 to n] (CF_t / (1 + r)^t) - Initial Investment

          Where:
            CF_t = Cash flow in year t (savings - maintenance)
            r = discount rate
            n = project lifetime

        irr_calculation: |
          Find r where NPV = 0:
          0 = Σ[t=1 to n] (CF_t / (1 + IRR)^t) - Initial Investment

        standards: ["FEMP LCC Guidelines", "DOE Industrial Assessment Centers"]
        accuracy: "±5% cost estimation"

# ============================================================================
# SECTION 4: INPUT/OUTPUT SCHEMAS
# ============================================================================

input_schema:
  type: "object"
  properties:
    analysis_request:
      type: "object"
      properties:
        request_id: {type: "string"}
        plant_id: {type: "string"}
        network_id: {type: "string"}
        analysis_type:
          type: "string"
          enum: ["quick_scan", "comprehensive", "trap_survey", "leak_detection", "economic_analysis"]

        time_period:
          type: "object"
          properties:
            start_time: {type: "string", format: "date-time"}
            end_time: {type: "string", format: "date-time"}

        data_sources:
          type: "array"
          items:
            type: "object"
            properties:
              source_type: {type: "string"}
              connection_string: {type: "string"}
              authentication: {type: "object"}

        analysis_options:
          type: "object"
          properties:
            include_trap_analysis: {type: "boolean", default: true}
            include_leak_detection: {type: "boolean", default: true}
            include_pressure_drop: {type: "boolean", default: true}
            include_condensate_optimization: {type: "boolean", default: true}
            include_economic_impact: {type: "boolean", default: true}
            sensitivity_analysis: {type: "boolean", default: false}

output_schema:
  type: "object"
  properties:
    analysis_result:
      type: "object"
      properties:
        request_id: {type: "string"}
        status: {type: "string", enum: ["completed", "partial", "failed"]}
        timestamp: {type: "string", format: "date-time"}

        executive_summary:
          type: "object"
          properties:
            total_steam_losses_kg_hr: {type: "number"}
            loss_percentage_of_generation: {type: "number"}
            total_energy_waste_gj_hr: {type: "number"}
            annual_cost_impact_usd: {type: "number"}
            potential_savings_usd_yr: {type: "number"}
            recommended_priority_actions: {type: "array"}

        detailed_findings:
          type: "object"
          properties:
            steam_balance: {type: "object"}
            trap_analysis: {type: "object"}
            leak_detection: {type: "object"}
            pressure_analysis: {type: "object"}
            condensate_optimization: {type: "object"}
            economic_analysis: {type: "object"}

        recommendations:
          type: "array"
          items:
            type: "object"
            properties:
              recommendation_id: {type: "string"}
              category: {type: "string"}
              title: {type: "string"}
              description: {type: "string"}
              savings_usd_yr: {type: "number"}
              implementation_cost_usd: {type: "number"}
              payback_months: {type: "number"}
              priority: {type: "integer"}

        compliance_status:
          type: "object"
          properties:
            iso_50001_compliant: {type: "boolean"}
            issues: {type: "array"}

        metadata:
          type: "object"
          properties:
            data_quality_score: {type: "number"}
            confidence_level: {type: "string"}
            analysis_duration_seconds: {type: "number"}

# ============================================================================
# SECTION 5: INTEGRATION SPECIFICATIONS
# ============================================================================

integrations:
  data_sources:
    - protocol: "OPC UA"
      version: "1.04"
      security: ["None", "Sign", "SignAndEncrypt"]
      authentication: ["Anonymous", "UserName", "Certificate"]
      data_types: ["Float", "Integer", "Boolean", "String"]
      update_rate_ms: [100, 1000, 5000, 60000]

    - protocol: "Modbus TCP/IP"
      version: "Modbus Application Protocol v1.1b3"
      function_codes: [3, 4, 6, 16]
      data_types: ["Holding Register", "Input Register"]
      polling_rate_ms: [1000, 5000, 10000]

    - protocol: "MQTT"
      version: "3.1.1, 5.0"
      qos_levels: [0, 1, 2]
      topics:
        - "steam/{plant_id}/{network_id}/generation"
        - "steam/{plant_id}/{network_id}/consumption"
        - "steam/{plant_id}/traps/+/status"
        - "steam/{plant_id}/leaks/+/alert"

    - protocol: "REST API"
      methods: ["GET", "POST", "PUT"]
      authentication: ["Bearer Token", "API Key", "OAuth2"]
      formats: ["JSON", "XML"]
      rate_limits: "100 req/min"

  upstream_agents:
    - agent_id: "GL-002"
      name: "BoilerEfficiencyOptimizer"
      data_exchange:
        receives:
          - "steam_generation_rate_kg_hr"
          - "generation_pressure_bar"
          - "generation_temperature_c"
          - "boiler_efficiency_percent"
          - "feedwater_temperature_c"
        frequency: "every 5 minutes"

    - agent_id: "GL-001"
      name: "ProcessHeatOrchestrator"
      data_exchange:
        receives:
          - "optimization_directives"
          - "steam_demand_forecast"
        sends:
          - "steam_system_status"
          - "available_capacity"
        frequency: "every 15 minutes"

  external_systems:
    - system: "ERP (SAP/Oracle)"
      integration_type: "API"
      data_exchange:
        receives:
          - "production_schedule"
          - "maintenance_plans"
          - "cost_centers"
        sends:
          - "energy_consumption"
          - "maintenance_requests"
          - "cost_allocations"
      frequency: "hourly"

    - system: "CMMS (Maximo/SAP PM)"
      integration_type: "API"
      data_exchange:
        receives:
          - "maintenance_history"
          - "asset_registry"
        sends:
          - "work_orders"
          - "failure_predictions"
      frequency: "real-time"

# ============================================================================
# SECTION 6: PERFORMANCE REQUIREMENTS
# ============================================================================

performance_requirements:
  latency:
    data_ingestion_max_ms: 1000
    analysis_cycle_max_seconds: 300
    api_response_max_ms: 200
    alert_notification_max_seconds: 10

  throughput:
    data_points_per_second: 1000
    concurrent_analyses: 10
    api_requests_per_minute: 1000

  availability:
    uptime_percent: 99.9
    max_downtime_per_month_minutes: 43.2
    recovery_time_objective_minutes: 15
    recovery_point_objective_minutes: 5

  scalability:
    max_plants_supported: 1000
    max_steam_networks_per_plant: 10
    max_traps_per_plant: 10000
    max_data_points_per_plant: 5000
    data_retention_days: 365

  accuracy:
    mass_balance_closure_percent: 95
    energy_balance_accuracy_percent: 95
    trap_failure_detection_accuracy_percent: 85
    leak_size_estimation_accuracy_percent: 80
    cost_calculation_accuracy_percent: 90

# ============================================================================
# SECTION 7: QUALITY ATTRIBUTES
# ============================================================================

quality_attributes:
  determinism:
    requirement: "100% deterministic calculations"
    verification: "Repeatability testing with identical inputs"
    hallucination_prevention: "All numeric outputs from tool functions"

  reliability:
    mean_time_between_failures_hours: 720
    mean_time_to_repair_minutes: 30
    error_rate_target_percent: 0.1

  maintainability:
    code_coverage_percent: 85
    cyclomatic_complexity_max: 10
    documentation_completeness_percent: 100

  security:
    encryption_at_rest: "AES-256"
    encryption_in_transit: "TLS 1.3"
    authentication: "JWT with expiration"
    authorization: "RBAC"
    audit_logging: "All operations logged"

  usability:
    setup_time_minutes: 30
    training_time_hours: 4
    report_generation_seconds: 30

  interoperability:
    standard_protocols: ["OPC UA", "Modbus", "MQTT"]
    data_formats: ["JSON", "XML", "CSV"]
    api_standard: "OpenAPI 3.0"

# ============================================================================
# SECTION 8: COMPLIANCE REQUIREMENTS
# ============================================================================

compliance_requirements:
  energy_management:
    standard: "ISO 50001:2018"
    requirements:
      - "Energy baseline establishment"
      - "Performance indicator tracking"
      - "Improvement opportunity identification"
      - "Action plan implementation"
      - "Management review documentation"

  measurement_uncertainty:
    standard: "ASME PTC 19.1"
    requirements:
      - "Uncertainty analysis for all calculations"
      - "Instrument calibration tracking"
      - "Data quality assessment"

  greenhouse_gas_reporting:
    standard: "EPA 40 CFR Part 98"
    requirements:
      - "CO2 emissions calculation"
      - "Data quality standards"
      - "Reporting format compliance"

  energy_efficiency:
    standard: "EU Directive 2012/27/EU"
    requirements:
      - "Energy audit compliance"
      - "Savings verification"
      - "Reporting standards"

  safety:
    standard: "OSHA PSM 29 CFR 1910.119"
    requirements:
      - "Process safety information"
      - "Operating procedures"
      - "Emergency planning"

# ============================================================================
# SECTION 9: DEPLOYMENT CONFIGURATION
# ============================================================================

deployment:
  infrastructure:
    compute:
      cpu_cores: 4
      memory_gb: 8
      storage_gb: 100

    services:
      - name: "postgresql"
        version: "15"
        purpose: "Historical data storage"
      - name: "redis"
        version: "7"
        purpose: "Real-time caching"
      - name: "prometheus"
        version: "2.45"
        purpose: "Metrics collection"
      - name: "grafana"
        version: "10.0"
        purpose: "Visualization"

  environments:
    - name: "development"
      replicas: 1
      resources:
        cpu: "2"
        memory: "4Gi"

    - name: "staging"
      replicas: 2
      resources:
        cpu: "4"
        memory: "8Gi"

    - name: "production"
      replicas: 3
      resources:
        cpu: "4"
        memory: "8Gi"
      auto_scaling:
        min_replicas: 3
        max_replicas: 10
        cpu_threshold_percent: 70

# ============================================================================
# SECTION 10: MONITORING & ALERTING
# ============================================================================

monitoring:
  metrics:
    business_metrics:
      - name: "steam_losses_kg_hr"
        type: "gauge"
        labels: ["plant_id", "loss_type"]
      - name: "energy_waste_gj_hr"
        type: "gauge"
        labels: ["plant_id"]
      - name: "cost_impact_usd_hr"
        type: "gauge"
        labels: ["plant_id", "cost_category"]
      - name: "trap_failure_count"
        type: "gauge"
        labels: ["plant_id", "trap_type"]
      - name: "leak_count"
        type: "gauge"
        labels: ["plant_id", "severity"]

    technical_metrics:
      - name: "analysis_duration_seconds"
        type: "histogram"
        buckets: [1, 5, 10, 30, 60, 300]
      - name: "api_request_duration_seconds"
        type: "histogram"
        buckets: [0.01, 0.05, 0.1, 0.5, 1.0]
      - name: "data_processing_latency_seconds"
        type: "histogram"
      - name: "error_count"
        type: "counter"
        labels: ["error_type", "severity"]

  alerts:
    - name: "HighSteamLosses"
      condition: "steam_losses_kg_hr > 1000"
      severity: "critical"
      notification: ["email", "slack"]

    - name: "TrapFailureSpike"
      condition: "trap_failure_count > 20"
      severity: "warning"
      notification: ["email"]

    - name: "SystemUnavailable"
      condition: "up == 0"
      duration: "5m"
      severity: "critical"
      notification: ["email", "slack", "pagerduty"]

# ============================================================================
# END OF SPECIFICATION
# ============================================================================

metadata:
  specification_version: "1.0.0"
  last_updated: "2025-11-17"
  author: "GreenLang Engineering"
  status: "PRODUCTION-READY"
  review_cycle: "quarterly"
  next_review_date: "2026-02-17"
