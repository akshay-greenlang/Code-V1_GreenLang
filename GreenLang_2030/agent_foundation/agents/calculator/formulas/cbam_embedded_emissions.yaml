---
formula_id: "cbam_embedded_emissions"
name: "CBAM Embedded Emissions Calculation"
standard: "EU CBAM"
version: "1.0"
description: "Calculate embedded emissions for CBAM (Carbon Border Adjustment Mechanism) reporting"

parameters:
  - name: production_quantity
    type: float
    unit: tonnes
    required: true
    validation:
      min: 0
      max: 10000000
    description: "Quantity of goods produced"

  - name: material_type
    type: string
    required: true
    validation:
      allowed_values: ["cement", "steel", "aluminium", "fertilizer", "electricity", "hydrogen"]
    description: "Type of CBAM-covered material"

  - name: production_country
    type: string
    required: true
    description: "Country of production (ISO code)"

  - name: production_process
    type: string
    required: true
    description: "Production process type"

  - name: direct_emissions_t_co2e
    type: float
    unit: t_co2e
    required: false
    description: "Direct emissions if available (otherwise calculated)"

calculation:
  steps:
    - step: 1
      description: "Lookup specific embedded emissions factor"
      operation: lookup
      table: emission_factors
      lookup_keys:
        category: "cbam"
        activity_type: "{production_process}"
        material_or_fuel: "{material_type}"
        region: "{production_country}"
      output: emission_factor_t_co2e_per_tonne

    - step: 2
      description: "Calculate total embedded emissions"
      operation: multiply
      operands:
        - production_quantity
        - emission_factor_t_co2e_per_tonne
      output: embedded_emissions_t_co2e

output:
  value: embedded_emissions_t_co2e
  unit: "t_co2e"
  precision: 3  # CBAM requires 3 decimal places minimum

metadata:
  category: "CBAM"
  subcategory: "Embedded Emissions"
  regulation: "EU Regulation 2023/956"
  cbam_product_categories:
    - cement
    - electricity
    - fertilizers
    - iron_and_steel
    - aluminium
    - hydrogen
  created_at: "2025-01-15"
  last_updated: "2025-01-15"
  notes: "CBAM implementation transitional period ends Dec 31, 2025"
