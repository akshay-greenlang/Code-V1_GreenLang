# ConfigMaps for GreenLang AI Agents

---
# Application Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: greenlang-config
  namespace: greenlang-ai
  labels:
    app: greenlang-agent
data:
  # Application settings
  APP_NAME: "GreenLang AI Agent"
  APP_VERSION: "1.0.0"
  ENVIRONMENT: "production"
  LOG_LEVEL: "INFO"
  LOG_FORMAT: "json"

  # Server configuration
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "8000"
  MAX_WORKERS: "4"
  WORKER_TIMEOUT: "60"
  KEEPALIVE_TIMEOUT: "5"
  GRACEFUL_TIMEOUT: "30"

  # Agent configuration
  AGENT_TYPE: "conversational"
  MAX_CONCURRENT_TASKS: "10"
  TASK_TIMEOUT: "300"
  AGENT_MEMORY_SIZE: "1000"
  AGENT_TEMPERATURE: "0.7"
  AGENT_MAX_TOKENS: "2048"

  # RAG configuration
  RAG_ENABLED: "true"
  EMBEDDING_MODEL: "all-MiniLM-L6-v2"
  VECTOR_DB_TYPE: "chromadb"
  CHUNK_SIZE: "512"
  CHUNK_OVERLAP: "50"
  MAX_RETRIEVAL_RESULTS: "5"
  SIMILARITY_THRESHOLD: "0.7"

  # Cache configuration
  CACHE_ENABLED: "true"
  CACHE_TTL: "3600"
  CACHE_MAX_SIZE: "1000"

  # Monitoring configuration
  METRICS_ENABLED: "true"
  METRICS_PORT: "9090"
  TRACING_ENABLED: "true"
  TRACING_SAMPLE_RATE: "0.1"

  # Rate limiting
  RATE_LIMIT_ENABLED: "true"
  RATE_LIMIT_REQUESTS: "100"
  RATE_LIMIT_WINDOW: "60"

  # Health check configuration
  HEALTH_CHECK_INTERVAL: "30"
  STARTUP_TIMEOUT: "120"

  # External service URLs
  VECTOR_DB_URL: "http://chromadb-service:8000"
  REDIS_HOST: "redis-service"
  REDIS_PORT: "6379"
  POSTGRES_HOST: "postgres-service"
  POSTGRES_PORT: "5432"

  # Feature flags
  ENABLE_STREAMING: "true"
  ENABLE_FUNCTION_CALLING: "true"
  ENABLE_MULTI_MODAL: "false"
  ENABLE_GUARDRAILS: "true"

---
# Agent Configuration File
apiVersion: v1
kind: ConfigMap
metadata:
  name: greenlang-agent-config
  namespace: greenlang-ai
  labels:
    app: greenlang-agent
data:
  agent_config.yaml: |
    agent:
      name: "GreenLang Agent"
      version: "1.0.0"
      type: "conversational"

      llm:
        provider: "anthropic"
        model: "claude-3-opus"
        temperature: 0.7
        max_tokens: 2048
        streaming: true

      memory:
        type: "buffer"
        max_size: 1000
        persistence: true

      tools:
        enabled: true
        allowed_tools:
          - web_search
          - calculator
          - code_interpreter
          - file_system

      guardrails:
        enabled: true
        content_moderation: true
        pii_detection: true
        prompt_injection_detection: true
        output_validation: true

      rag:
        enabled: true
        vector_db:
          type: "chromadb"
          url: "http://chromadb-service:8000"
          collection: "greenlang_docs"
        embedding:
          model: "all-MiniLM-L6-v2"
          dimension: 384
        retrieval:
          top_k: 5
          similarity_threshold: 0.7
          rerank: true

      logging:
        level: "INFO"
        format: "json"
        structured: true

      monitoring:
        metrics:
          enabled: true
          port: 9090
        tracing:
          enabled: true
          exporter: "jaeger"
          endpoint: "http://jaeger-collector:14268/api/traces"

      security:
        authentication: "api_key"
        authorization: "rbac"
        encryption: "tls"
        rate_limiting:
          enabled: true
          requests_per_minute: 100

---
# Logging Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: greenlang-logging-config
  namespace: greenlang-ai
  labels:
    app: greenlang-agent
data:
  logging.yaml: |
    version: 1
    disable_existing_loggers: false

    formatters:
      json:
        class: pythonjsonlogger.jsonlogger.JsonFormatter
        format: '%(asctime)s %(name)s %(levelname)s %(message)s'
      standard:
        format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        datefmt: '%Y-%m-%d %H:%M:%S'

    handlers:
      console:
        class: logging.StreamHandler
        level: INFO
        formatter: json
        stream: ext://sys.stdout

      file:
        class: logging.handlers.RotatingFileHandler
        level: DEBUG
        formatter: json
        filename: /var/log/greenlang/agent.log
        maxBytes: 10485760  # 10MB
        backupCount: 5

    loggers:
      greenlang:
        level: INFO
        handlers: [console, file]
        propagate: false

      uvicorn:
        level: INFO
        handlers: [console]
        propagate: false

    root:
      level: INFO
      handlers: [console]

---
# Prometheus Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: greenlang-prometheus-config
  namespace: greenlang-ai
  labels:
    app: greenlang-agent
data:
  prometheus.yaml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    scrape_configs:
    - job_name: 'greenlang-agents'
      kubernetes_sd_configs:
      - role: pod
        namespaces:
          names:
          - greenlang-ai
      relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)
      - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
        action: replace
        regex: ([^:]+)(?::\d+)?;(\d+)
        replacement: $1:$2
        target_label: __address__