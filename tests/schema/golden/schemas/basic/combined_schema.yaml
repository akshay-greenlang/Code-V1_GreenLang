# Combined Schema Test
# Tests: Complex schema with multiple constraint types
# GL-FOUND-X-002 Golden Test

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "gl://schemas/test/combined@1.0.0"
title: "Combined Constraints Test Schema"
description: "Schema combining multiple constraint types for comprehensive testing"
type: object

required:
  - activity_id
  - reporting_period
  - energy_data
  - status

properties:
  activity_id:
    type: string
    description: "Unique activity identifier"
    pattern: "^ACT-[0-9]{4}-[A-Z]{3}-[0-9]{6}$"
    minLength: 19
    maxLength: 19

  reporting_period:
    type: object
    required:
      - start_date
      - end_date
    properties:
      start_date:
        type: string
        format: date
      end_date:
        type: string
        format: date
      fiscal_year:
        type: integer
        minimum: 2000
        maximum: 2100

  energy_data:
    type: object
    required:
      - consumption
      - source
    properties:
      consumption:
        type: object
        required:
          - value
          - unit
        properties:
          value:
            type: number
            minimum: 0
            maximum: 1000000000
          unit:
            type: string
            enum:
              - kWh
              - MWh
              - GJ
        x-gl-unit:
          dimension: energy
          canonical: kWh
      source:
        type: string
        enum:
          - grid
          - solar
          - wind
          - natural_gas
          - coal
          - nuclear
          - hydro
          - other
      renewable_percentage:
        type: number
        minimum: 0
        maximum: 100

  emissions:
    type: object
    properties:
      scope1:
        type: number
        minimum: 0
      scope2:
        type: number
        minimum: 0
      scope3:
        type: number
        minimum: 0
      total:
        type: number
        minimum: 0
      unit:
        type: string
        enum:
          - kgCO2e
          - tCO2e

  status:
    type: string
    enum:
      - draft
      - submitted
      - verified
      - approved
      - rejected

  tags:
    type: array
    items:
      type: string
      minLength: 1
      maxLength: 50
    maxItems: 20
    uniqueItems: true

  metadata:
    type: object
    properties:
      created_by:
        type: string
        format: email
      created_at:
        type: string
        format: date-time
      updated_at:
        type: string
        format: date-time
      version:
        type: integer
        minimum: 1
    additionalProperties: false

  notes:
    type: string
    maxLength: 5000

additionalProperties: false

x-gl-rules:
  - id: "COMBINED-001"
    description: "end_date must be after start_date"
    check:
      gt:
        - path: "/reporting_period/end_date"
        - path: "/reporting_period/start_date"
    severity: error
    message: "reporting_period.end_date must be after start_date"
