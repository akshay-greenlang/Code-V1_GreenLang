"""
Test fixtures for vulnerability_disclosure module.

Provides mock submissions, researchers, and configuration for VDP testing.
"""

import pytest
from datetime import datetime, timedelta
from typing import Dict, Any, List
from unittest.mock import AsyncMock, MagicMock
from uuid import uuid4


# VDP Submission fixtures
@pytest.fixture
def sample_submission() -> Dict[str, Any]:
    """Create a sample vulnerability submission."""
    return {
        "submission_id": str(uuid4()),
        "title": "SQL Injection in User Search API",
        "description": "The /api/v1/users/search endpoint is vulnerable to SQL injection",
        "severity": "high",
        "vulnerability_type": "sql_injection",
        "affected_component": "/api/v1/users/search",
        "steps_to_reproduce": [
            "Navigate to /api/v1/users/search",
            "Add parameter: query=admin' OR 1=1--",
            "Observe all user records returned",
        ],
        "proof_of_concept": "curl 'https://api.example.com/users/search?query=admin%27%20OR%201%3D1--'",
        "impact": "Attacker can extract all user data from the database",
        "submitted_at": datetime.utcnow().isoformat(),
        "researcher_id": str(uuid4()),
        "status": "new",
        "attachments": [],
    }


@pytest.fixture
def sample_researcher() -> Dict[str, Any]:
    """Create a sample researcher profile."""
    return {
        "researcher_id": str(uuid4()),
        "username": "security_researcher_1",
        "email": "researcher@example.com",
        "reputation_score": 85,
        "submissions_count": 15,
        "accepted_count": 12,
        "total_rewards": 25000.00,
        "joined_at": datetime.utcnow() - timedelta(days=365),
        "verified": True,
        "payment_method": "paypal",
    }


@pytest.fixture
def vdp_config() -> Dict[str, Any]:
    """Create VDP configuration."""
    return {
        "enabled": True,
        "scope": [
            "*.greenlang.io",
            "api.greenlang.io",
        ],
        "out_of_scope": [
            "status.greenlang.io",
            "docs.greenlang.io",
        ],
        "reward_ranges": {
            "critical": {"min": 5000, "max": 15000},
            "high": {"min": 2000, "max": 5000},
            "medium": {"min": 500, "max": 2000},
            "low": {"min": 100, "max": 500},
        },
        "response_sla_hours": {
            "critical": 4,
            "high": 24,
            "medium": 72,
            "low": 168,
        },
    }


@pytest.fixture
def vdp_admin_headers() -> Dict[str, str]:
    """Create headers for VDP admin role."""
    return {
        "Authorization": "Bearer test-vdp-admin-token",
        "X-User-Id": "vdp-admin",
        "X-User-Roles": "vdp-admin,security-analyst",
    }
