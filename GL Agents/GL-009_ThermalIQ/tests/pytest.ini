[pytest]
# ==============================================================================
# GL-009 THERMALIQ - Test Configuration
# ==============================================================================
# Production-grade test configuration for thermal intelligence agent.
# Enforces 85% minimum code coverage with comprehensive test categorization.
#
# Compliance:
#   - ASME PTC 4.1/46: Steam generator performance calculations
#   - IAPWS-IF97: Steam/water property validation
#   - ISO 50001:2018: Energy management systems
#
# Usage:
#   pytest tests/                           # Run all tests
#   pytest tests/ -m unit                   # Unit tests only
#   pytest tests/ -m golden                 # Golden value tests only
#   pytest tests/ -m "not slow"             # Exclude slow tests
#   pytest tests/ --cov-fail-under=90       # Override coverage threshold
#
# Author: GL-BackendDeveloper
# Version: 2.0.0
# ==============================================================================

minversion = 7.0
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# =============================================================================
# Test Markers for Categorization
# =============================================================================
markers =
    # Core test categories
    unit: Unit tests (fast, isolated, <100ms per test)
    integration: Integration tests (external dependencies)
    e2e: End-to-end workflow tests
    performance: Performance and benchmark tests

    # Compliance and validation tests
    compliance: Regulatory compliance validation tests
    golden: Golden value validation tests (determinism verification)
    nist: NIST SRD reference data validation
    iapws: IAPWS-IF97 steam property validation
    asme: ASME PTC calculation validation

    # Behavioral tests
    determinism: Deterministic reproducibility verification
    provenance: SHA-256 provenance tracking tests
    safety: Safety constraint validation tests

    # Execution characteristics
    slow: Slow tests (>5s execution time)
    flaky: Tests with potential non-determinism

    # Dependency markers
    requires_coolprop: Tests requiring CoolProp library
    requires_kafka: Tests requiring Kafka broker
    requires_shap: Tests requiring SHAP library
    requires_db: Tests requiring database connection
    requires_redis: Tests requiring Redis connection

    # Async marker
    asyncio: Async tests using pytest-asyncio

# =============================================================================
# Async Configuration
# =============================================================================
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# =============================================================================
# Test Output Configuration with Coverage Enforcement
# =============================================================================
# MANDATORY: 85% minimum code coverage enforced
# This aligns with GreenLang Global AI Standards Testing requirement (15 points)
addopts =
    -v
    --tb=short
    --strict-markers
    --strict-config
    -ra
    --showlocals
    --cov=.
    --cov-report=term-missing
    --cov-report=html:coverage_html
    --cov-report=xml:coverage.xml
    --cov-report=json:coverage.json
    --cov-fail-under=85
    --cov-branch
    --junitxml=test-results.xml
    --durations=10
    --durations-min=1.0

# =============================================================================
# Coverage Configuration
# =============================================================================
# Note: Additional coverage settings in .coveragerc or pyproject.toml
# - Branch coverage enabled (--cov-branch)
# - 85% minimum threshold enforced (--cov-fail-under=85)
# - Multiple output formats for CI integration

# =============================================================================
# Logging Configuration
# =============================================================================
log_cli = true
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %H:%M:%S

log_file = tests/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s (%(filename)s:%(lineno)d): %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# =============================================================================
# Timeout Configuration
# =============================================================================
timeout = 60
timeout_method = thread
timeout_func_only = true

# =============================================================================
# Warning Filters
# =============================================================================
filterwarnings =
    error::pytest.PytestUnhandledCoroutineWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:scipy
    ignore::UserWarning:numpy
    ignore::FutureWarning:sklearn

# =============================================================================
# JUnit XML for CI Integration
# =============================================================================
junit_family = xunit2
junit_suite_name = GL-009_ThermalIQ_Tests
junit_logging = all
junit_duration_report = call

# =============================================================================
# Console Output
# =============================================================================
console_output_style = progress
norecursedirs =
    .git
    .tox
    .eggs
    *.egg
    build
    dist
    __pycache__
    .pytest_cache
    coverage_html
    htmlcov
    .mypy_cache
    .ruff_cache

# =============================================================================
# Environment Variables for Tests
# =============================================================================
env =
    GL_TEST_MODE=true
    GL_DETERMINISTIC_MODE=true
    GL_LOG_LEVEL=DEBUG
    PYTHONHASHSEED=42
