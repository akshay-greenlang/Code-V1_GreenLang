# INFRA-001: Service Accounts for GreenLang
# Defines all service accounts required for application and automation
# Each service account has specific roles for least-privilege access
---
# Platform Admin Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-platform-admin
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: rbac
    rbac.greenlang.io/role-type: admin
  annotations:
    description: "Platform admin service account for cluster-level operations"
automountServiceAccountToken: false

---
# Application Service Account - Production
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-app
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: application
  annotations:
    description: "Main application service account"
    # AWS IAM Role for Service Accounts (IRSA)
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/greenlang-app-role"
automountServiceAccountToken: true
secrets:
  - name: greenlang-app-token

---
# Application Service Account - Staging
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-app
  namespace: greenlang-staging
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: application
  annotations:
    description: "Staging application service account"
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/greenlang-app-staging-role"
automountServiceAccountToken: true

---
# Application Service Account - Dev
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-app
  namespace: greenlang-dev
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: application
  annotations:
    description: "Development application service account"
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/greenlang-app-dev-role"
automountServiceAccountToken: true

---
# Worker Service Account - Production
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-worker
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: worker
  annotations:
    description: "Background worker service account"
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/greenlang-worker-role"
automountServiceAccountToken: true

---
# CI/CD Service Account - Production
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-cicd
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: cicd
  annotations:
    description: "CI/CD pipeline service account for deployments"
automountServiceAccountToken: true

---
# CI/CD Service Account - Staging
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-cicd
  namespace: greenlang-staging
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: cicd
  annotations:
    description: "CI/CD pipeline service account for staging deployments"
automountServiceAccountToken: true

---
# CI/CD Service Account - Dev
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-cicd
  namespace: greenlang-dev
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: cicd
  annotations:
    description: "CI/CD pipeline service account for dev deployments"
automountServiceAccountToken: true

---
# Backup Operator Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-backup-operator
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: backup
  annotations:
    description: "Backup operator service account for database backups"
    eks.amazonaws.com/role-arn: "arn:aws:iam::ACCOUNT_ID:role/greenlang-backup-role"
automountServiceAccountToken: true

---
# Migration Job Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-migration
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: migration
  annotations:
    description: "Database migration job service account"
automountServiceAccountToken: true

---
# Migration Job Service Account - Staging
apiVersion: v1
kind: ServiceAccount
metadata:
  name: greenlang-migration
  namespace: greenlang-staging
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: migration
  annotations:
    description: "Staging database migration job service account"
automountServiceAccountToken: true

---
# Prometheus Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: prometheus
  namespace: monitoring
  labels:
    app.kubernetes.io/name: prometheus
    app.kubernetes.io/component: monitoring
  annotations:
    description: "Prometheus metrics collection service account"
automountServiceAccountToken: true

---
# Grafana Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: grafana
  namespace: monitoring
  labels:
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
  annotations:
    description: "Grafana dashboard service account"
automountServiceAccountToken: true

---
# AlertManager Service Account
apiVersion: v1
kind: ServiceAccount
metadata:
  name: alertmanager
  namespace: monitoring
  labels:
    app.kubernetes.io/name: alertmanager
    app.kubernetes.io/component: monitoring
  annotations:
    description: "AlertManager notification service account"
automountServiceAccountToken: true

---
# Secrets for long-lived tokens (if needed for external systems)
apiVersion: v1
kind: Secret
metadata:
  name: greenlang-app-token
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: application
  annotations:
    kubernetes.io/service-account.name: greenlang-app
type: kubernetes.io/service-account-token

---
apiVersion: v1
kind: Secret
metadata:
  name: greenlang-cicd-token
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: cicd
  annotations:
    kubernetes.io/service-account.name: greenlang-cicd
type: kubernetes.io/service-account-token

---
# ImagePullSecrets for private registry
apiVersion: v1
kind: Secret
metadata:
  name: greenlang-registry-credentials
  namespace: greenlang
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: registry
type: kubernetes.io/dockerconfigjson
data:
  # Base64 encoded docker config - replace with actual credentials
  .dockerconfigjson: e30=

---
apiVersion: v1
kind: Secret
metadata:
  name: greenlang-registry-credentials
  namespace: greenlang-staging
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: registry
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: e30=

---
apiVersion: v1
kind: Secret
metadata:
  name: greenlang-registry-credentials
  namespace: greenlang-dev
  labels:
    app.kubernetes.io/name: greenlang
    app.kubernetes.io/component: registry
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: e30=
