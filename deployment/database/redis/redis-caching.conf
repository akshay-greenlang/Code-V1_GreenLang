# =============================================================================
# Redis Caching Configuration
# =============================================================================
# Optimized for high-performance caching workloads
# Priority: Speed over durability - no persistence
# Use case: Application cache, CDN cache, API response cache
# =============================================================================

# -----------------------------------------------------------------------------
# NETWORK CONFIGURATION
# -----------------------------------------------------------------------------

# Bind to all interfaces (use with proper network security)
bind 0.0.0.0

# Default Redis port
port 6379

# TCP keepalive - send ACKs every 300 seconds to detect dead connections
tcp-keepalive 300

# Client idle timeout - 0 means disabled (never close idle connections)
timeout 0

# TCP listen backlog - max pending connections queue
# Increase for high connection rate scenarios
tcp-backlog 511

# Maximum number of simultaneous client connections
maxclients 10000

# Enable TCP nodelay to reduce latency
tcp-nodelay yes

# -----------------------------------------------------------------------------
# MEMORY CONFIGURATION
# -----------------------------------------------------------------------------

# Maximum memory limit - 6GB for caching workload
maxmemory 6gb

# Eviction policy: allkeys-lru
# Evict any key using approximated LRU when maxmemory is reached
# Best for caching where all keys are candidates for eviction
maxmemory-policy allkeys-lru

# LRU/LFU algorithm samples - higher = more accurate but slower
maxmemory-samples 10

# Active defragmentation to reduce memory fragmentation
activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 1
active-defrag-cycle-max 25
active-defrag-max-scan-fields 1000

# Jemalloc background thread for memory management
jemalloc-bg-thread yes

# -----------------------------------------------------------------------------
# PERSISTENCE CONFIGURATION (DISABLED FOR CACHING)
# -----------------------------------------------------------------------------

# Disable RDB persistence - caching doesn't need durability
save ""

# Disable AOF persistence
appendonly no

# -----------------------------------------------------------------------------
# REPLICATION CONFIGURATION
# -----------------------------------------------------------------------------

# Replication backlog size for partial resync
repl-backlog-size 64mb

# Timeout for replication
repl-timeout 60

# Disable diskless sync for replicas
repl-diskless-sync no

# Min replicas for write acceptance (0 = disabled)
min-replicas-to-write 0
min-replicas-max-lag 10

# -----------------------------------------------------------------------------
# LAZY FREEING CONFIGURATION
# -----------------------------------------------------------------------------

# Use async deletion to avoid blocking on large key deletion
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
lazyfree-lazy-user-del yes
lazyfree-lazy-user-flush yes

# -----------------------------------------------------------------------------
# THREADING CONFIGURATION
# -----------------------------------------------------------------------------

# Enable I/O threading for improved performance on multi-core systems
# Set based on available CPU cores (recommended: cores - 1, max 8)
io-threads 4
io-threads-do-reads yes

# -----------------------------------------------------------------------------
# CLIENT OUTPUT BUFFER LIMITS
# -----------------------------------------------------------------------------

# Normal clients: 0 means unlimited
client-output-buffer-limit normal 0 0 0

# Replica clients: allow up to 256mb hard limit
client-output-buffer-limit replica 256mb 64mb 60

# Pub/Sub clients: 32mb hard limit
client-output-buffer-limit pubsub 32mb 8mb 60

# -----------------------------------------------------------------------------
# SLOW LOG CONFIGURATION
# -----------------------------------------------------------------------------

# Log queries slower than 10ms
slowlog-log-slower-than 10000

# Keep last 128 slow queries
slowlog-max-len 128

# -----------------------------------------------------------------------------
# LATENCY MONITORING
# -----------------------------------------------------------------------------

# Latency monitor threshold in milliseconds
latency-monitor-threshold 100

# -----------------------------------------------------------------------------
# SECURITY CONFIGURATION
# -----------------------------------------------------------------------------

# Protected mode - disable in containerized environments with proper network security
protected-mode no

# Rename dangerous commands (uncomment in production)
# rename-command FLUSHALL ""
# rename-command FLUSHDB ""
# rename-command DEBUG ""
# rename-command CONFIG ""

# -----------------------------------------------------------------------------
# LOGGING CONFIGURATION
# -----------------------------------------------------------------------------

# Log level: debug, verbose, notice, warning
loglevel notice

# Log to stdout for container environments
logfile ""

# -----------------------------------------------------------------------------
# ADVANCED CONFIGURATION
# -----------------------------------------------------------------------------

# Hash table rehashing - use milliseconds per second
hz 10

# Dynamic hz - adjust hz based on client connections
dynamic-hz yes

# Enable active expire effort
active-expire-effort 1

# List compression depth
list-compress-depth 0

# Set max intset entries before converting to hash
set-max-intset-entries 512

# Zip list thresholds
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
