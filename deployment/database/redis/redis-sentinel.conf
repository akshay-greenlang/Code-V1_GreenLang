# =============================================================================
# Redis Sentinel Configuration
# =============================================================================
# High availability monitoring and automatic failover
# Use case: Production deployments requiring automatic failover
# =============================================================================

# -----------------------------------------------------------------------------
# SENTINEL IDENTITY
# -----------------------------------------------------------------------------

# Sentinel port (default: 26379)
port 26379

# Bind to all interfaces
bind 0.0.0.0

# Protected mode - disable in container environments
protected-mode no

# Sentinel announce configuration for containerized environments
# sentinel announce-ip <ip>
# sentinel announce-port <port>

# -----------------------------------------------------------------------------
# MASTER MONITORING
# -----------------------------------------------------------------------------

# Monitor the GreenLang Redis master
# sentinel monitor <master-name> <ip> <port> <quorum>
# Quorum of 2 means at least 2 Sentinels must agree for failover
sentinel monitor greenlang-master redis-0.redis 6379 2

# Authentication for master (if required)
# sentinel auth-pass greenlang-master <password>

# Authentication for Sentinel instances (if required)
# sentinel auth-user greenlang-master <username>

# -----------------------------------------------------------------------------
# FAILOVER CONFIGURATION
# -----------------------------------------------------------------------------

# Time in milliseconds an instance should be unreachable before
# considering it in SDOWN (subjectively down) state
sentinel down-after-milliseconds greenlang-master 5000

# Failover timeout in milliseconds
# This is the time:
# - To re-start a failover after a previous failover timeout
# - Time needed for a replica to replicate from the new master
# - Time to cancel a failover that is already in progress
sentinel failover-timeout greenlang-master 60000

# Number of replicas that can be reconfigured to use the new master
# after a failover at the same time
# Lower number = safer but slower failover
sentinel parallel-syncs greenlang-master 1

# -----------------------------------------------------------------------------
# HOSTNAME RESOLUTION (FOR KUBERNETES/DNS)
# -----------------------------------------------------------------------------

# Enable hostname resolution for container/Kubernetes environments
sentinel resolve-hostnames yes

# Announce hostnames instead of IPs
sentinel announce-hostnames yes

# -----------------------------------------------------------------------------
# NOTIFICATION SCRIPTS
# -----------------------------------------------------------------------------

# Script to execute on any sentinel event
# sentinel notification-script greenlang-master /opt/scripts/sentinel-notify.sh

# Script to execute after failover
# sentinel client-reconfig-script greenlang-master /opt/scripts/sentinel-reconfig.sh

# -----------------------------------------------------------------------------
# SENTINEL RUNTIME CONFIGURATION
# -----------------------------------------------------------------------------

# Working directory
dir /data

# Log file (empty = stdout)
logfile ""

# Log level
loglevel notice

# Daemonize (no for containers)
daemonize no

# PID file
pidfile /var/run/redis-sentinel.pid

# -----------------------------------------------------------------------------
# SENTINEL PERSISTENCE
# -----------------------------------------------------------------------------

# Sentinel state persistence
# Sentinel automatically rewrites this file with current configuration

# -----------------------------------------------------------------------------
# SENTINEL CLUSTER CONFIGURATION
# -----------------------------------------------------------------------------

# Deny scripts reconfig - security measure
sentinel deny-scripts-reconfig yes

# Require Sentinel to agree on primary before returning info
# sentinel primary-reconfig-check-period 10000

# -----------------------------------------------------------------------------
# ACL CONFIGURATION (Redis 6+)
# -----------------------------------------------------------------------------

# Sentinel ACL
# aclfile /etc/redis/sentinel-acl.conf

# Default user (if ACL is used)
# user default on nopass ~* &* +@all

# -----------------------------------------------------------------------------
# ADDITIONAL MASTER CONFIGURATIONS (if monitoring multiple masters)
# -----------------------------------------------------------------------------

# Example: Monitor a second Redis cluster
# sentinel monitor greenlang-cache redis-cache-0.redis-cache 6379 2
# sentinel down-after-milliseconds greenlang-cache 5000
# sentinel failover-timeout greenlang-cache 60000
# sentinel parallel-syncs greenlang-cache 1

# Example: Monitor queue Redis
# sentinel monitor greenlang-queue redis-queue-0.redis-queue 6379 2
# sentinel down-after-milliseconds greenlang-queue 5000
# sentinel failover-timeout greenlang-queue 60000
# sentinel parallel-syncs greenlang-queue 1

# -----------------------------------------------------------------------------
# KUBERNETES-SPECIFIC SETTINGS
# -----------------------------------------------------------------------------

# For StatefulSet deployments, use headless service DNS names:
# redis-0.redis.namespace.svc.cluster.local
# redis-1.redis.namespace.svc.cluster.local
# redis-2.redis.namespace.svc.cluster.local

# Sentinel discovery in Kubernetes:
# sentinel-0.sentinel.namespace.svc.cluster.local
# sentinel-1.sentinel.namespace.svc.cluster.local
# sentinel-2.sentinel.namespace.svc.cluster.local
