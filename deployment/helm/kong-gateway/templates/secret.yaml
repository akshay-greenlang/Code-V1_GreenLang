{{/*
=============================================================================
Kong API Gateway - Secrets
GreenLang Climate OS | infra-006

NOTE: In production, secrets should be managed by an external secrets
operator (e.g., AWS Secrets Manager + External Secrets Operator).
These manifests provide sensible defaults for bootstrapping and
development environments. Override with existingSecret references
in production.
=============================================================================
*/}}

# ---------------------------------------------------------------------------
# Redis credentials for rate limiting
# ---------------------------------------------------------------------------
apiVersion: v1
kind: Secret
metadata:
  name: {{ default "kong-redis-credentials" .Values.redis.existingSecret }}
  namespace: {{ include "kong-gateway.namespace" . }}
  labels:
    {{- include "kong-gateway.labels" . | nindent 4 }}
  annotations:
    {{- include "kong-gateway.annotations" . | nindent 4 }}
    helm.sh/resource-policy: keep
type: Opaque
data:
  # Base64-encoded placeholder -- override via values or external secrets operator
  {{ .Values.redis.secretKeys.password }}: {{ default "" .Values.redis.password | b64enc | quote }}

---
# ---------------------------------------------------------------------------
# JWT signing key for token validation
# ---------------------------------------------------------------------------
apiVersion: v1
kind: Secret
metadata:
  name: {{ default "kong-jwt-signing-key" .Values.jwt.existingSecret }}
  namespace: {{ include "kong-gateway.namespace" . }}
  labels:
    {{- include "kong-gateway.labels" . | nindent 4 }}
  annotations:
    {{- include "kong-gateway.annotations" . | nindent 4 }}
    helm.sh/resource-policy: keep
type: Opaque
data:
  # Base64-encoded placeholder -- inject real key via CI/CD or external secrets
  {{ .Values.jwt.secretKeys.key }}: {{ default "" .Values.jwt.signingKey | b64enc | quote }}
