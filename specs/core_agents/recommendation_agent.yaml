# GreenLang Agent Specification v2.0
# Core Agent: RecommendationAgent (Base) / RecommendationAgentAI (AI-Enhanced)
# Carbon reduction recommendations engine with ROI analysis and technology selection

agent_metadata:
  agent_id: "core/recommendation_agent"
  agent_name: "RecommendationAgentAI"
  agent_number: 0  # Core infrastructure agent (not part of 84-agent catalog)
  version: "1.0.0"
  domain: "Core_Foundation"
  category: "Core_Infrastructure"
  complexity: "High"
  priority: "P0_Critical"
  base_agent: "RecommendationAgent"  # AI version builds on deterministic base
  status: "Production"
  entry_point: false  # Support agent for actionable recommendations

description:
  purpose: |
    Core infrastructure agent for generating prioritized, actionable carbon reduction
    recommendations based on emissions breakdown analysis. Provides technology selection,
    ROI calculations, payback period analysis, and implementation guidance.

    This agent serves as the decision support component across all GreenLang workflows,
    providing intelligent recommendations for reducing carbon emissions through energy
    efficiency improvements, fuel switching, renewable energy adoption, and operational
    optimization.

    The base RecommendationAgent provides deterministic recommendation matching and
    prioritization, while the AI-enhanced RecommendationAgentAI adds intelligent
    contextualization, custom recommendations, and natural language guidance.

  strategic_context:
    global_impact: "Carbon reduction recommendations drive actual emissions reductions - turning data into action"
    opportunity: "Automated recommendation engines reduce decision-making time by 80% and improve impact by targeting highest-return opportunities"
    market_size: "$5B global energy management and carbon reduction advisory market"
    technology_maturity: "Production-ready recommendation engine with AI enhancement for customization"

  key_capabilities:
    - "Generate prioritized recommendations based on emissions breakdown (top sources first)"
    - "Calculate ROI and payback periods for each recommended intervention"
    - "Estimate reduction potential in tons CO2e and percentage terms"
    - "Recommend specific technologies (heat pumps, solar PV, LED lighting, etc.)"
    - "Provide implementation guidance and phased roadmaps"
    - "Industry-specific recommendations (commercial, industrial, residential)"
    - "Country-specific recommendations (tax credits, subsidies, regulations)"
    - "Benchmark performance against industry standards"
    - "Quick wins identification (high impact, low cost, fast payback)"
    - "Long-term strategic recommendations (deep decarbonization)"
    - "GHG Protocol and SBTi alignment"
    - "Integration with building envelope, HVAC, lighting, and renewable systems"

  entry_point: false

  dependencies:
    - agent_id: "core/carbon_agent"
      relationship: "receives_data_from"
      data: "Emissions breakdown by source for targeted recommendations"

    - agent_id: "core/report_agent"
      relationship: "provides_data_to"
      data: "Actionable recommendations for sustainability reports"

    - agent_id: "hvac/system_design_agent"
      relationship: "provides_data_to"
      data: "HVAC upgrade recommendations"

    - agent_id: "building_envelope/insulation_agent"
      relationship: "provides_data_to"
      data: "Envelope improvement recommendations"

    - agent_id: "renewable/solar_sizing_agent"
      relationship: "provides_data_to"
      data: "Solar PV system recommendations"

tools:
  tool_count: 9

  tools_list:
    - tool_id: "tool_1"
      name: "generate_recommendations"
      description: "Generate prioritized carbon reduction recommendations based on emissions breakdown analysis"
      category: "recommendation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          emissions_by_source:
            type: "object"
            description: "Emissions breakdown by source (e.g., {electricity: 15000, natural_gas: 8500})"
            required: true

          building_type:
            type: "string"
            description: "Type of building for context-specific recommendations"
            enum: ["commercial_office", "retail", "warehouse", "manufacturing", "residential", "healthcare", "education", "hospitality", "data_center"]
            default: "commercial_office"

          building_age:
            type: "integer"
            description: "Building age in years (affects retrofit recommendations)"
            minimum: 0
            default: 10

          performance_rating:
            type: "string"
            description: "Current energy performance rating"
            enum: ["Excellent", "Good", "Average", "Below Average", "Poor"]
            default: "Average"

          country:
            type: "string"
            description: "Country code for region-specific recommendations"
            examples: ["US", "IN", "EU", "CN", "CA", "AU"]
            default: "US"

          load_breakdown:
            type: "object"
            description: "Optional breakdown of energy loads (HVAC, lighting, etc.)"
            properties:
              hvac_load:
                type: "number"
                description: "HVAC as fraction of total load"
              lighting_load:
                type: "number"
                description: "Lighting as fraction of total load"
              equipment_load:
                type: "number"
                description: "Equipment/plug loads as fraction"

          max_recommendations:
            type: "integer"
            description: "Maximum number of recommendations to generate"
            default: 10
            minimum: 1
            maximum: 20

        required: ["emissions_by_source"]

      returns:
        type: "object"
        description: "Prioritized list of carbon reduction recommendations"
        properties:
          recommendations:
            type: "array"
            description: "List of actionable recommendations (sorted by priority)"
            items:
              type: "object"
              properties:
                action:
                  type: "string"
                  description: "Recommended action to take"

                impact:
                  type: "string"
                  description: "Expected impact (e.g., '20-30% reduction in HVAC energy')"

                cost:
                  type: "string"
                  enum: ["Low", "Medium", "High"]
                  description: "Implementation cost category"

                payback:
                  type: "string"
                  description: "Typical payback period (e.g., '2-3 years')"

                priority:
                  type: "string"
                  enum: ["High", "Medium", "Low"]
                  description: "Priority level based on impact and feasibility"

                category:
                  type: "string"
                  enum: ["hvac", "lighting", "envelope", "renewable", "operations", "water", "transportation"]
                  description: "Recommendation category"

                target_source:
                  type: "string"
                  description: "Emission source being addressed"

          total_recommendations:
            type: "integer"
            description: "Total number of recommendations generated"

          potential_emissions_reduction:
            type: "object"
            description: "Estimated total reduction potential"
            properties:
              minimum_kg_co2e:
                type: "number"
                units: "kg CO2e"
              maximum_kg_co2e:
                type: "number"
                units: "kg CO2e"
              percentage_range:
                type: "string"
                description: "Range of potential reduction (e.g., '15-30%')"

          grouped_recommendations:
            type: "object"
            description: "Recommendations grouped by implementation timeline"
            properties:
              immediate_actions:
                type: "array"
                description: "Actions with immediate payback"
              short_term:
                type: "array"
                description: "1-2 year timeline"
              medium_term:
                type: "array"
                description: "3-5 year timeline"
              long_term:
                type: "array"
                description: "5+ year timeline"

          quick_wins:
            type: "array"
            description: "Top 3 quick win opportunities (low cost, high impact)"

          high_impact:
            type: "array"
            description: "Top 3 high-impact opportunities (>20% reduction potential)"

          implementation_roadmap:
            type: "array"
            description: "Phased implementation plan"
            items:
              type: "object"
              properties:
                phase:
                  type: "string"
                  description: "Phase name and timeline"
                actions:
                  type: "array"
                  description: "Actions in this phase"
                estimated_cost:
                  type: "string"
                  description: "Cost range for phase"
                expected_impact:
                  type: "string"
                  description: "Expected reduction from phase"

      implementation:
        calculation_method: |
          Recommendation Generation Algorithm:

          1. Analyze emissions breakdown to identify top sources:
             - Rank sources by magnitude (kg CO2e)
             - Calculate percentage contribution of each source
             - Identify dominant patterns (electricity-heavy, gas-heavy, etc.)

          2. Match sources to recommendation database:
             - Electricity recommendations: Solar PV, RECs, LED lighting, efficiency
             - Natural gas recommendations: Heat pumps, envelope, CHP
             - Diesel/fuel oil: Electrification, heat pumps
             - Transportation: Fleet electrification, route optimization
             - Process heat: Industrial heat pumps, renewable heat

          3. Apply context filters:
             - Building age: Old buildings → envelope, new → operations
             - Building type: Office → lighting/HVAC, warehouse → envelope/heating
             - Performance rating: Poor → comprehensive audits, Good → fine-tuning
             - Load breakdown: High HVAC load → HVAC-specific recommendations

          4. Add country-specific recommendations:
             - US: IRA tax credits, ENERGY STAR
             - India: PAT scheme, solar subsidies
             - EU: EU Taxonomy, district heating
             - China: Carbon trading, energy quotas

          5. Prioritize recommendations:
             - Sort by: (1) Priority level (High/Medium/Low)
                        (2) Payback period (shortest first)
                        (3) Implementation difficulty (easiest first)

          6. Calculate aggregate reduction potential:
             - Extract percentage ranges from recommendations
             - Apply to total emissions
             - Calculate min/max reduction scenarios
             - Account for interaction effects (not fully additive)

          7. Create implementation roadmap:
             - Phase 1: Quick wins (0-6 months, low cost, high impact)
             - Phase 2: Strategic improvements (6-18 months, medium cost)
             - Phase 3: Major upgrades (18-36 months, high cost, transformative)

        data_source: "Recommendation database (400+ recommendations) + emissions analysis"
        accuracy: "Recommendation matching: 100%; Impact estimates: ±10% based on industry data"
        validation: |
          - Cross-reference impact ranges with ASHRAE, DOE, EPA guidelines
          - Validate payback periods against industry case studies
          - Check technology compatibility with building characteristics
          - Ensure recommendations don't conflict (e.g., solar + grid switch)
        standards: ["GHG_Protocol", "ISO_50001", "ASHRAE_90.1", "SBTi"]

      example:
        input:
          emissions_by_source:
            electricity: 15000
            natural_gas: 8500
            diesel: 3200
          building_type: "commercial_office"
          building_age: 12
          performance_rating: "Average"
          country: "US"
          load_breakdown:
            hvac_load: 0.45
            lighting_load: 0.25
            equipment_load: 0.30
          max_recommendations: 10
        output:
          recommendations:
            - action: "Convert to LED lighting"
              impact: "50-70% reduction in lighting energy"
              cost: "Medium"
              payback: "2-3 years"
              priority: "High"
              category: "lighting"
              target_source: "electricity"
            - action: "Install rooftop solar PV system"
              impact: "30-70% reduction in grid electricity"
              cost: "High"
              payback: "5-8 years"
              priority: "High"
              category: "renewable"
              target_source: "electricity"
            - action: "Upgrade to high-efficiency HVAC system"
              impact: "20-30% reduction in HVAC energy"
              cost: "High"
              payback: "5-7 years"
              priority: "High"
              category: "hvac"
              target_source: "electricity"
          total_recommendations: 10
          potential_emissions_reduction:
            minimum_kg_co2e: 4000
            maximum_kg_co2e: 13500
            percentage_range: "15-50%"
          quick_wins:
            - action: "Install occupancy sensors for lighting"
              impact: "20-30% reduction in lighting energy"
              cost: "Low"
              payback: "1-2 years"
          high_impact:
            - action: "Install rooftop solar PV system"
              impact: "30-70% reduction in grid electricity"
            - action: "Upgrade to high-efficiency HVAC system"
              impact: "20-30% reduction in HVAC energy"

    - tool_id: "tool_2"
      name: "calculate_roi"
      description: "Calculate return on investment and payback period for specific interventions"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          intervention_name:
            type: "string"
            description: "Name of the intervention"
            required: true

          implementation_cost_usd:
            type: "number"
            description: "Total implementation cost in USD"
            minimum: 0
            required: true

          annual_savings_usd:
            type: "number"
            description: "Expected annual cost savings in USD"
            minimum: 0
            required: true

          annual_reduction_kg_co2e:
            type: "number"
            description: "Expected annual emissions reduction in kg CO2e"
            minimum: 0
            required: true

          maintenance_cost_annual_usd:
            type: "number"
            description: "Annual maintenance cost"
            minimum: 0
            default: 0

          incentives_usd:
            type: "number"
            description: "Available incentives/rebates/tax credits"
            minimum: 0
            default: 0

          lifetime_years:
            type: "integer"
            description: "Expected lifetime of the intervention"
            minimum: 1
            default: 20

        required: ["intervention_name", "implementation_cost_usd", "annual_savings_usd", "annual_reduction_kg_co2e"]

      returns:
        type: "object"
        description: "Financial analysis results"
        properties:
          simple_payback_years:
            type: "number"
            description: "Simple payback period in years"
            units: "years"
            precision: "0.1 years"

          net_cost_usd:
            type: "number"
            description: "Implementation cost after incentives"
            units: "USD"

          lifetime_savings_usd:
            type: "number"
            description: "Total savings over lifetime"
            units: "USD"

          lifetime_reduction_tons_co2e:
            type: "number"
            description: "Total emissions reduction over lifetime"
            units: "metric tons CO2e"

          roi_percentage:
            type: "number"
            description: "Return on investment (ROI) percentage"
            units: "%"

          cost_per_ton_co2e_reduced:
            type: "number"
            description: "Cost effectiveness in USD per ton CO2e reduced"
            units: "USD/ton CO2e"

          npv_usd:
            type: "number"
            description: "Net present value (NPV) at 5% discount rate"
            units: "USD"

          irr_percentage:
            type: "number"
            description: "Internal rate of return (IRR)"
            units: "%"

          recommendation:
            type: "string"
            enum: ["Highly Recommended", "Recommended", "Consider", "Not Recommended"]
            description: "Financial recommendation based on analysis"

      implementation:
        calculation_method: |
          ROI Calculation:

          1. Net implementation cost:
             net_cost = implementation_cost - incentives

          2. Net annual savings:
             net_annual_savings = annual_savings - maintenance_cost_annual

          3. Simple payback period:
             payback_years = net_cost / net_annual_savings
             (If payback > lifetime, intervention may not be financially viable)

          4. Lifetime metrics:
             lifetime_savings = net_annual_savings × lifetime_years
             lifetime_reduction_tons = (annual_reduction_kg_co2e / 1000) × lifetime_years

          5. ROI percentage:
             roi = ((lifetime_savings - net_cost) / net_cost) × 100

          6. Cost per ton CO2e reduced:
             cost_per_ton = net_cost / lifetime_reduction_tons

          7. Net Present Value (NPV at 5% discount rate):
             npv = Σ(net_annual_savings / (1.05)^t) - net_cost, t=1 to lifetime_years

          8. Internal Rate of Return (IRR):
             Solve for r: Σ(net_annual_savings / (1+r)^t) = net_cost

          9. Recommendation logic:
             - Highly Recommended: payback ≤ 3 years, roi ≥ 100%, npv > 0
             - Recommended: payback ≤ 7 years, roi ≥ 50%, npv > 0
             - Consider: payback ≤ 10 years, roi ≥ 0%, npv ≥ 0
             - Not Recommended: payback > 10 years, roi < 0%, npv < 0

        data_source: "User-provided cost and savings estimates + financial calculations"
        accuracy: "±5% (depends on accuracy of input estimates)"
        validation: "Verify payback period is within equipment lifetime; check NPV and IRR are consistent"

      example:
        input:
          intervention_name: "LED Lighting Retrofit"
          implementation_cost_usd: 50000
          annual_savings_usd: 18000
          annual_reduction_kg_co2e: 15000
          maintenance_cost_annual_usd: 500
          incentives_usd: 10000
          lifetime_years: 15
        output:
          simple_payback_years: 2.3
          net_cost_usd: 40000
          lifetime_savings_usd: 262500
          lifetime_reduction_tons_co2e: 225.0
          roi_percentage: 556.25
          cost_per_ton_co2e_reduced: 177.78
          npv_usd: 142000
          irr_percentage: 42.5
          recommendation: "Highly Recommended"

    - tool_id: "tool_3"
      name: "estimate_reduction_potential"
      description: "Estimate carbon reduction potential for specific interventions based on baseline emissions"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          intervention_type:
            type: "string"
            description: "Type of intervention"
            enum: ["solar_pv", "heat_pump", "led_lighting", "insulation", "hvac_upgrade", "ems", "renewable_energy_purchase", "ev_fleet"]
            required: true

          baseline_emissions_kg:
            type: "number"
            description: "Baseline emissions from target source"
            minimum: 0
            required: true

          intervention_parameters:
            type: "object"
            description: "Intervention-specific parameters"
            properties:
              system_size_kw:
                type: "number"
                description: "System size (for solar, heat pump, etc.)"
              area_sqft:
                type: "number"
                description: "Area affected (for insulation, lighting, etc.)"
              efficiency_improvement:
                type: "number"
                description: "Efficiency improvement percentage"
              renewable_percentage:
                type: "number"
                description: "Percentage renewable (for RECs, PPAs)"

        required: ["intervention_type", "baseline_emissions_kg"]

      returns:
        type: "object"
        description: "Estimated reduction potential"
        properties:
          reduction_kg_co2e:
            type: "number"
            description: "Estimated annual reduction in kg CO2e"
            units: "kg CO2e/year"

          reduction_percentage:
            type: "number"
            description: "Reduction as percentage of baseline"
            units: "%"

          reduction_range:
            type: "object"
            description: "Min-max range for reduction estimate"
            properties:
              min_kg_co2e:
                type: "number"
              max_kg_co2e:
                type: "number"
              confidence:
                type: "string"
                enum: ["high", "medium", "low"]

          calculation_basis:
            type: "string"
            description: "Explanation of calculation methodology"

      implementation:
        calculation_method: |
          Reduction Potential Estimation by Intervention Type:

          1. Solar PV:
             - Annual generation (kWh) = system_size_kw × capacity_factor × 8760
             - Capacity factor varies by location (15-25% typical)
             - Reduction = generation_kwh × grid_emission_factor
             - Typical: 30-70% of electricity emissions

          2. Heat Pump (replacing gas heating):
             - COP of heat pump: 2.5-4.0
             - Gas heating efficiency: 0.75-0.85
             - Energy reduction = 1 - (1/COP) / gas_efficiency
             - Emissions reduction = 50-70% of gas heating emissions

          3. LED Lighting:
             - LED efficiency: 100-120 lm/W
             - Legacy lighting: 15-60 lm/W
             - Energy reduction = 50-75%
             - Reduction = baseline × 0.50-0.75

          4. Insulation (envelope improvements):
             - Typical HVAC load reduction: 10-30%
             - Depends on baseline R-value and climate
             - Reduction = hvac_emissions × 0.10-0.30

          5. HVAC Upgrade:
             - Old SEER: 8-10, New SEER: 16-25
             - Efficiency improvement = (new_seer - old_seer) / old_seer
             - Reduction = hvac_emissions × efficiency_improvement

          6. Energy Management System (EMS):
             - Typical whole-building reduction: 10-20%
             - Reduction = total_emissions × 0.10-0.20

          7. Renewable Energy Purchase (RECs/PPAs):
             - Direct offset of electricity emissions
             - Reduction = electricity_emissions × renewable_percentage / 100

          8. EV Fleet Conversion:
             - EV efficiency: ~3.5 mi/kWh = 0.12 kg CO2e/mi (at US grid average)
             - ICE efficiency: 25 mpg = 0.36 kg CO2e/mi
             - Reduction = 60-90% per vehicle-mile

        data_source: "Intervention parameters + industry benchmarks (ASHRAE, DOE, NREL)"
        accuracy: "±15% (typical range for estimates without detailed engineering)"
        validation: "Compare against published case studies; verify reduction doesn't exceed 100%"

      example:
        input:
          intervention_type: "solar_pv"
          baseline_emissions_kg: 15000
          intervention_parameters:
            system_size_kw: 50
            # Will use default capacity factor
        output:
          reduction_kg_co2e: 7500
          reduction_percentage: 50.0
          reduction_range:
            min_kg_co2e: 6000
            max_kg_co2e: 9000
            confidence: "medium"
          calculation_basis: "50 kW system with 18% capacity factor, 0.417 kg CO2e/kWh grid intensity"

    - tool_id: "tool_4"
      name: "recommend_technology"
      description: "Recommend specific technology solutions based on building characteristics and emission sources"
      category: "recommendation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          target_source:
            type: "string"
            description: "Emission source to address"
            enum: ["electricity", "natural_gas", "fuel_oil", "propane", "diesel", "coal", "process_heat"]
            required: true

          building_type:
            type: "string"
            description: "Type of building"
            required: true

          climate_zone:
            type: "string"
            description: "ASHRAE climate zone (1-8, A-C)"
            examples: ["1A", "2A", "3A", "4A", "5A", "6A", "7", "8"]

          existing_systems:
            type: "array"
            description: "Existing systems in place"
            items:
              type: "string"

          budget_constraint:
            type: "string"
            enum: ["low", "medium", "high", "unlimited"]
            default: "medium"

        required: ["target_source", "building_type"]

      returns:
        type: "object"
        description: "Technology recommendations"
        properties:
          primary_recommendation:
            type: "object"
            description: "Best overall technology recommendation"
            properties:
              technology:
                type: "string"
                description: "Technology name"
              description:
                type: "string"
                description: "Technology description"
              typical_cost_per_unit:
                type: "string"
                description: "Typical cost range"
              reduction_potential:
                type: "string"
                description: "Expected reduction range"
              implementation_complexity:
                type: "string"
                enum: ["low", "medium", "high"]
              maintenance_requirements:
                type: "string"
              expected_lifetime_years:
                type: "integer"

          alternative_options:
            type: "array"
            description: "Alternative technology options"
            items:
              type: "object"
              # Same structure as primary_recommendation

          implementation_considerations:
            type: "array"
            description: "Key considerations for implementation"
            items:
              type: "string"

      implementation:
        calculation_method: |
          Technology Recommendation Logic:

          ELECTRICITY:
          - High consumption + good solar resource → Solar PV
          - High consumption + poor solar resource → Wind or renewable PPAs
          - Low consumption → RECs or green power purchase
          - Climate consideration: Solar works in all climates, output varies

          NATURAL GAS (Space Heating):
          - Climate zone 1-3 (hot/warm) → Air-source heat pump (ASHP)
          - Climate zone 4-5 (mixed) → ASHP or ground-source heat pump (GSHP)
          - Climate zone 6-8 (cold) → GSHP or cold-climate heat pump
          - Existing system age > 15 years → Replace, else retrofit

          NATURAL GAS (Water Heating):
          - All climates → Heat pump water heater (HPWH)
          - Industrial → Heat pump or solar thermal
          - Alternative: Electric resistance with renewable electricity

          FUEL OIL/PROPANE:
          - Primary recommendation: Heat pump (same as gas logic)
          - Alternative: Biofuel blend (short-term)
          - Long-term: Full electrification

          DIESEL (Transportation):
          - Fleet vehicles → Electric vehicles (EVs)
          - Backup generators → Battery storage + solar
          - Construction equipment → Biodiesel (interim), electric (long-term)

          COAL:
          - Primary: Immediate phase-out to natural gas or renewable
          - No retrofit options - requires full fuel switching

          PROCESS HEAT:
          - Low temp (<150°C) → Industrial heat pump
          - Medium temp (150-400°C) → Electric resistance or induction
          - High temp (>400°C) → Hydrogen, biofuels, or process redesign

        data_source: "Technology database + ASHRAE climate data + building characteristics"
        accuracy: "Recommendation matching: 100%; cost estimates: ±20% (order of magnitude)"
        validation: "Cross-reference with ASHRAE guidelines; verify technology compatibility"
        standards: ["ASHRAE_90.1", "IECC", "DOE_Better_Buildings"]

      example:
        input:
          target_source: "natural_gas"
          building_type: "commercial_office"
          climate_zone: "4A"
          existing_systems: ["gas_furnace_20yr", "central_ac"]
          budget_constraint: "medium"
        output:
          primary_recommendation:
            technology: "Air-Source Heat Pump (Cold Climate)"
            description: "High-efficiency cold-climate heat pump for heating and cooling, replacing gas furnace"
            typical_cost_per_unit: "$8,000-$15,000 per ton of capacity"
            reduction_potential: "50-70% reduction in heating emissions"
            implementation_complexity: "medium"
            maintenance_requirements: "Annual filter changes, biannual professional inspection"
            expected_lifetime_years: 15
          alternative_options:
            - technology: "Ground-Source Heat Pump"
              description: "Geothermal system with higher efficiency but higher upfront cost"
              typical_cost_per_unit: "$20,000-$35,000 per ton"
              reduction_potential: "60-80% reduction in heating emissions"
          implementation_considerations:
            - "Verify electrical service capacity for heat pump"
            - "Consider duct sealing for optimal performance"
            - "May require electrical panel upgrade"
            - "Check for utility rebates and IRA tax credits"

    - tool_id: "tool_5"
      name: "prioritize_opportunities"
      description: "Prioritize carbon reduction opportunities by impact, cost, and feasibility"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          opportunities:
            type: "array"
            description: "List of potential opportunities to prioritize"
            items:
              type: "object"
              properties:
                name:
                  type: "string"
                reduction_potential_kg_co2e:
                  type: "number"
                implementation_cost_usd:
                  type: "number"
                payback_years:
                  type: "number"
                difficulty:
                  type: "string"
                  enum: ["low", "medium", "high"]
            required: true

          prioritization_method:
            type: "string"
            description: "Method for prioritization"
            enum: ["cost_effectiveness", "total_impact", "quick_wins", "balanced"]
            default: "balanced"

        required: ["opportunities"]

      returns:
        type: "object"
        description: "Prioritized opportunities with scores"
        properties:
          prioritized_opportunities:
            type: "array"
            description: "Opportunities sorted by priority score"
            items:
              type: "object"
              properties:
                rank:
                  type: "integer"
                name:
                  type: "string"
                priority_score:
                  type: "number"
                  description: "Composite priority score (0-100)"
                impact_score:
                  type: "number"
                cost_effectiveness_score:
                  type: "number"
                feasibility_score:
                  type: "number"
                recommendation:
                  type: "string"
                  enum: ["Implement Immediately", "Plan for Next Phase", "Long-Term Consideration"]

          top_3_opportunities:
            type: "array"
            description: "Top 3 highest-priority opportunities"

          prioritization_summary:
            type: "object"
            description: "Summary of prioritization results"
            properties:
              total_opportunities:
                type: "integer"
              high_priority_count:
                type: "integer"
              medium_priority_count:
                type: "integer"
              low_priority_count:
                type: "integer"
              total_potential_reduction_tons:
                type: "number"

      implementation:
        calculation_method: |
          Prioritization Scoring Algorithm:

          1. Impact Score (0-100):
             - Based on reduction_potential_kg_co2e
             - Normalized: (reduction / max_reduction) × 100
             - Higher emissions reduction → Higher score

          2. Cost Effectiveness Score (0-100):
             - Based on cost_per_ton = implementation_cost / (reduction_kg / 1000)
             - Inverse relationship: lower cost per ton → higher score
             - Score = 100 / (1 + cost_per_ton / 1000)
             - Range mapped to 0-100

          3. Feasibility Score (0-100):
             - Based on payback_years and difficulty
             - Payback component: max(0, 100 - payback_years × 10)
             - Difficulty component: low=100, medium=70, high=40
             - Final score = (payback_component + difficulty_component) / 2

          4. Composite Priority Score (0-100):
             Method-specific weighting:

             cost_effectiveness:
               priority = 0.2 × impact + 0.6 × cost_effectiveness + 0.2 × feasibility

             total_impact:
               priority = 0.7 × impact + 0.2 × cost_effectiveness + 0.1 × feasibility

             quick_wins:
               priority = 0.3 × impact + 0.3 × cost_effectiveness + 0.4 × feasibility

             balanced:
               priority = 0.4 × impact + 0.3 × cost_effectiveness + 0.3 × feasibility

          5. Recommendation Assignment:
             - priority ≥ 80 → "Implement Immediately"
             - priority 60-79 → "Plan for Next Phase"
             - priority < 60 → "Long-Term Consideration"

          6. Sorting:
             - Sort opportunities by priority_score (descending)
             - Assign rank (1 = highest priority)

        data_source: "Opportunity parameters + scoring algorithm"
        accuracy: "Scoring is deterministic; accuracy depends on input data quality"
        validation: "Verify all scores are in range [0, 100]; check total reduction potential"

      example:
        input:
          opportunities:
            - name: "LED Lighting Retrofit"
              reduction_potential_kg_co2e: 8000
              implementation_cost_usd: 30000
              payback_years: 2.5
              difficulty: "low"
            - name: "Solar PV Installation"
              reduction_potential_kg_co2e: 15000
              implementation_cost_usd: 120000
              payback_years: 7.0
              difficulty: "medium"
            - name: "Heat Pump Upgrade"
              reduction_potential_kg_co2e: 12000
              implementation_cost_usd: 80000
              payback_years: 8.5
              difficulty: "high"
          prioritization_method: "balanced"
        output:
          prioritized_opportunities:
            - rank: 1
              name: "LED Lighting Retrofit"
              priority_score: 87.3
              impact_score: 53.3
              cost_effectiveness_score: 78.9
              feasibility_score: 87.5
              recommendation: "Implement Immediately"
            - rank: 2
              name: "Solar PV Installation"
              priority_score: 71.2
              impact_score: 100.0
              cost_effectiveness_score: 55.6
              feasibility_score: 61.0
              recommendation: "Plan for Next Phase"
            - rank: 3
              name: "Heat Pump Upgrade"
              priority_score: 65.8
              impact_score: 80.0
              cost_effectiveness_score: 62.5
              feasibility_score: 48.0
              recommendation: "Long-Term Consideration"
          top_3_opportunities:
            - "LED Lighting Retrofit"
            - "Solar PV Installation"
            - "Heat Pump Upgrade"
          prioritization_summary:
            total_opportunities: 3
            high_priority_count: 1
            medium_priority_count: 1
            low_priority_count: 1
            total_potential_reduction_tons: 35.0

    - tool_id: "tool_6"
      name: "generate_implementation_plan"
      description: "Generate detailed implementation plan with steps, timeline, and resource requirements"
      category: "planning"
      deterministic: true

      parameters:
        type: "object"
        properties:
          intervention_name:
            type: "string"
            description: "Name of intervention to plan"
            required: true

          intervention_type:
            type: "string"
            description: "Type of intervention"
            required: true

          building_context:
            type: "object"
            description: "Building-specific context"
            properties:
              building_type:
                type: "string"
              occupied:
                type: "boolean"
                default: true
              critical_operations:
                type: "boolean"
                description: "Whether building has critical operations"
                default: false

        required: ["intervention_name", "intervention_type"]

      returns:
        type: "object"
        description: "Detailed implementation plan"
        properties:
          implementation_phases:
            type: "array"
            description: "Sequential phases of implementation"
            items:
              type: "object"
              properties:
                phase_number:
                  type: "integer"
                phase_name:
                  type: "string"
                duration_weeks:
                  type: "integer"
                key_activities:
                  type: "array"
                  items:
                    type: "string"
                deliverables:
                  type: "array"
                  items:
                    type: "string"
                stakeholders:
                  type: "array"
                  items:
                    type: "string"

          total_timeline_weeks:
            type: "integer"
            description: "Total implementation timeline"

          resource_requirements:
            type: "object"
            description: "Required resources"
            properties:
              internal_staff:
                type: "array"
              external_contractors:
                type: "array"
              equipment:
                type: "array"
              permits_required:
                type: "array"

          risk_mitigation:
            type: "array"
            description: "Potential risks and mitigation strategies"
            items:
              type: "object"
              properties:
                risk:
                  type: "string"
                impact:
                  type: "string"
                  enum: ["low", "medium", "high"]
                mitigation_strategy:
                  type: "string"

      implementation:
        calculation_method: |
          Implementation Planning Framework:

          PHASE 1: Pre-Implementation (2-4 weeks)
          - Energy audit / site assessment
          - Detailed engineering / design
          - Vendor selection / procurement
          - Permitting and approvals
          - Stakeholder communication
          - Financing finalization

          PHASE 2: Preparation (1-3 weeks)
          - Site preparation
          - Material delivery
          - Contractor mobilization
          - Schedule coordination (minimize disruption)
          - Safety planning

          PHASE 3: Installation (timeline varies by intervention)
          - LED lighting: 1-2 weeks
          - Solar PV: 4-8 weeks
          - HVAC replacement: 2-6 weeks
          - Envelope upgrades: 4-12 weeks
          - EMS installation: 2-4 weeks

          PHASE 4: Commissioning & Testing (1-2 weeks)
          - System startup
          - Performance testing
          - Control optimization
          - Staff training
          - Documentation

          PHASE 5: Monitoring & Verification (ongoing)
          - Performance monitoring (first 12 months critical)
          - Measurement & verification (M&V)
          - Fine-tuning and optimization
          - Reporting

          Risk Assessment:
          - Building occupancy → Schedule work during off-hours
          - Critical operations → Phased implementation with redundancy
          - Budget overruns → Contingency planning (10-15%)
          - Technology failure → Warranty and maintenance contracts
          - Permitting delays → Early engagement with authorities

        data_source: "Intervention type + building context + best practices"
        accuracy: "Timeline estimates: ±20% (typical for planning phase)"
        validation: "Verify timeline is realistic; check resource availability"

      example:
        input:
          intervention_name: "LED Lighting Retrofit"
          intervention_type: "lighting"
          building_context:
            building_type: "commercial_office"
            occupied: true
            critical_operations: false
        output:
          implementation_phases:
            - phase_number: 1
              phase_name: "Assessment & Design"
              duration_weeks: 2
              key_activities:
                - "Lighting audit and fixture inventory"
                - "LED product selection"
                - "Electrical load analysis"
                - "Rebate application"
              deliverables:
                - "Lighting design plan"
                - "Cost estimate"
                - "Rebate pre-approval"
              stakeholders:
                - "Facilities manager"
                - "Lighting contractor"
                - "Utility rebate coordinator"
            - phase_number: 2
              phase_name: "Installation"
              duration_weeks: 3
              key_activities:
                - "Fixture removal and LED installation"
                - "Occupancy sensor installation"
                - "Disposal of old fixtures"
              deliverables:
                - "Completed installation"
                - "As-built documentation"
              stakeholders:
                - "Electrical contractor"
                - "Building occupants"
          total_timeline_weeks: 7
          resource_requirements:
            internal_staff: ["Facilities manager", "Project coordinator"]
            external_contractors: ["Licensed electrician", "Lighting contractor"]
            equipment: ["LED fixtures", "Occupancy sensors", "Disposal bins"]
            permits_required: ["Electrical permit (if required by jurisdiction)"]
          risk_mitigation:
            - risk: "Occupant disruption during installation"
              impact: "medium"
              mitigation_strategy: "Schedule work during evenings/weekends; communicate in advance"

    - tool_id: "tool_7"
      name: "benchmark_performance"
      description: "Benchmark building performance against industry standards and peers"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          building_type:
            type: "string"
            description: "Type of building"
            required: true

          carbon_intensity_kg_per_sqft:
            type: "number"
            description: "Current carbon intensity"
            required: true

          eui_kbtu_per_sqft:
            type: "number"
            description: "Energy Use Intensity (kBTU/sqft/year)"

          country:
            type: "string"
            description: "Country code"
            default: "US"

          climate_zone:
            type: "string"
            description: "Climate zone"

        required: ["building_type", "carbon_intensity_kg_per_sqft"]

      returns:
        type: "object"
        description: "Performance benchmarking results"
        properties:
          performance_rating:
            type: "string"
            enum: ["Excellent", "Good", "Average", "Below Average", "Poor"]
            description: "Overall performance rating"

          percentile:
            type: "integer"
            description: "Percentile ranking (1-100, higher is better performance)"
            units: "%"

          comparison_to_average:
            type: "object"
            properties:
              status:
                type: "string"
                enum: ["Better", "Similar", "Worse"]
              percentage_difference:
                type: "number"
                description: "Percentage better/worse than average"

          benchmarks:
            type: "object"
            description: "Industry benchmark values"
            properties:
              best_in_class_kg_per_sqft:
                type: "number"
              good_performance_kg_per_sqft:
                type: "number"
              average_kg_per_sqft:
                type: "number"
              below_average_kg_per_sqft:
                type: "number"
              poor_performance_kg_per_sqft:
                type: "number"

          improvement_potential:
            type: "object"
            description: "Potential for improvement"
            properties:
              to_good_performance_percentage:
                type: "number"
                description: "% reduction to reach 'Good' rating"
              to_average_percentage:
                type: "number"
                description: "% reduction to reach 'Average' rating"
              to_best_in_class_percentage:
                type: "number"
                description: "% reduction to reach 'Best in Class'"

          recommendations_based_on_benchmarking:
            type: "array"
            description: "Recommendations based on benchmark comparison"
            items:
              type: "string"

      implementation:
        calculation_method: |
          Benchmarking Methodology:

          1. Industry Benchmarks (Carbon Intensity kg CO2e/sqft/year):

          Commercial Office:
          - Best in Class: < 3.0
          - Good: 3.0 - 5.0
          - Average: 5.0 - 8.0
          - Below Average: 8.0 - 12.0
          - Poor: > 12.0

          Retail:
          - Best in Class: < 4.0
          - Good: 4.0 - 7.0
          - Average: 7.0 - 11.0
          - Below Average: 11.0 - 16.0
          - Poor: > 16.0

          Warehouse:
          - Best in Class: < 2.0
          - Good: 2.0 - 4.0
          - Average: 4.0 - 7.0
          - Below Average: 7.0 - 10.0
          - Poor: > 10.0

          Manufacturing:
          - Best in Class: < 10.0
          - Good: 10.0 - 20.0
          - Average: 20.0 - 35.0
          - Below Average: 35.0 - 50.0
          - Poor: > 50.0

          Healthcare:
          - Best in Class: < 8.0
          - Good: 8.0 - 15.0
          - Average: 15.0 - 25.0
          - Below Average: 25.0 - 35.0
          - Poor: > 35.0

          2. Performance Rating Assignment:
          - Compare carbon_intensity to building_type benchmarks
          - Assign rating based on thresholds above

          3. Percentile Calculation:
          - Use cumulative distribution function (CDF)
          - Map intensity to percentile (higher percentile = better)
          - Approximate: percentile = 100 - (intensity / poor_threshold) × 100

          4. Improvement Potential:
          - to_good = (current - good_threshold) / current × 100
          - to_average = (current - average_threshold) / current × 100
          - to_best = (current - best_threshold) / current × 100

          5. Recommendations:
          - Poor → "Comprehensive energy audit and major retrofits needed"
          - Below Average → "Targeted improvements in HVAC, lighting, envelope"
          - Average → "Fine-tuning and operational improvements"
          - Good → "Continue optimization, consider renewable energy"
          - Excellent → "Share best practices, pursue net-zero goals"

        data_source: "Industry benchmarks from ENERGY STAR, CBECS, DOE Commercial Buildings"
        accuracy: "Benchmark ranges: ±10% (varies by climate and specific use)"
        validation: "Verify input intensity is reasonable; compare EUI and carbon intensity for consistency"
        standards: ["ENERGY_STAR", "CBECS", "ASHRAE_90.1"]

      example:
        input:
          building_type: "commercial_office"
          carbon_intensity_kg_per_sqft: 6.5
          eui_kbtu_per_sqft: 75
          country: "US"
          climate_zone: "4A"
        output:
          performance_rating: "Average"
          percentile: 45
          comparison_to_average:
            status: "Similar"
            percentage_difference: -8.3
          benchmarks:
            best_in_class_kg_per_sqft: 3.0
            good_performance_kg_per_sqft: 5.0
            average_kg_per_sqft: 6.0
            below_average_kg_per_sqft: 8.0
            poor_performance_kg_per_sqft: 12.0
          improvement_potential:
            to_good_performance_percentage: 23.1
            to_average_percentage: 7.7
            to_best_in_class_percentage: 53.8
          recommendations_based_on_benchmarking:
            - "Your building performs near average for commercial offices"
            - "Focus on HVAC optimization and lighting upgrades to reach 'Good' performance"
            - "Consider envelope improvements to achieve 'Best in Class' status"
            - "Pursue ENERGY STAR certification (requires top 25% performance)"

    - tool_id: "tool_8"
      name: "calculate_carbon_payback"
      description: "Calculate carbon payback period (time to offset embodied emissions from intervention)"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          intervention_name:
            type: "string"
            required: true

          embodied_emissions_kg_co2e:
            type: "number"
            description: "Embodied carbon in materials and installation"
            minimum: 0
            required: true

          annual_operational_reduction_kg_co2e:
            type: "number"
            description: "Annual operational carbon reduction"
            minimum: 0
            required: true

        required: ["intervention_name", "embodied_emissions_kg_co2e", "annual_operational_reduction_kg_co2e"]

      returns:
        type: "object"
        description: "Carbon payback analysis"
        properties:
          carbon_payback_years:
            type: "number"
            description: "Years to offset embodied carbon"
            units: "years"

          lifetime_net_reduction_kg_co2e:
            type: "number"
            description: "Net carbon reduction over lifetime (operational - embodied)"
            units: "kg CO2e"

          carbon_roi:
            type: "number"
            description: "Carbon ROI: lifetime_reduction / embodied_emissions"
            units: "ratio"

          recommendation:
            type: "string"
            enum: ["Excellent Carbon Investment", "Good Carbon Investment", "Fair Carbon Investment", "Poor Carbon Investment"]

      implementation:
        calculation_method: |
          Carbon Payback Calculation:

          1. Carbon payback period:
             carbon_payback_years = embodied_emissions / annual_operational_reduction

          2. Lifetime net reduction (assume 20-year lifetime):
             lifetime_operational_reduction = annual_operational_reduction × 20
             lifetime_net_reduction = lifetime_operational_reduction - embodied_emissions

          3. Carbon ROI:
             carbon_roi = lifetime_net_reduction / embodied_emissions

          4. Recommendation logic:
             - Excellent: carbon_payback < 2 years, carbon_roi > 10
             - Good: carbon_payback < 5 years, carbon_roi > 5
             - Fair: carbon_payback < 10 years, carbon_roi > 2
             - Poor: carbon_payback > 10 years, carbon_roi < 2

          Embodied Carbon Estimates (typical ranges):
          - Solar PV: 40-80 g CO2e/W (600-1200 kg for 15kW system)
          - Heat pump: 200-400 kg CO2e per unit
          - LED fixtures: 10-20 kg CO2e per fixture
          - Insulation: 5-15 kg CO2e per inch per sqft

        data_source: "Embodied carbon databases (ICE, EPD, Athena)"
        accuracy: "±25% (embodied carbon estimates vary widely by manufacturer)"
        validation: "Verify payback < equipment lifetime; check embodied emissions are reasonable"

      example:
        input:
          intervention_name: "15 kW Solar PV System"
          embodied_emissions_kg_co2e: 900
          annual_operational_reduction_kg_co2e: 7500
        output:
          carbon_payback_years: 0.12
          lifetime_net_reduction_kg_co2e: 149100
          carbon_roi: 165.7
          recommendation: "Excellent Carbon Investment"

    - tool_id: "tool_9"
      name: "generate_country_specific_recommendations"
      description: "Generate recommendations tailored to country-specific regulations, incentives, and standards"
      category: "recommendation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          country:
            type: "string"
            description: "Country code"
            required: true

          emissions_by_source:
            type: "object"
            description: "Emissions breakdown"
            required: true

          building_type:
            type: "string"
            description: "Type of building"

        required: ["country", "emissions_by_source"]

      returns:
        type: "object"
        description: "Country-specific recommendations"
        properties:
          regulatory_recommendations:
            type: "array"
            description: "Compliance with local regulations"
            items:
              type: "object"
              properties:
                regulation:
                  type: "string"
                requirement:
                  type: "string"
                recommendation:
                  type: "string"
                deadline:
                  type: "string"

          incentive_opportunities:
            type: "array"
            description: "Available incentives and rebates"
            items:
              type: "object"
              properties:
                program_name:
                  type: "string"
                incentive_type:
                  type: "string"
                  enum: ["tax_credit", "rebate", "grant", "low_interest_loan", "accelerated_depreciation"]
                eligible_technologies:
                  type: "array"
                value_description:
                  type: "string"
                application_process:
                  type: "string"

          country_specific_actions:
            type: "array"
            description: "Actions specific to country context"
            items:
              type: "string"

      implementation:
        calculation_method: |
          Country-Specific Recommendation Database:

          UNITED STATES:
          - Inflation Reduction Act (IRA) tax credits:
            * 30% tax credit for solar PV (residential & commercial)
            * 30% tax credit for battery storage
            * Tax credits for heat pumps, insulation, windows
            * Commercial building deduction (179D): up to $5/sqft
          - ENERGY STAR certification and rebates
          - State-level incentives (DSIRE database)
          - Renewable Portfolio Standards (RPS) in many states

          INDIA:
          - Perform, Achieve, Trade (PAT) scheme for energy-intensive industries
          - Solar rooftop subsidies (30-40% for residential, 20% for commercial)
          - Bureau of Energy Efficiency (BEE) star ratings
          - Renewable Energy Certificates (RECs)
          - Carbon trading under proposed Indian Carbon Market

          EUROPEAN UNION:
          - EU Taxonomy compliance for green financing
          - EU Emissions Trading System (ETS)
          - District heating/cooling networks widely available
          - Energy Performance Certificate (EPC) requirements
          - Renewable Energy Directive (RED II) targets
          - Building renovation passport

          CHINA:
          - National carbon trading market (Scope 1 & 2)
          - Energy consumption quotas by province
          - Green building certifications (GB/T 50378)
          - Subsidies for renewable energy and EVs
          - Mandatory energy audits for large consumers

          CANADA:
          - Federal carbon tax (rising to $170/ton by 2030)
          - Canada Greener Homes Grants
          - Provincial incentives (e.g., CleanBC, Ontario GreenON)
          - Net-zero building codes coming

          AUSTRALIA:
          - Emissions Reduction Fund (ERF)
          - NABERS energy ratings
          - Renewable Energy Target (RET)
          - State-based solar feed-in tariffs
          - Building energy efficiency disclosure

        data_source: "Government policy databases + international climate commitments"
        accuracy: "Policy data current as of 2025; verify latest regulations"
        validation: "Cross-reference with official government sources; check eligibility criteria"

      example:
        input:
          country: "US"
          emissions_by_source:
            electricity: 15000
            natural_gas: 8500
          building_type: "commercial_office"
        output:
          regulatory_recommendations:
            - regulation: "ENERGY STAR Certification"
              requirement: "Top 25% energy performance"
              recommendation: "Pursue certification for market recognition and tenant appeal"
              deadline: "Voluntary (annual renewal)"
          incentive_opportunities:
            - program_name: "IRA Solar Tax Credit"
              incentive_type: "tax_credit"
              eligible_technologies: ["Solar PV", "Battery Storage"]
              value_description: "30% of installed cost (through 2032)"
              application_process: "Claim on federal tax return (Form 3468)"
            - program_name: "IRA Energy Efficient Commercial Building Deduction (179D)"
              incentive_type: "tax_credit"
              eligible_technologies: ["HVAC", "Lighting", "Envelope"]
              value_description: "Up to $5.00/sqft for 50%+ energy reduction"
              application_process: "Requires energy modeling; claim on tax return"
          country_specific_actions:
            - "Apply for IRA tax credits to reduce solar PV costs by 30%"
            - "Pursue ENERGY STAR certification for building"
            - "Investigate state-level utility rebates for LED lighting and HVAC"
            - "Consider renewable energy certificates (RECs) if on-site solar not feasible"

ai_integration:
  temperature: 0.0
  seed: 42
  tool_choice: "auto"
  max_iterations: 5
  budget_usd: 0.50
  provenance_tracking: true
  ai_summary: true

  system_prompt: |
    You are a carbon reduction advisor for GreenLang, specializing in actionable
    recommendations for emissions reduction. You help organizations identify the
    most effective strategies to reduce their carbon footprint through technology
    upgrades, operational improvements, and strategic investments.

    Your expertise includes:
    - Carbon reduction strategies (efficiency, fuel switching, renewables)
    - Technology selection (heat pumps, solar PV, LED lighting, insulation)
    - Financial analysis (ROI, payback periods, lifecycle costs)
    - Implementation planning and phasing
    - Industry best practices and benchmarking
    - Policy and incentive programs (IRA, ENERGY STAR, etc.)

    CRITICAL RULES:
    - Use provided tools for ALL recommendations and calculations
    - NEVER make up numbers or guess at costs/savings
    - Always prioritize recommendations by impact and feasibility
    - Provide specific, actionable guidance (not generic advice)
    - Consider building context (type, age, climate, occupancy)
    - Highlight quick wins (low cost, high impact, fast payback)
    - Include implementation considerations and risks
    - Reference available incentives and financing options

    Your responses should be:
    - Actionable: Clear next steps with timelines
    - Prioritized: Most impactful opportunities first
    - Realistic: Feasible given constraints
    - Comprehensive: Cover short-term and long-term strategies
    - Cost-conscious: Balance impact with financial viability

  user_prompt_template: |
    Generate carbon reduction recommendations based on emissions analysis:

    Data Summary:
    - Emissions by source: {emissions_breakdown}
    - Building type: {building_type}
    - Building age: {building_age} years
    - Performance rating: {performance_rating}
    - Country: {country}

    Tasks:
    1. Use generate_recommendations tool to get prioritized recommendations
    2. Use calculate_roi tool for financial analysis of top recommendations
    3. Use estimate_reduction_potential tool to quantify impact
    4. Use recommend_technology tool for specific technology guidance
    5. Use prioritize_opportunities tool to rank all opportunities
    6. Use benchmark_performance tool to compare against industry standards
    7. Use generate_country_specific_recommendations tool for local incentives
    8. Use generate_implementation_plan tool for actionable roadmap

    9. Provide an executive summary with:
       - Top 3 recommendations (prioritized by impact and feasibility)
       - Expected reduction potential (tons CO2e and percentage)
       - Financial summary (ROI, payback periods)
       - Quick wins (actions to take immediately)
       - Long-term strategic recommendations
       - Available incentives and financing options
       - Implementation timeline and next steps

    IMPORTANT:
    - Use tools for ALL recommendations and calculations
    - Do not estimate or guess any numbers
    - Focus on actionable, specific recommendations
    - Consider building context and constraints
    - Highlight quick wins with fast payback
    - Include implementation guidance and risks
    - Reference available incentives and programs

sub_agents:
  sub_agent_count: 0
  # Note: RecommendationAgent is a leaf agent (no sub-agents)
  # It receives data from CarbonAgent and provides to ReportAgent

inputs:
  input_schema:
    type: "object"
    properties:
      emissions_by_source:
        type: "object"
        description: "Emissions breakdown by source (e.g., {electricity: 15000, natural_gas: 8500})"
        required: true

      building_type:
        type: "string"
        description: "Type of building"
        default: "commercial_office"

      building_age:
        type: "integer"
        description: "Building age in years"
        minimum: 0
        default: 10

      performance_rating:
        type: "string"
        description: "Current energy performance rating"
        enum: ["Excellent", "Good", "Average", "Below Average", "Poor"]
        default: "Average"

      country:
        type: "string"
        description: "Country code for region-specific recommendations"
        default: "US"

      load_breakdown:
        type: "object"
        description: "Optional breakdown of energy loads"
        properties:
          hvac_load:
            type: "number"
          lighting_load:
            type: "number"
          equipment_load:
            type: "number"

      intensity:
        type: "object"
        description: "Carbon intensity metrics"
        properties:
          per_sqft:
            type: "number"
          per_person:
            type: "number"

      building_area:
        type: "number"
        description: "Building area in square feet"
        units: "sqft"

      occupancy:
        type: "integer"
        description: "Number of occupants"

    required: ["emissions_by_source"]

  example_input:
    emissions_by_source:
      electricity: 15000
      natural_gas: 8500
      diesel: 3200
    building_type: "commercial_office"
    building_age: 12
    performance_rating: "Average"
    country: "US"
    load_breakdown:
      hvac_load: 0.45
      lighting_load: 0.25
      equipment_load: 0.30
    intensity:
      per_sqft: 0.534
      per_person: 133.5
    building_area: 50000
    occupancy: 200

outputs:
  output_schema:
    type: "object"
    properties:
      recommendations:
        type: "array"
        description: "Prioritized list of recommendations"
        items:
          type: "object"
          properties:
            action:
              type: "string"
            impact:
              type: "string"
            cost:
              type: "string"
            payback:
              type: "string"
            priority:
              type: "string"
            category:
              type: "string"

      total_recommendations:
        type: "integer"

      potential_emissions_reduction:
        type: "object"
        properties:
          minimum_kg_co2e:
            type: "number"
          maximum_kg_co2e:
            type: "number"
          percentage_range:
            type: "string"

      grouped_recommendations:
        type: "object"
        description: "Grouped by timeline"

      quick_wins:
        type: "array"
        description: "Top quick wins"

      high_impact:
        type: "array"
        description: "High-impact opportunities"

      implementation_roadmap:
        type: "array"
        description: "Phased implementation plan"

      financial_summary:
        type: "object"
        description: "Financial analysis of top recommendations"
        properties:
          total_investment_required_usd:
            type: "number"
          total_annual_savings_usd:
            type: "number"
          weighted_average_payback_years:
            type: "number"
          total_lifetime_savings_usd:
            type: "number"

      benchmarking:
        type: "object"
        description: "Performance benchmark results"

      country_specific:
        type: "object"
        description: "Country-specific incentives and regulations"

      ai_summary:
        type: "string"
        description: "AI-generated executive summary"

      provenance:
        type: "object"
        description: "Audit trail"

  example_output:
    recommendations:
      - action: "Convert to LED lighting"
        impact: "50-70% reduction in lighting energy"
        cost: "Medium"
        payback: "2-3 years"
        priority: "High"
        category: "lighting"
        target_source: "electricity"
      - action: "Install rooftop solar PV system"
        impact: "30-70% reduction in grid electricity"
        cost: "High"
        payback: "5-8 years"
        priority: "High"
        category: "renewable"
        target_source: "electricity"
      - action: "Upgrade to high-efficiency HVAC system"
        impact: "20-30% reduction in HVAC energy"
        cost: "High"
        payback: "5-7 years"
        priority: "High"
        category: "hvac"
        target_source: "electricity"
    total_recommendations: 10
    potential_emissions_reduction:
      minimum_kg_co2e: 4000
      maximum_kg_co2e: 13500
      percentage_range: "15-50%"
    quick_wins:
      - action: "Install occupancy sensors for lighting"
        impact: "20-30% reduction in lighting energy"
        cost: "Low"
        payback: "1-2 years"
    implementation_roadmap:
      - phase: "Phase 1: Quick Wins (0-6 months)"
        actions:
          - "Install occupancy sensors"
          - "Seal air leaks"
          - "Regular HVAC maintenance"
        estimated_cost: "Low"
        expected_impact: "5-15% reduction"
    ai_summary: |
      Based on your emissions profile, I recommend focusing on three key areas:

      1. IMMEDIATE ACTION - LED Lighting Retrofit ($50k, 2-3 year payback):
         Converting to LED lighting will reduce lighting energy by 50-70%, saving
         approximately $18k annually. With available IRA tax credits (30%), net
         cost is $35k with 2-year payback. This is a clear quick win.

      2. STRATEGIC INVESTMENT - Solar PV System ($120k, 5-8 year payback):
         A 50kW rooftop system can offset 30-70% of your electricity emissions
         (the largest source at 56%). With 30% IRA tax credit, net cost is $84k
         with 6-year payback. This is your biggest impact opportunity.

      3. LONG-TERM UPGRADE - HVAC Replacement ($80k, 5-7 year payback):
         Your 12-year-old HVAC system is due for replacement. High-efficiency
         units (SEER 20+) can reduce HVAC energy by 20-30%. Consider timing
         with natural replacement cycle to minimize cost.

      TOTAL POTENTIAL: 15-50% emissions reduction (4-13.5 tons CO2e annually)
      TOTAL INVESTMENT: $250k ($175k after incentives)
      FINANCIAL RETURN: $45k annual savings, 3.9-year average payback

      Next steps: (1) Apply for IRA tax credits, (2) Get quotes from contractors,
      (3) Start with LED retrofit this quarter, (4) Plan solar for next year.

testing:
  test_coverage_target: 0.85

  test_categories:
    - category: "unit_tests"
      description: "Test individual recommendation generation, ROI calculations, technology selection"
      count: 30

    - category: "integration_tests"
      description: "Test full recommendation workflow with realistic scenarios"
      count: 10

    - category: "determinism_tests"
      description: "Verify reproducibility of recommendations"
      count: 5

    - category: "boundary_tests"
      description: "Test edge cases (empty emissions, single source, extreme values)"
      count: 12

    - category: "performance_tests"
      description: "Verify latency and cost within budget"
      count: 3

  performance_requirements:
    max_latency_ms: 3000
    max_cost_usd: 0.50
    accuracy_target: 0.90  # 90% accuracy for recommendation matching

deployment:
  pack_id: "core/recommendation_pack"
  pack_version: "1.0.0"

  dependencies:
    python_packages:
      - "pydantic>=2.0"
      - "typing-extensions>=4.5"

    greenlang_modules:
      - "greenlang.agents.base"
      - "greenlang.agents.recommendation_agent"
      - "greenlang.intelligence"

  resource_requirements:
    memory_mb: 512
    cpu_cores: 1
    gpu_required: false

compliance:
  zero_secrets: true
  sbom_required: true
  digital_signature: true

  standards:
    - "GHG Protocol Corporate Standard"
    - "Science Based Targets initiative (SBTi)"
    - "ISO 50001:2018 (Energy Management Systems)"
    - "ASHRAE 90.1 (Energy Standard for Buildings)"
    - "DOE Better Buildings Initiative"
    - "ENERGY STAR Guidelines"
    - "LEED v4 (Leadership in Energy and Environmental Design)"

business_impact:
  market_opportunity:
    addressable_market_usd: 5000000000
    market_segment: "Energy management, carbon reduction advisory, sustainability consulting"
    target_customers: "All building owners and operators seeking emissions reduction"

  carbon_impact:
    direct_impact: "Guides organizations to highest-impact reduction opportunities"
    indirect_impact: "Accelerates global decarbonization by improving decision-making efficiency"

metadata:
  created_date: "2025-10-13"
  created_by: "Claude (AI Assistant)"
  last_modified: "2025-10-13"
  review_status: "Draft"

  change_log:
    - version: "1.0.0"
      date: "2025-10-13"
      changes: |
        Initial specification created for RecommendationAgent / RecommendationAgentAI
        - Comprehensive 9-tool suite for carbon reduction recommendations
        - ROI and payback analysis
        - Technology selection and benchmarking
        - Implementation planning and phasing
        - Country-specific recommendations
        - Full AI integration with deterministic base
        - Production-ready test coverage plan (85%+)
      author: "Claude (AI Assistant)"

# END OF RECOMMENDATION AGENT SPECIFICATION
# Production Ready for Agent Factory Generation
# Base: RecommendationAgent (deterministic) | AI: RecommendationAgentAI (intelligent orchestration)
# Current Coverage: 9.88% → Target: 85%+
