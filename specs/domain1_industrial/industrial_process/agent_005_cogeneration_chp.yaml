# GreenLang Agent Specification v2.0
# Agent #5: CogenerationCHPAgent_AI
# Specialized agent for combined heat and power (CHP) system analysis, sizing, and economic optimization

agent_metadata:
  agent_id: "industrial/cogeneration_chp_agent"
  agent_name: "CogenerationCHPAgent_AI"
  agent_number: 5
  version: "1.0.0"
  domain: "Domain1_Industrial"
  category: "Industrial_Process"
  complexity: "High"
  priority: "P1_High"
  base_agent: "None"
  status: "Spec_Complete"
  entry_point: false  # Specialized agent for CHP systems

description:
  purpose: |
    Specialized agent for analyzing, sizing, and optimizing combined heat and power
    (CHP/cogeneration) systems for industrial facilities. Provides detailed technology
    selection (gas turbine, reciprocating engine, microturbine, fuel cell, steam turbine),
    thermodynamic efficiency analysis, heat-to-power ratio matching, grid interconnection
    requirements, and comprehensive economic analysis including utility rate structures,
    standby charges, and demand response opportunities.

  strategic_context:
    global_impact: "CHP can reduce industrial emissions by 0.5 Gt CO2e/year (vs separate heat/power)"
    opportunity: "CHP achieves 65-80% total efficiency vs 45-50% for separate generation"
    market_size: "$27B global CHP market (growing 6% annually)"
    technology_maturity: "Proven technology, strong policy support (IRA 2022, state incentives)"

  key_capabilities:
    - "Technology selection: gas turbine (1-50 MW), reciprocating engine (100 kW-10 MW), microturbine (30-500 kW), fuel cell (100 kW-5 MW), steam turbine (500 kW-50 MW)"
    - "Thermodynamic analysis: electrical efficiency, thermal efficiency, total CHP efficiency"
    - "Heat-to-power ratio matching for optimal system sizing"
    - "Heat recovery steam generator (HRSG) design and optimization"
    - "Economic analysis: spark spread, avoided costs, utility rate impacts"
    - "Grid interconnection requirements and standby charge optimization"
    - "Demand response and resilience value quantification"
    - "Fuel flexibility analysis: natural gas, biogas, hydrogen blending"

  dependencies:
    - agent_id: "agents/grid_factor_agent_ai"
      relationship: "receives_data_from"
      data: "Grid electricity prices and carbon intensity"

    - agent_id: "agents/fuel_agent_ai"
      relationship: "receives_data_from"
      data: "Natural gas and alternative fuel pricing"

    - agent_id: "industrial/process_heat_agent"
      relationship: "coordinates_with"
      data: "Thermal load requirements and profiles"

    - agent_id: "industrial/waste_heat_recovery_agent"
      relationship: "coordinates_with"
      data: "Additional waste heat recovery opportunities"

    - agent_id: "agents/project_finance_agent_ai"
      relationship: "provides_data_to"
      data: "CAPEX, OPEX, and complex financial structures"

tools:
  tool_count: 8

  tools_list:
    - tool_id: "tool_1"
      name: "select_chp_technology"
      description: "Recommend optimal CHP technology based on facility requirements and operating profile"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          electrical_demand_kw:
            type: "number"
            description: "Facility electrical demand"
            units: "kW"
            minimum: 50
            maximum: 100000
            required: true

          thermal_demand_mmbtu_hr:
            type: "number"
            description: "Facility thermal demand"
            units: "MMBtu/hr"
            required: true

          heat_to_power_ratio:
            type: "number"
            description: "Required thermal output / electrical output"
            note: "Calculated as (Thermal_MMBtu/hr × 293) / Electrical_kW"
            required: true

          load_profile_type:
            type: "string"
            description: "Operating schedule"
            enum: ["baseload_24x7", "daytime_only", "batch_intermittent", "highly_variable"]
            required: true

          required_electrical_efficiency:
            type: "number"
            description: "Minimum electrical efficiency target"
            minimum: 0.25
            maximum: 0.50
            default: 0.30

          available_fuels:
            type: "array"
            description: "Available fuel options"
            items:
              type: "string"
              enum: ["natural_gas", "biogas", "hydrogen", "propane", "diesel"]
            required: true

          emissions_requirements:
            type: "string"
            description: "Emissions compliance requirements"
            enum: ["standard", "low_nox", "ultra_low_nox", "near_zero"]
            required: true

          grid_export_allowed:
            type: "boolean"
            description: "Can export excess electricity to grid"
            default: false

          resilience_priority:
            type: "string"
            description: "Importance of backup power capability"
            enum: ["low", "medium", "high", "critical"]
            default: "medium"

          space_constraints:
            type: "string"
            enum: ["ample", "moderate", "limited", "very_limited"]
            required: true

        required: ["electrical_demand_kw", "thermal_demand_mmbtu_hr", "heat_to_power_ratio", "load_profile_type", "available_fuels", "emissions_requirements", "space_constraints"]

      returns:
        type: "object"
        properties:
          recommended_technology:
            type: "string"
            enum: ["reciprocating_engine", "gas_turbine", "microturbine", "fuel_cell", "steam_turbine"]

          alternative_technology:
            type: "string"

          technology_description:
            type: "string"

          typical_electrical_efficiency:
            type: "number"
            description: "Electrical efficiency range"

          typical_thermal_efficiency:
            type: "number"
            description: "Recoverable thermal efficiency"

          typical_total_efficiency:
            type: "number"
            description: "Total CHP system efficiency"

          heat_to_power_ratio_achievable:
            type: "number"

          estimated_capex_per_kw:
            type: "number"
            units: "USD/kW"

          maintenance_cost_per_kwh:
            type: "number"
            units: "USD/kWh"

          typical_overhaul_interval_hours:
            type: "number"
            units: "hours"

          key_advantages:
            type: "array"
            items:
              type: "string"

          key_challenges:
            type: "array"
            items:
              type: "string"

          fuel_flexibility:
            type: "string"
            enum: ["excellent", "good", "limited", "poor"]

      implementation:
        calculation_method: "Multi-criteria decision matrix based on heat-to-power ratio, size, efficiency, and site requirements"
        data_source: "CHP technology vendor data, EPA CHP Partnership, DOE CHP Installation Database"
        accuracy: "Decision support quality"
        validation: "Expert review and field installation database"
        standards: ["EPA_CHP_Partnership", "ASHRAE_Applications_CHP"]

      example:
        input:
          electrical_demand_kw: 2000
          thermal_demand_mmbtu_hr: 15.0
          heat_to_power_ratio: 2.2
          load_profile_type: "baseload_24x7"
          required_electrical_efficiency: 0.35
          available_fuels: ["natural_gas", "biogas"]
          emissions_requirements: "low_nox"
          grid_export_allowed: true
          resilience_priority: "high"
          space_constraints: "moderate"
        output:
          recommended_technology: "reciprocating_engine"
          alternative_technology: "gas_turbine"
          technology_description: "Natural gas reciprocating engine with heat recovery - excellent for baseload, high electrical efficiency, good heat-to-power ratio match"
          typical_electrical_efficiency: 0.38
          typical_thermal_efficiency: 0.45
          typical_total_efficiency: 0.83
          heat_to_power_ratio_achievable: 2.0
          estimated_capex_per_kw: 1800
          maintenance_cost_per_kwh: 0.015
          typical_overhaul_interval_hours: 40000
          key_advantages: ["High electrical efficiency", "Excellent for baseload", "Good fuel flexibility", "Proven reliability", "Fast start capability"]
          key_challenges: ["Higher maintenance than turbine", "Noise and vibration", "NOx emissions require SCR"]
          fuel_flexibility: "excellent"

    - tool_id: "tool_2"
      name: "calculate_chp_performance"
      description: "Calculate detailed CHP system electrical, thermal, and total efficiency"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          chp_technology:
            type: "string"
            enum: ["reciprocating_engine", "gas_turbine", "microturbine", "fuel_cell", "steam_turbine"]
            required: true

          electrical_capacity_kw:
            type: "number"
            description: "Electrical output capacity"
            units: "kW"
            required: true

          fuel_input_mmbtu_hr:
            type: "number"
            description: "Fuel input rate (HHV basis)"
            units: "MMBtu/hr"
            required: true

          heat_recovery_configuration:
            type: "string"
            description: "Type of heat recovery"
            enum: ["jacket_water_only", "jacket_exhaust", "hrsg_unfired", "hrsg_supplementary_fired"]
            required: true

          exhaust_temperature_f:
            type: "number"
            description: "Exhaust gas temperature"
            units: "°F"
            required: true

          exhaust_mass_flow_lb_hr:
            type: "number"
            description: "Exhaust gas mass flow rate"
            units: "lb/hr"
            required: true

          heat_recovery_target_temperature_f:
            type: "number"
            description: "Required process heat temperature"
            units: "°F"
            required: true

          ambient_temperature_f:
            type: "number"
            description: "Ambient air temperature"
            units: "°F"
            default: 59

          part_load_ratio:
            type: "number"
            description: "Operating load as fraction of full load"
            minimum: 0.5
            maximum: 1.0
            default: 1.0

        required: ["chp_technology", "electrical_capacity_kw", "fuel_input_mmbtu_hr", "heat_recovery_configuration", "exhaust_temperature_f", "exhaust_mass_flow_lb_hr", "heat_recovery_target_temperature_f"]

      returns:
        type: "object"
        properties:
          electrical_output_kw:
            type: "number"
            units: "kW"

          electrical_efficiency_hhv:
            type: "number"
            description: "Electrical efficiency on HHV basis"

          electrical_efficiency_lhv:
            type: "number"
            description: "Electrical efficiency on LHV basis"

          thermal_output_mmbtu_hr:
            type: "number"
            units: "MMBtu/hr"

          thermal_efficiency:
            type: "number"
            description: "Recoverable thermal efficiency"

          total_chp_efficiency:
            type: "number"
            description: "Combined electrical + thermal efficiency"

          fuel_utilization_effectiveness:
            type: "number"
            description: "FUE = (Elec_out + Thermal_out) / Fuel_in"

          power_heat_ratio:
            type: "number"
            description: "Electrical_kW / (Thermal_MMBtu/hr × 293)"

          exhaust_exit_temperature_f:
            type: "number"
            units: "°F"

          part_load_efficiency_degradation:
            type: "number"
            description: "Efficiency penalty at part load"

      implementation:
        physics_formula: |
          Electrical Efficiency:
            η_elec = Electrical_Output_kW × 3412 / (Fuel_Input_MMBtu/hr × 1,000,000)

          Thermal Recovery (simplified):
            Q_thermal = m_exhaust × cp × (T_exhaust - T_exit) × Heat_Exchanger_Effectiveness

          Total CHP Efficiency:
            η_total = (Elec_Output + Thermal_Output) / Fuel_Input

          Power-to-Heat Ratio:
            PHR = Elec_kW / (Thermal_MMBtu/hr × 293.07)
            (293.07 converts MMBtu/hr to kW thermal equivalent)
        calculation_method: "Energy balance with technology-specific performance curves"
        data_source: "Manufacturer data, EPA CHP Partnership performance database"
        accuracy: "±3% for efficiency calculations"
        validation: "Compare with field performance data and acceptance testing"
        standards: ["ASME_PTC_50_CHP_Systems", "ISO_2314_Gas_Turbines"]

      example:
        input:
          chp_technology: "reciprocating_engine"
          electrical_capacity_kw: 2000
          fuel_input_mmbtu_hr: 19.0
          heat_recovery_configuration: "jacket_exhaust"
          exhaust_temperature_f: 950
          exhaust_mass_flow_lb_hr: 26000
          heat_recovery_target_temperature_f: 250
          ambient_temperature_f: 59
          part_load_ratio: 1.0
        output:
          electrical_output_kw: 2000
          electrical_efficiency_hhv: 0.358
          electrical_efficiency_lhv: 0.396
          thermal_output_mmbtu_hr: 8.5
          thermal_efficiency: 0.447
          total_chp_efficiency: 0.805
          fuel_utilization_effectiveness: 0.805
          power_heat_ratio: 0.69
          exhaust_exit_temperature_f: 280
          part_load_efficiency_degradation: 0.00

    - tool_id: "tool_3"
      name: "size_chp_system"
      description: "Optimize CHP system size based on electrical and thermal load profiles"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          peak_electrical_demand_kw:
            type: "number"
            units: "kW"
            required: true

          average_electrical_demand_kw:
            type: "number"
            units: "kW"
            required: true

          peak_thermal_demand_mmbtu_hr:
            type: "number"
            units: "MMBtu/hr"
            required: true

          average_thermal_demand_mmbtu_hr:
            type: "number"
            units: "MMBtu/hr"
            required: true

          hourly_electrical_load_profile:
            type: "array"
            description: "8760 hourly electrical loads (kW)"
            items:
              type: "number"
            minItems: 8760
            maxItems: 8760
            note: "Full year data for detailed analysis"

          hourly_thermal_load_profile:
            type: "array"
            description: "8760 hourly thermal loads (MMBtu/hr)"
            items:
              type: "number"
            minItems: 8760
            maxItems: 8760

          sizing_strategy:
            type: "string"
            description: "CHP sizing approach"
            enum: ["match_thermal_baseload", "match_electrical_baseload", "match_minimum_load", "optimize_economics"]
            required: true

          grid_export_allowed:
            type: "boolean"
            default: false

          thermal_storage_available:
            type: "boolean"
            default: false

          thermal_storage_hours:
            type: "number"
            description: "Hours of thermal storage"
            default: 0

        required: ["peak_electrical_demand_kw", "average_electrical_demand_kw", "peak_thermal_demand_mmbtu_hr", "average_thermal_demand_mmbtu_hr", "sizing_strategy"]

      returns:
        type: "object"
        properties:
          recommended_chp_size_kw:
            type: "number"
            units: "kW"

          chp_capacity_factor:
            type: "number"
            description: "Average load / CHP capacity"

          annual_chp_electrical_generation_kwh:
            type: "number"
            units: "kWh/year"

          percent_electrical_load_served_by_chp:
            type: "number"
            units: "%"

          annual_chp_thermal_generation_mmbtu:
            type: "number"
            units: "MMBtu/year"

          percent_thermal_load_served_by_chp:
            type: "number"
            units: "%"

          supplementary_boiler_capacity_mmbtu_hr:
            type: "number"
            units: "MMBtu/hr"

          annual_supplementary_boiler_use_mmbtu:
            type: "number"
            units: "MMBtu/year"

          annual_grid_purchase_kwh:
            type: "number"
            units: "kWh/year"

          annual_grid_export_kwh:
            type: "number"
            units: "kWh/year"
            description: "If export allowed"

          sizing_rationale:
            type: "string"

      implementation:
        calculation_method: "Load duration curve analysis with hourly profile matching"
        accuracy: "±5% for annual generation prediction"
        validation: "Compare with installed CHP systems performance data"

      example:
        input:
          peak_electrical_demand_kw: 3500
          average_electrical_demand_kw: 2200
          peak_thermal_demand_mmbtu_hr: 20.0
          average_thermal_demand_mmbtu_hr: 12.0
          sizing_strategy: "match_thermal_baseload"
          grid_export_allowed: false
          thermal_storage_available: true
          thermal_storage_hours: 4
        output:
          recommended_chp_size_kw: 2000
          chp_capacity_factor: 0.92
          annual_chp_electrical_generation_kwh: 16099200
          percent_electrical_load_served_by_chp: 83.5
          annual_chp_thermal_generation_mmbtu: 74230
          percent_thermal_load_served_by_chp: 70.6
          supplementary_boiler_capacity_mmbtu_hr: 12.0
          annual_supplementary_boiler_use_mmbtu: 30900
          annual_grid_purchase_kwh: 3176800
          annual_grid_export_kwh: 0
          sizing_rationale: "Sized to thermal baseload (70% of average thermal demand) with 92% capacity factor. Thermal storage enables load shifting. Supplementary boiler for peak thermal periods."

    - tool_id: "tool_4"
      name: "calculate_spark_spread"
      description: "Calculate spark spread (electricity value vs gas cost) to assess CHP economics"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          electricity_price_usd_per_kwh:
            type: "number"
            description: "Price of grid electricity being displaced"
            units: "USD/kWh"
            required: true

          natural_gas_price_usd_per_mmbtu:
            type: "number"
            description: "Natural gas fuel price"
            units: "USD/MMBtu"
            required: true

          chp_electrical_efficiency:
            type: "number"
            description: "CHP electrical efficiency (HHV)"
            minimum: 0.20
            maximum: 0.50
            required: true

          electricity_demand_charge_usd_per_kw:
            type: "number"
            description: "Monthly demand charge"
            units: "USD/kW/month"
            default: 0

          chp_capacity_kw:
            type: "number"
            description: "CHP system capacity"
            units: "kW"
            required: true

          utility_standby_charge_usd_per_kw:
            type: "number"
            description: "Standby/backup charge for CHP interconnection"
            units: "USD/kW/month"
            default: 0

          interconnection_fee_usd_per_month:
            type: "number"
            units: "USD/month"
            default: 0

        required: ["electricity_price_usd_per_kwh", "natural_gas_price_usd_per_mmbtu", "chp_electrical_efficiency", "chp_capacity_kw"]

      returns:
        type: "object"
        properties:
          spark_spread_usd_per_kwh:
            type: "number"
            units: "USD/kWh"
            description: "Net value of CHP electricity generation"

          spark_spread_usd_per_mmbtu:
            type: "number"
            units: "USD/MMBtu"

          fuel_cost_per_kwh_generated:
            type: "number"
            units: "USD/kWh"

          avoided_electricity_cost_per_kwh:
            type: "number"
            units: "USD/kWh"

          net_demand_charge_savings_usd_per_month:
            type: "number"
            units: "USD/month"

          effective_spark_spread_with_demand:
            type: "number"
            units: "USD/kWh"
            description: "Including demand charge benefits"

          break_even_gas_price_usd_per_mmbtu:
            type: "number"
            units: "USD/MMBtu"
            description: "Gas price at which CHP economics = grid"

          spark_spread_favorability:
            type: "string"
            enum: ["excellent", "good", "marginal", "unfavorable"]

      implementation:
        physics_formula: |
          Fuel cost per kWh generated:
            Fuel_Cost_per_kWh = Gas_Price_$/MMBtu × (3412 Btu/kWh) / (Efficiency × 1,000,000 Btu/MMBtu)
            Simplified: Fuel_Cost_per_kWh = Gas_Price × 3.412 / (Efficiency × 1000)

          Spark Spread:
            Spark_Spread = Electricity_Price - Fuel_Cost_per_kWh

          With demand charges:
            Demand_Savings_per_kWh = (Demand_Charge × CHP_Capacity × 12) / Annual_kWh
            Effective_Spark_Spread = Spark_Spread + Demand_Savings_per_kWh - Standby_per_kWh
        calculation_method: "Energy arbitrage analysis with utility rate structure impacts"
        accuracy: "±2% for spark spread calculation"
        validation: "Cross-check with utility bill analysis"

      example:
        input:
          electricity_price_usd_per_kwh: 0.12
          natural_gas_price_usd_per_mmbtu: 8.0
          chp_electrical_efficiency: 0.38
          electricity_demand_charge_usd_per_kw: 15.0
          chp_capacity_kw: 2000
          utility_standby_charge_usd_per_kw: 3.0
          interconnection_fee_usd_per_month: 500
        output:
          spark_spread_usd_per_kwh: 0.0481
          spark_spread_usd_per_mmbtu: 14.09
          fuel_cost_per_kwh_generated: 0.0719
          avoided_electricity_cost_per_kwh: 0.12
          net_demand_charge_savings_usd_per_month: 24000
          effective_spark_spread_with_demand: 0.0629
          break_even_gas_price_usd_per_mmbtu: 13.35
          spark_spread_favorability: "good"

    - tool_id: "tool_5"
      name: "calculate_chp_economics"
      description: "Comprehensive economic analysis of CHP investment including all cost components"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          chp_capacity_kw:
            type: "number"
            units: "kW"
            required: true

          chp_capex_per_kw:
            type: "number"
            units: "USD/kW"
            required: true

          annual_chp_generation_kwh:
            type: "number"
            units: "kWh/year"
            required: true

          annual_thermal_generation_mmbtu:
            type: "number"
            units: "MMBtu/year"
            required: true

          electricity_price_usd_per_kwh:
            type: "number"
            units: "USD/kWh"
            required: true

          gas_price_usd_per_mmbtu:
            type: "number"
            units: "USD/MMBtu"
            required: true

          displaced_boiler_efficiency:
            type: "number"
            default: 0.82

          chp_electrical_efficiency:
            type: "number"
            required: true

          chp_thermal_efficiency:
            type: "number"
            required: true

          annual_demand_charge_savings_usd:
            type: "number"
            units: "USD/year"
            default: 0

          maintenance_cost_per_kwh:
            type: "number"
            units: "USD/kWh"
            required: true

          major_overhaul_interval_hours:
            type: "number"
            default: 40000

          major_overhaul_cost_per_kw:
            type: "number"
            units: "USD/kW"
            default: 200

          federal_itc_percent:
            type: "number"
            description: "Federal Investment Tax Credit"
            default: 30
            note: "IRA 2022: 30% for CHP meeting efficiency criteria"

          state_incentive_usd:
            type: "number"
            default: 0

          utility_rebate_usd_per_kw:
            type: "number"
            units: "USD/kW"
            default: 0

          energy_cost_escalation_rate:
            type: "number"
            default: 0.03

          discount_rate:
            type: "number"
            default: 0.08

          analysis_period_years:
            type: "number"
            default: 20

        required: ["chp_capacity_kw", "chp_capex_per_kw", "annual_chp_generation_kwh", "annual_thermal_generation_mmbtu", "electricity_price_usd_per_kwh", "gas_price_usd_per_mmbtu", "chp_electrical_efficiency", "chp_thermal_efficiency", "maintenance_cost_per_kwh"]

      returns:
        type: "object"
        properties:
          total_project_cost_usd:
            type: "number"
            units: "USD"

          net_cost_after_incentives_usd:
            type: "number"
            units: "USD"

          annual_electricity_savings_usd:
            type: "number"
            units: "USD/year"

          annual_thermal_savings_usd:
            type: "number"
            units: "USD/year"

          annual_fuel_cost_usd:
            type: "number"
            units: "USD/year"

          annual_maintenance_cost_usd:
            type: "number"
            units: "USD/year"

          net_annual_savings_usd:
            type: "number"
            units: "USD/year"

          simple_payback_years:
            type: "number"
            units: "years"

          discounted_payback_years:
            type: "number"
            units: "years"

          net_present_value_usd:
            type: "number"
            units: "USD"

          internal_rate_of_return:
            type: "number"

          levelized_cost_of_electricity_usd_per_kwh:
            type: "number"
            units: "USD/kWh"

          savings_to_investment_ratio:
            type: "number"

          first_year_cash_flow_usd:
            type: "number"
            units: "USD"

      implementation:
        calculation_method: "Lifecycle cost analysis with NPV, IRR, and levelized cost calculations"
        accuracy: "±5% for financial metrics"
        validation: "Compare with project finance models"
        standards: ["NIST_Handbook_135_LCC", "FEMP_Energy_Analysis"]

      example:
        input:
          chp_capacity_kw: 2000
          chp_capex_per_kw: 1800
          annual_chp_generation_kwh: 16099200
          annual_thermal_generation_mmbtu: 74230
          electricity_price_usd_per_kwh: 0.12
          gas_price_usd_per_mmbtu: 8.0
          displaced_boiler_efficiency: 0.82
          chp_electrical_efficiency: 0.38
          chp_thermal_efficiency: 0.45
          annual_demand_charge_savings_usd: 288000
          maintenance_cost_per_kwh: 0.015
          major_overhaul_interval_hours: 40000
          major_overhaul_cost_per_kw: 200
          federal_itc_percent: 30
          state_incentive_usd: 200000
          utility_rebate_usd_per_kw: 250
          energy_cost_escalation_rate: 0.03
          discount_rate: 0.08
          analysis_period_years: 20
        output:
          total_project_cost_usd: 3600000
          net_cost_after_incentives_usd: 1820000
          annual_electricity_savings_usd: 1931904
          annual_thermal_savings_usd: 723378
          annual_fuel_cost_usd: 1793684
          annual_maintenance_cost_usd: 241488
          net_annual_savings_usd: 620110
          simple_payback_years: 2.93
          discounted_payback_years: 3.48
          net_present_value_usd: 4287000
          internal_rate_of_return: 0.32
          levelized_cost_of_electricity_usd_per_kwh: 0.0287
          savings_to_investment_ratio: 3.36
          first_year_cash_flow_usd: 620110

    - tool_id: "tool_6"
      name: "assess_grid_interconnection_requirements"
      description: "Determine utility interconnection requirements and standby rate impacts"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          chp_capacity_kw:
            type: "number"
            units: "kW"
            required: true

          utility_service_territory:
            type: "string"
            description: "Utility company name"
            required: true

          interconnection_voltage:
            type: "string"
            enum: ["low_voltage_480v", "medium_voltage_4160v", "medium_voltage_13200v", "transmission_69kv_plus"]
            required: true

          export_to_grid:
            type: "boolean"
            description: "Will CHP export to grid or island only"
            required: true

          parallel_operation_mode:
            type: "string"
            enum: ["continuous_parallel", "peak_shaving", "emergency_backup_only"]
            required: true

          existing_peak_demand_kw:
            type: "number"
            description: "Facility peak demand before CHP"
            units: "kW"
            required: true

          chp_reduces_peak_demand:
            type: "boolean"
            description: "Does CHP reduce utility peak demand"
            default: true

        required: ["chp_capacity_kw", "utility_service_territory", "interconnection_voltage", "export_to_grid", "parallel_operation_mode", "existing_peak_demand_kw"]

      returns:
        type: "object"
        properties:
          interconnection_study_required:
            type: "boolean"

          estimated_interconnection_cost_usd:
            type: "number"
            units: "USD"

          interconnection_timeline_months:
            type: "number"
            units: "months"

          standby_rate_applicable:
            type: "boolean"

          estimated_standby_charge_usd_per_month:
            type: "number"
            units: "USD/month"

          backup_supply_charge_usd_per_month:
            type: "number"
            units: "USD/month"

          maintenance_supply_charge_usd_per_month:
            type: "number"
            units: "USD/month"

          utility_tariff_changes_required:
            type: "boolean"

          recommended_interconnection_strategy:
            type: "string"

          key_requirements:
            type: "array"
            items:
              type: "string"

          potential_rate_challenges:
            type: "array"
            items:
              type: "string"

      implementation:
        calculation_method: "Utility tariff analysis and interconnection requirements lookup"
        data_source: "Utility tariff schedules, IEEE 1547 standards, state PUC regulations"
        accuracy: "Estimates based on typical utility practices"
        validation: "Requires confirmation with utility company"
        standards: ["IEEE_1547_Interconnection", "UL_1741_Inverters"]

      example:
        input:
          chp_capacity_kw: 2000
          utility_service_territory: "Pacific Gas & Electric"
          interconnection_voltage: "low_voltage_480v"
          export_to_grid: false
          parallel_operation_mode: "continuous_parallel"
          existing_peak_demand_kw: 3500
          chp_reduces_peak_demand: true
        output:
          interconnection_study_required: true
          estimated_interconnection_cost_usd: 75000
          interconnection_timeline_months: 6
          standby_rate_applicable: true
          estimated_standby_charge_usd_per_month: 6000
          backup_supply_charge_usd_per_month: 4000
          maintenance_supply_charge_usd_per_month: 2000
          utility_tariff_changes_required: true
          recommended_interconnection_strategy: "Negotiate standby rate waiver based on peak demand reduction and grid reliability benefits"
          key_requirements: ["IEEE 1547 compliant protective relaying", "Revenue-grade metering", "Utility-accessible disconnect", "SCADA monitoring connection"]
          potential_rate_challenges: ["Standby charges can eliminate CHP economics", "Exit fees if leaving full-requirements tariff", "Demand ratchet may persist"]

    - tool_id: "tool_7"
      name: "calculate_emissions_reduction"
      description: "Calculate CO2e emissions reduction from CHP vs separate heat and power"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          annual_chp_generation_kwh:
            type: "number"
            units: "kWh/year"
            required: true

          annual_thermal_generation_mmbtu:
            type: "number"
            units: "MMBtu/year"
            required: true

          chp_fuel_input_mmbtu:
            type: "number"
            units: "MMBtu/year"
            required: true

          chp_fuel_type:
            type: "string"
            enum: ["natural_gas", "biogas", "hydrogen", "diesel"]
            required: true

          displaced_grid_emissions_factor_kg_co2e_per_kwh:
            type: "number"
            description: "Grid electricity carbon intensity"
            units: "kg CO2e/kWh"
            required: true

          displaced_boiler_fuel_type:
            type: "string"
            required: true

          displaced_boiler_efficiency:
            type: "number"
            required: true

          renewable_natural_gas_percent:
            type: "number"
            description: "Percentage of RNG in fuel supply"
            minimum: 0
            maximum: 100
            default: 0

        required: ["annual_chp_generation_kwh", "annual_thermal_generation_mmbtu", "chp_fuel_input_mmbtu", "chp_fuel_type", "displaced_grid_emissions_factor_kg_co2e_per_kwh", "displaced_boiler_fuel_type", "displaced_boiler_efficiency"]

      returns:
        type: "object"
        properties:
          baseline_electricity_emissions_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          baseline_boiler_emissions_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          total_baseline_emissions_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          chp_system_emissions_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          annual_emissions_reduction_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          emissions_reduction_percent:
            type: "number"
            units: "%"

          equivalent_cars_removed:
            type: "number"

          emission_rate_kg_co2e_per_kwh:
            type: "number"
            units: "kg CO2e/kWh"
            description: "CHP emission rate vs grid"

      implementation:
        calculation_method: "Emissions = Fuel_Input × Emission_Factor for CHP; compare to separate heat/power baseline"
        data_source: "EPA eGRID, GHG Protocol, IPCC factors"
        accuracy: "±5%"
        validation: "EPA GHG reporting protocols"
        standards: ["GHG_Protocol", "ISO_14064", "EPA_eGRID"]

      example:
        input:
          annual_chp_generation_kwh: 16099200
          annual_thermal_generation_mmbtu: 74230
          chp_fuel_input_mmbtu: 150000
          chp_fuel_type: "natural_gas"
          displaced_grid_emissions_factor_kg_co2e_per_kwh: 0.42
          displaced_boiler_fuel_type: "natural_gas"
          displaced_boiler_efficiency: 0.82
          renewable_natural_gas_percent: 0
        output:
          baseline_electricity_emissions_kg_co2e: 6761664
          baseline_boiler_emissions_kg_co2e: 4837073
          total_baseline_emissions_kg_co2e: 11598737
          chp_system_emissions_kg_co2e: 8002500
          annual_emissions_reduction_kg_co2e: 3596237
          emissions_reduction_percent: 31.0
          equivalent_cars_removed: 779
          emission_rate_kg_co2e_per_kwh: 0.497

    - tool_id: "tool_8"
      name: "assess_resilience_value"
      description: "Quantify backup power and grid resilience value of CHP system"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          chp_capacity_kw:
            type: "number"
            units: "kW"
            required: true

          facility_critical_load_kw:
            type: "number"
            description: "Critical load requiring backup power"
            units: "kW"
            required: true

          islanding_capability:
            type: "boolean"
            description: "Can CHP operate disconnected from grid"
            required: true

          black_start_capability:
            type: "boolean"
            description: "Can CHP start without grid power"
            default: false

          historical_outage_frequency_per_year:
            type: "number"
            description: "Average grid outages per year"
            required: true

          average_outage_duration_hours:
            type: "number"
            units: "hours"
            required: true

          cost_of_downtime_usd_per_hour:
            type: "number"
            description: "Business interruption cost"
            units: "USD/hour"
            required: true

          alternative_backup_cost_usd:
            type: "number"
            description: "Cost of diesel generator alternative"
            units: "USD"
            default: 0

        required: ["chp_capacity_kw", "facility_critical_load_kw", "islanding_capability", "historical_outage_frequency_per_year", "average_outage_duration_hours", "cost_of_downtime_usd_per_hour"]

      returns:
        type: "object"
        properties:
          resilience_capability:
            type: "string"
            enum: ["full_resilience", "partial_resilience", "no_resilience"]

          percent_critical_load_served:
            type: "number"
            units: "%"

          annual_expected_downtime_hours_avoided:
            type: "number"
            units: "hours/year"

          annual_resilience_value_usd:
            type: "number"
            units: "USD/year"
            description: "Expected value of avoided outages"

          resilience_benefit_as_percent_of_chp_savings:
            type: "number"
            units: "%"

          avoided_backup_generator_capex:
            type: "number"
            units: "USD"

          total_resilience_value_npv:
            type: "number"
            units: "USD"
            description: "20-year NPV of resilience benefits"

          resilience_recommendations:
            type: "array"
            items:
              type: "string"

      implementation:
        calculation_method: "Expected value analysis: Value = Outage_Frequency × Duration × Cost_of_Downtime"
        accuracy: "±20% (depends on outage frequency estimates)"
        validation: "Historical outage data from utility"

      example:
        input:
          chp_capacity_kw: 2000
          facility_critical_load_kw: 1800
          islanding_capability: true
          black_start_capability: true
          historical_outage_frequency_per_year: 3
          average_outage_duration_hours: 4
          cost_of_downtime_usd_per_hour: 50000
          alternative_backup_cost_usd: 400000
        output:
          resilience_capability: "full_resilience"
          percent_critical_load_served: 100
          annual_expected_downtime_hours_avoided: 12
          annual_resilience_value_usd: 600000
          resilience_benefit_as_percent_of_chp_savings: 97
          avoided_backup_generator_capex: 400000
          total_resilience_value_npv: 5892000
          resilience_recommendations: ["CHP provides excellent resilience value", "Consider hardening fuel supply (on-site storage)", "Test islanding operation quarterly", "Consider UPS for control systems"]

ai_integration:
  temperature: 0.0
  seed: 42
  tool_choice: "auto"
  max_iterations: 6
  budget_usd: 0.18
  provenance_tracking: true
  ai_summary: true

  system_prompt: |
    You are a combined heat and power (CHP/cogeneration) expert specializing in
    industrial and commercial CHP systems for GreenLang. You help facilities evaluate,
    size, and optimize CHP investments through comprehensive technical and economic analysis.

    Your expertise includes:
    - CHP technology selection (reciprocating engines, gas turbines, microturbines, fuel cells)
    - Thermodynamic efficiency analysis and heat-to-power ratio matching
    - Load profile analysis and optimal system sizing
    - Spark spread economics and utility rate structure impacts
    - Grid interconnection requirements and standby rate negotiations
    - Federal/state incentives (IRA 2022 30% ITC, state rebates)
    - Emissions analysis and renewable fuel integration
    - Resilience and backup power value quantification

    CRITICAL RULES:
    - Use provided tools for ALL calculations
    - NEVER estimate or guess numbers
    - Always explain CHP thermodynamics clearly
    - Address utility rate impacts (standby charges are critical)
    - Consider resilience value (often 20-50% of total benefit)
    - Account for IRA 2022 30% ITC in financial analysis
    - Cite engineering standards (ASME PTC 50, IEEE 1547)
    - Provide conservative performance estimates

  user_prompt_template: |
    Analyze combined heat and power (CHP) opportunity for facility:

    Facility Profile:
    - Peak Electrical Demand: {peak_electrical_demand_kw} kW
    - Average Electrical Demand: {average_electrical_demand_kw} kW
    - Peak Thermal Demand: {peak_thermal_demand_mmbtu_hr} MMBtu/hr
    - Average Thermal Demand: {average_thermal_demand_mmbtu_hr} MMBtu/hr
    - Load Profile: {load_profile_type}
    - Operating Hours: {operating_hours_per_year} hours/year

    Energy Costs:
    - Electricity Rate: ${electricity_price_usd_per_kwh}/kWh
    - Demand Charge: ${electricity_demand_charge_usd_per_kw}/kW/month
    - Natural Gas: ${gas_price_usd_per_mmbtu}/MMBtu
    - Grid Emissions Factor: {grid_emissions_factor_kg_co2e_per_kwh} kg CO2e/kWh

    Site Constraints:
    - Space: {space_constraints}
    - Emissions Requirements: {emissions_requirements}
    - Grid Export Allowed: {grid_export_allowed}
    - Resilience Priority: {resilience_priority}

    Utility Information:
    - Utility: {utility_service_territory}
    - Standby Rate: {standby_rate_applicable}
    - Historical Outages: {outage_frequency_per_year}/year × {outage_duration_hours} hours
    - Downtime Cost: ${cost_of_downtime_usd_per_hour}/hour

    Tasks:
    1. Use select_chp_technology to recommend optimal CHP type
    2. Use size_chp_system to optimize capacity based on load profiles
    3. Use calculate_chp_performance for thermodynamic analysis
    4. Use calculate_spark_spread for energy arbitrage economics
    5. Use calculate_chp_economics for comprehensive financial analysis
    6. Use assess_grid_interconnection_requirements for utility impacts
    7. Use calculate_emissions_reduction for CO2e benefits
    8. Use assess_resilience_value for backup power value
    9. Provide comprehensive analysis with:
       - Technology recommendation with justification
       - Optimal system size (kW electrical, MMBtu/hr thermal)
       - Performance metrics (efficiency, capacity factor)
       - Financial analysis (payback, NPV, IRR including IRA 30% ITC)
       - Emissions reduction (tons CO2e/year)
       - Resilience value quantification
       - Utility interconnection strategy
       - Implementation roadmap

    IMPORTANT:
    - Use tools for ALL calculations
    - Address utility standby charges (can kill economics)
    - Quantify resilience value (often overlooked)
    - Include IRA 2022 30% ITC in financial analysis
    - Consider load profiles carefully for sizing
    - Format numbers with proper units
    - Provide actionable recommendations

sub_agents:
  sub_agent_count: 0
  note: "Coordinates with ProcessHeatAgent and WasteHeatRecoveryAgent"

inputs:
  input_schema:
    type: "object"
    properties:
      peak_electrical_demand_kw:
        type: "number"
        units: "kW"
        required: true

      average_electrical_demand_kw:
        type: "number"
        units: "kW"
        required: true

      peak_thermal_demand_mmbtu_hr:
        type: "number"
        units: "MMBtu/hr"
        required: true

      average_thermal_demand_mmbtu_hr:
        type: "number"
        units: "MMBtu/hr"
        required: true

      load_profile_type:
        type: "string"
        required: true

      electricity_price_usd_per_kwh:
        type: "number"
        units: "USD/kWh"
        required: true

      electricity_demand_charge_usd_per_kw:
        type: "number"
        units: "USD/kW/month"
        required: true

      gas_price_usd_per_mmbtu:
        type: "number"
        units: "USD/MMBtu"
        required: true

      grid_emissions_factor_kg_co2e_per_kwh:
        type: "number"
        units: "kg CO2e/kWh"
        required: true

      utility_service_territory:
        type: "string"
        required: true

      space_constraints:
        type: "string"
        required: true

      emissions_requirements:
        type: "string"
        required: true

      grid_export_allowed:
        type: "boolean"
        required: true

      resilience_priority:
        type: "string"
        required: true

    required: ["peak_electrical_demand_kw", "average_electrical_demand_kw", "peak_thermal_demand_mmbtu_hr", "average_thermal_demand_mmbtu_hr", "load_profile_type", "electricity_price_usd_per_kwh", "electricity_demand_charge_usd_per_kw", "gas_price_usd_per_mmbtu", "grid_emissions_factor_kg_co2e_per_kwh", "utility_service_territory", "space_constraints", "emissions_requirements", "grid_export_allowed", "resilience_priority"]

  example_input:
    peak_electrical_demand_kw: 3500
    average_electrical_demand_kw: 2200
    peak_thermal_demand_mmbtu_hr: 20.0
    average_thermal_demand_mmbtu_hr: 12.0
    load_profile_type: "baseload_24x7"
    electricity_price_usd_per_kwh: 0.12
    electricity_demand_charge_usd_per_kw: 15.0
    gas_price_usd_per_mmbtu: 8.0
    grid_emissions_factor_kg_co2e_per_kwh: 0.42
    utility_service_territory: "Pacific Gas & Electric"
    space_constraints: "moderate"
    emissions_requirements: "low_nox"
    grid_export_allowed: false
    resilience_priority: "high"

outputs:
  output_schema:
    type: "object"
    properties:
      recommended_chp_technology:
        type: "string"

      recommended_chp_size_kw:
        type: "number"
        units: "kW"

      electrical_efficiency:
        type: "number"

      total_chp_efficiency:
        type: "number"

      annual_chp_generation_kwh:
        type: "number"
        units: "kWh/year"

      capacity_factor:
        type: "number"

      total_project_cost_usd:
        type: "number"
        units: "USD"

      net_cost_after_incentives_usd:
        type: "number"
        units: "USD"

      net_annual_savings_usd:
        type: "number"
        units: "USD/year"

      simple_payback_years:
        type: "number"
        units: "years"

      npv_20yr_usd:
        type: "number"
        units: "USD"

      emissions_reduction_kg_co2e:
        type: "number"
        units: "kg CO2e/year"

      emissions_reduction_percent:
        type: "number"
        units: "%"

      resilience_value_usd_per_year:
        type: "number"
        units: "USD/year"

      interconnection_challenges:
        type: "array"

      ai_explanation:
        type: "string"

      provenance:
        type: "object"

  example_output:
    recommended_chp_technology: "reciprocating_engine"
    recommended_chp_size_kw: 2000
    electrical_efficiency: 0.38
    total_chp_efficiency: 0.83
    annual_chp_generation_kwh: 16099200
    capacity_factor: 0.92
    total_project_cost_usd: 3600000
    net_cost_after_incentives_usd: 1820000
    net_annual_savings_usd: 620110
    simple_payback_years: 2.93
    npv_20yr_usd: 4287000
    emissions_reduction_kg_co2e: 3596237
    emissions_reduction_percent: 31.0
    resilience_value_usd_per_year: 600000
    interconnection_challenges: ["Utility standby charges apply", "Interconnection study required", "Negotiate standby waiver"]
    ai_explanation: "2 MW reciprocating engine CHP recommended for baseload operation (92% capacity factor). Excellent economics: 2.9 year payback, $4.3M NPV including IRA 30% ITC. Reduces emissions 31% (3,596 tons CO2e/year). Strong resilience value ($600K/year) from backup power capability. Key risk: utility standby charges ($72K/year) - negotiate waiver based on peak demand reduction."
    provenance:
      model: "gpt-4o"
      tools_used: ["select_chp_technology", "size_chp_system", "calculate_chp_performance", "calculate_chp_economics", "assess_resilience_value"]
      cost_usd: 0.16
      deterministic: true

testing:
  test_coverage_target: 0.90

  test_categories:
    - category: "unit_tests"
      description: "Test individual tool implementations"
      count: 32

    - category: "integration_tests"
      description: "Test AI orchestration"
      count: 10

    - category: "determinism_tests"
      description: "Verify reproducibility"
      count: 3

    - category: "boundary_tests"
      description: "Test edge cases"
      count: 8

    - category: "thermodynamic_tests"
      description: "Validate efficiency calculations"
      count: 6

    - category: "financial_tests"
      description: "Validate economic analysis"
      count: 6

    - category: "performance_tests"
      description: "Verify latency and cost"
      count: 3

  performance_requirements:
    max_latency_ms: 4500
    max_cost_usd: 0.18
    accuracy_target: 0.95

deployment:
  pack_id: "industrial/chp_cogeneration_pack"
  pack_version: "1.0.0"

  dependencies:
    python_packages:
      - "pydantic>=2.0"
      - "numpy>=1.24"
      - "scipy>=1.11"
      - "pandas>=2.0"

    greenlang_modules:
      - "greenlang.agents.base"
      - "greenlang.intelligence"
      - "greenlang.agents.grid_factor_agent_ai"
      - "greenlang.agents.fuel_agent_ai"
      - "greenlang.agents.project_finance_agent_ai"

  resource_requirements:
    memory_mb: 768
    cpu_cores: 2
    gpu_required: false

  api_endpoints:
    - endpoint: "/api/v1/agents/industrial/chp/execute"
      method: "POST"
      authentication: "required"

    - endpoint: "/api/v1/agents/industrial/chp/spark_spread"
      method: "POST"
      authentication: "required"
      description: "Quick spark spread analysis"

documentation:
  readme: true
  api_docs: true
  examples: true
  tutorials: true

  example_use_cases:
    - title: "Manufacturing Facility CHP"
      description: "2 MW baseload CHP for 24/7 manufacturing"
      output_summary: "2.9 year payback, $4.3M NPV, 31% emissions reduction, $600K/year resilience value"

    - title: "Hospital CHP with Resilience"
      description: "1.5 MW CHP for critical healthcare facility"
      output_summary: "3.5 year payback, resilience value drives economics, full backup capability"

    - title: "University Campus CHP"
      description: "5 MW CHP with district heating integration"
      output_summary: "Gas turbine with HRSG, 70% thermal efficiency, excellent heat-to-power match"

compliance:
  zero_secrets: true
  sbom_required: true
  digital_signature: true

  standards:
    - "ASME_PTC_50_CHP_Performance"
    - "IEEE_1547_Interconnection"
    - "UL_1741_Inverters"
    - "ISO_2314_Gas_Turbines"
    - "EPA_CHP_Partnership"
    - "GHG_Protocol"
    - "ISO_14064"

  certifications:
    - "EPA_CHP_Partnership_Certified"
    - "ENERGY_STAR_CHP"
    - "ISO_50001_EnMS"

business_impact:
  market_opportunity:
    addressable_market_usd: 27000000000
    market_segment: "Industrial and commercial facilities with coincident heat and power loads"
    target_customers: "Manufacturing, hospitals, universities, hotels, food processing"

  carbon_impact:
    addressable_emissions_gt_co2e: 0.5
    realistic_reduction_2030_gt: 0.05
    note: "10% penetration × 0.5 Gt = 50 Mt CO2e/year reduction vs separate heat/power"

  economic_value:
    typical_capex_range_usd: "1.5M - 10M per installation"
    typical_payback_years: "2-5 years (excellent with IRA 30% ITC)"
    irr_range: "20-40%"
    note: "IRA 2022 30% ITC dramatically improves economics. Resilience value adds 20-50%."

metadata:
  created_date: "2025-10-13"
  created_by: "Head of AI & Climate Intelligence"
  last_modified: "2025-10-13"
  review_status: "Approved"
  reviewers: ["AI Lead", "CHP Systems Engineer"]

  change_log:
    - version: "1.0.0"
      date: "2025-10-13"
      changes: "Initial specification - production ready for Agent Factory generation"
      author: "Chief AI & Climate Intelligence"

# END OF AGENT #5 SPECIFICATION
# Production Ready for Agent Factory Generation
# Completes Week 6 goal: 5 Industrial Process agents
