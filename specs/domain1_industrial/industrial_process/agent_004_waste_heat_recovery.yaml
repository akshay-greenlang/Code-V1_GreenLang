# GreenLang Agent Specification v2.0
# Agent #4: WasteHeatRecoveryAgent_AI
# Specialized agent for industrial waste heat identification, recovery system design, and economic optimization

agent_metadata:
  agent_id: "industrial/waste_heat_recovery_agent"
  agent_name: "WasteHeatRecoveryAgent_AI"
  agent_number: 4
  version: "1.0.0"
  domain: "Domain1_Industrial"
  category: "Industrial_Process"
  complexity: "Medium"
  priority: "P1_High"
  base_agent: "None"
  status: "Spec_Complete"
  entry_point: false  # Specialized agent for waste heat recovery

description:
  purpose: |
    Specialized agent for identifying, quantifying, and recovering industrial waste
    heat streams. Provides detailed waste heat characterization (temperature, flow rate,
    composition), recovery technology selection (heat exchangers, economizers, ORC,
    heat pumps), integration analysis, and economic optimization. Critical for
    improving industrial energy efficiency and reducing thermal pollution.

  strategic_context:
    global_impact: "Industrial waste heat = 1.4 Gt CO2e/year potential reduction (20-50% of fuel input wasted)"
    opportunity: "50% of industrial fuel energy is rejected as waste heat"
    market_size: "$75B global waste heat recovery market"
    technology_maturity: "Proven technologies, recent advances in low-grade heat recovery (<200°F)"

  key_capabilities:
    - "Waste heat stream identification and characterization (temperature, flow, composition)"
    - "Heat recovery potential calculation using energy balance methods"
    - "Technology selection: recuperators, regenerators, economizers, heat pipes, ORC, heat pumps"
    - "Heat exchanger sizing using LMTD and effectiveness-NTU methods"
    - "Integration analysis: pinch analysis, heat exchanger network optimization"
    - "Fouling and corrosion risk assessment for high-temperature combustion gases"
    - "Economic analysis: CAPEX, energy savings, payback, lifecycle costs"
    - "Priority ranking of waste heat opportunities by economic attractiveness"

  dependencies:
    - agent_id: "industrial/process_heat_agent"
      relationship: "coordinates_with"
      data: "Process heat requirements for waste heat utilization"

    - agent_id: "industrial/heat_exchanger_network_agent"
      relationship: "coordinates_with"
      data: "Pinch analysis for optimal heat integration"

    - agent_id: "industrial/industrial_heat_pump_agent"
      relationship: "coordinates_with"
      data: "Heat pump integration for low-grade waste heat upgrading"

    - agent_id: "agents/fuel_agent_ai"
      relationship: "receives_data_from"
      data: "Fuel savings from waste heat recovery"

    - agent_id: "agents/project_finance_agent_ai"
      relationship: "provides_data_to"
      data: "CAPEX/OPEX and financial metrics"

tools:
  tool_count: 8

  tools_list:
    - tool_id: "tool_1"
      name: "identify_waste_heat_sources"
      description: "Identify and characterize all waste heat streams in industrial facility"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          facility_type:
            type: "string"
            description: "Type of industrial facility"
            enum: ["food_beverage", "chemical", "petroleum_refining", "metals", "pulp_paper", "cement", "glass", "pharmaceutical", "data_center"]
            required: true

          processes:
            type: "array"
            description: "List of processes in facility"
            items:
              type: "object"
              properties:
                process_name: "string"
                process_type: "string"
                operating_temperature_f: "number"
                fuel_type: "string"
                annual_fuel_consumption_mmbtu: "number"
            required: true

          include_hvac_systems:
            type: "boolean"
            description: "Include HVAC system waste heat"
            default: true

          include_compressed_air:
            type: "boolean"
            description: "Include compressed air system waste heat"
            default: true

          minimum_temperature_f:
            type: "number"
            description: "Minimum waste heat temperature to consider"
            units: "°F"
            default: 120
            note: "Below 120°F is difficult to recover economically"

        required: ["facility_type", "processes"]

      returns:
        type: "object"
        properties:
          waste_heat_sources:
            type: "array"
            items:
              type: "object"
              properties:
                source_id: "string"
                source_name: "string"
                source_type: "string"
                temperature_f: "number"
                flow_rate: "number"
                heat_content_mmbtu_hr: "number"
                annual_waste_heat_mmbtu: "number"
                stream_composition: "string"
                fouling_risk: "string"
                corrosion_risk: "string"
                accessibility: "string"

          total_waste_heat_mmbtu_yr:
            type: "number"
            units: "MMBtu/year"

          recoverable_waste_heat_mmbtu_yr:
            type: "number"
            units: "MMBtu/year"
            description: "Technically recoverable (accounting for minimum approach temperature)"

          economically_recoverable_mmbtu_yr:
            type: "number"
            units: "MMBtu/year"
            description: "Economically attractive opportunities"

          waste_heat_summary:
            type: "object"
            properties:
              high_grade_above_400f_mmbtu_yr: "number"
              medium_grade_200_400f_mmbtu_yr: "number"
              low_grade_below_200f_mmbtu_yr: "number"

      implementation:
        calculation_method: "Process-specific waste heat characterization database + energy balance"
        data_source: "DOE Industrial Assessment Centers database, industry benchmarks"
        accuracy: "±15% for waste heat quantification"
        validation: "Field measurements with combustion analyzer and flow meters"
        standards: ["DOE_Waste_Heat_Recovery_Guidelines", "ASHRAE_Industrial_Handbook"]

      example:
        input:
          facility_type: "food_beverage"
          processes: [
            {
              process_name: "Oven exhaust",
              process_type: "baking",
              operating_temperature_f: 450,
              fuel_type: "natural_gas",
              annual_fuel_consumption_mmbtu: 45000
            },
            {
              process_name: "Pasteurization",
              process_type: "hot_water",
              operating_temperature_f: 185,
              fuel_type: "natural_gas",
              annual_fuel_consumption_mmbtu: 28000
            }
          ]
          include_hvac_systems: true
          include_compressed_air: true
          minimum_temperature_f: 120
        output:
          waste_heat_sources: [
            {
              source_id: "WH001",
              source_name: "Oven exhaust stack",
              source_type: "combustion_flue_gas",
              temperature_f: 450,
              flow_rate: 12000,
              heat_content_mmbtu_hr: 2.85,
              annual_waste_heat_mmbtu: 21960,
              stream_composition: "Combustion gases (CO2, H2O, N2)",
              fouling_risk: "Low",
              corrosion_risk: "Low",
              accessibility: "Good"
            },
            {
              source_id: "WH002",
              source_name: "Pasteurization wastewater",
              source_type: "hot_liquid",
              temperature_f: 165,
              flow_rate: 800,
              heat_content_mmbtu_hr: 1.33,
              annual_waste_heat_mmbtu: 10247,
              stream_composition: "Clean water",
              fouling_risk: "Low",
              corrosion_risk: "Low",
              accessibility: "Excellent"
            }
          ]
          total_waste_heat_mmbtu_yr: 32207
          recoverable_waste_heat_mmbtu_yr: 25766
          economically_recoverable_mmbtu_yr: 22000
          waste_heat_summary:
            high_grade_above_400f_mmbtu_yr: 21960
            medium_grade_200_400f_mmbtu_yr: 0
            low_grade_below_200f_mmbtu_yr: 10247

    - tool_id: "tool_2"
      name: "calculate_heat_recovery_potential"
      description: "Calculate theoretical and practical heat recovery potential from waste stream"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          waste_stream_temperature_f:
            type: "number"
            description: "Waste stream temperature"
            units: "°F"
            required: true

          waste_stream_flow_rate:
            type: "number"
            description: "Mass or volumetric flow rate"
            required: true

          flow_rate_units:
            type: "string"
            enum: ["lb_hr", "kg_hr", "cfm", "acfm", "scfm", "gpm"]
            required: true

          stream_type:
            type: "string"
            description: "Type of waste stream"
            enum: ["combustion_flue_gas", "process_exhaust_air", "hot_liquid", "steam_condensate", "cooling_water"]
            required: true

          stream_composition:
            type: "string"
            description: "Stream composition for property lookup"
            required: true

          target_exit_temperature_f:
            type: "number"
            description: "Desired exit temperature after heat recovery"
            units: "°F"
            required: true

          minimum_approach_temperature_f:
            type: "number"
            description: "Minimum temperature difference for heat transfer"
            units: "°F"
            default: 20
            note: "Typical 10-30°F for cost-effective heat exchangers"

          heat_recovery_effectiveness:
            type: "number"
            description: "Heat exchanger effectiveness"
            minimum: 0.5
            maximum: 0.95
            default: 0.75

        required: ["waste_stream_temperature_f", "waste_stream_flow_rate", "flow_rate_units", "stream_type", "stream_composition", "target_exit_temperature_f"]

      returns:
        type: "object"
        properties:
          theoretical_heat_recovery_btu_hr:
            type: "number"
            units: "Btu/hr"
            description: "Maximum possible heat recovery"

          practical_heat_recovery_btu_hr:
            type: "number"
            units: "Btu/hr"
            description: "Achievable heat recovery (accounting for effectiveness)"

          annual_heat_recovery_mmbtu:
            type: "number"
            units: "MMBtu/year"

          temperature_drop_f:
            type: "number"
            units: "°F"

          specific_heat_btu_per_lb_f:
            type: "number"
            units: "Btu/lb·°F"

          density_lb_per_ft3:
            type: "number"
            units: "lb/ft³"

          mass_flow_rate_lb_hr:
            type: "number"
            units: "lb/hr"

      implementation:
        physics_formula: |
          For gas streams:
            m_dot = ρ × Q (mass flow = density × volumetric flow)
            Q_theoretical = m_dot × cp × (T_in - T_out)

          For liquid streams:
            Q_theoretical = m_dot × cp × (T_in - T_out)

          Practical heat recovery:
            Q_practical = Q_theoretical × Heat_Exchanger_Effectiveness

          Annual heat recovery:
            Q_annual = Q_practical × Operating_Hours_per_Year
        calculation_method: "Energy balance with heat exchanger effectiveness correction"
        data_source: "Thermodynamic property databases (NIST, Perry's Handbook)"
        accuracy: "±5% for heat recovery calculation"
        validation: "Compare with measured heat exchanger performance"
        standards: ["ASHRAE_Handbook_Fundamentals", "Perry_Chemical_Engineers_Handbook"]

      example:
        input:
          waste_stream_temperature_f: 450
          waste_stream_flow_rate: 12000
          flow_rate_units: "acfm"
          stream_type: "combustion_flue_gas"
          stream_composition: "Combustion products (natural gas)"
          target_exit_temperature_f: 250
          minimum_approach_temperature_f: 20
          heat_recovery_effectiveness: 0.75
        output:
          theoretical_heat_recovery_btu_hr: 3800000
          practical_heat_recovery_btu_hr: 2850000
          annual_heat_recovery_mmbtu: 21960
          temperature_drop_f: 200
          specific_heat_btu_per_lb_f: 0.26
          density_lb_per_ft3: 0.048
          mass_flow_rate_lb_hr: 34560

    - tool_id: "tool_3"
      name: "select_heat_recovery_technology"
      description: "Recommend optimal heat recovery technology based on waste stream characteristics"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          waste_stream_temperature_f:
            type: "number"
            units: "°F"
            required: true

          waste_stream_type:
            type: "string"
            enum: ["combustion_flue_gas", "process_exhaust_air", "hot_liquid", "steam", "cooling_water"]
            required: true

          heat_recovery_rate_mmbtu_hr:
            type: "number"
            units: "MMBtu/hr"
            required: true

          end_use_application:
            type: "string"
            description: "How will recovered heat be used"
            enum: ["preheat_combustion_air", "preheat_feedstock", "generate_hot_water", "generate_steam", "space_heating", "power_generation_orc", "upgrade_with_heat_pump"]
            required: true

          fouling_potential:
            type: "string"
            description: "Risk of heat exchanger fouling"
            enum: ["low", "moderate", "high", "very_high"]
            required: true

          corrosion_potential:
            type: "string"
            description: "Risk of corrosion"
            enum: ["low", "moderate", "high", "very_high"]
            required: true

          space_constraints:
            type: "string"
            enum: ["ample", "moderate", "limited", "very_limited"]
            required: true

          pressure_drop_limitation_in_h2o:
            type: "number"
            description: "Maximum allowable pressure drop"
            units: "in H2O"
            default: 4.0

        required: ["waste_stream_temperature_f", "waste_stream_type", "heat_recovery_rate_mmbtu_hr", "end_use_application", "fouling_potential", "corrosion_potential", "space_constraints"]

      returns:
        type: "object"
        properties:
          recommended_technology:
            type: "string"
            enum: ["shell_tube_hx", "plate_hx", "economizer", "recuperator", "regenerator", "heat_pipe", "run_around_coil", "orc_system", "heat_pump_assisted"]

          alternative_technology:
            type: "string"

          technology_description:
            type: "string"

          typical_effectiveness:
            type: "number"
            description: "Typical heat exchanger effectiveness"

          estimated_cost_per_mmbtu_hr:
            type: "number"
            units: "USD per MMBtu/hr capacity"

          maintenance_requirements:
            type: "string"
            enum: ["low", "moderate", "high"]

          key_advantages:
            type: "array"
            items:
              type: "string"

          key_challenges:
            type: "array"
            items:
              type: "string"

          material_recommendations:
            type: "array"
            items:
              type: "string"
            description: "Recommended materials for construction"

      implementation:
        calculation_method: "Decision matrix based on waste stream characteristics and application requirements"
        data_source: "Heat exchanger vendor data, DOE industrial best practices"
        accuracy: "Decision support quality"
        validation: "Expert review against installed systems"

      example:
        input:
          waste_stream_temperature_f: 450
          waste_stream_type: "combustion_flue_gas"
          heat_recovery_rate_mmbtu_hr: 2.85
          end_use_application: "preheat_combustion_air"
          fouling_potential: "moderate"
          corrosion_potential: "low"
          space_constraints: "moderate"
          pressure_drop_limitation_in_h2o: 3.0
        output:
          recommended_technology: "recuperator"
          alternative_technology: "heat_pipe"
          technology_description: "Air-to-air recuperator (plate type or rotary) for direct combustion air preheating"
          typical_effectiveness: 0.70
          estimated_cost_per_mmbtu_hr: 25000
          maintenance_requirements: "moderate"
          key_advantages: ["High effectiveness", "Compact design", "No cross-contamination", "Proven technology"]
          key_challenges: ["Requires periodic cleaning", "Moderate pressure drop", "Material selection critical for high temps"]
          material_recommendations: ["Stainless steel 304/316 for high temps", "Ceramic coating for corrosion resistance"]

    - tool_id: "tool_4"
      name: "size_heat_exchanger"
      description: "Size heat exchanger using LMTD or effectiveness-NTU methods"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          heat_duty_btu_hr:
            type: "number"
            description: "Required heat transfer rate"
            units: "Btu/hr"
            required: true

          hot_side_inlet_temp_f:
            type: "number"
            units: "°F"
            required: true

          hot_side_outlet_temp_f:
            type: "number"
            units: "°F"
            required: true

          cold_side_inlet_temp_f:
            type: "number"
            units: "°F"
            required: true

          cold_side_outlet_temp_f:
            type: "number"
            units: "°F"
            required: true

          heat_exchanger_type:
            type: "string"
            enum: ["shell_tube", "plate", "plate_fin", "double_pipe"]
            required: true

          overall_heat_transfer_coefficient:
            type: "number"
            description: "U-value for heat exchanger"
            units: "Btu/hr·ft²·°F"
            required: true
            note: "Typical values: 5-50 for gas-gas, 50-200 for gas-liquid, 100-500 for liquid-liquid"

          flow_arrangement:
            type: "string"
            enum: ["counterflow", "parallel_flow", "crossflow_unmixed", "shell_tube_1_pass"]
            default: "counterflow"

        required: ["heat_duty_btu_hr", "hot_side_inlet_temp_f", "hot_side_outlet_temp_f", "cold_side_inlet_temp_f", "cold_side_outlet_temp_f", "heat_exchanger_type", "overall_heat_transfer_coefficient"]

      returns:
        type: "object"
        properties:
          required_heat_transfer_area_ft2:
            type: "number"
            units: "ft²"

          lmtd_f:
            type: "number"
            units: "°F"
            description: "Log Mean Temperature Difference"

          lmtd_correction_factor:
            type: "number"
            description: "F-factor for flow arrangement"

          effectiveness:
            type: "number"
            description: "Heat exchanger effectiveness"

          ntu:
            type: "number"
            description: "Number of Transfer Units"

          estimated_dimensions:
            type: "object"
            properties:
              length_ft: "number"
              width_ft: "number"
              height_ft: "number"

          estimated_weight_lb:
            type: "number"
            units: "lb"

          estimated_cost_usd:
            type: "number"
            units: "USD"

      implementation:
        physics_formula: |
          LMTD Method:
            LMTD = (ΔT1 - ΔT2) / ln(ΔT1 / ΔT2)
            where ΔT1 = T_hot_in - T_cold_out (counterflow)
                  ΔT2 = T_hot_out - T_cold_in

            Q = U × A × F × LMTD
            A = Q / (U × F × LMTD)

          Effectiveness-NTU Method:
            ε = Q_actual / Q_max
            NTU = U × A / C_min
            (Use NTU-effectiveness charts for specific flow arrangement)
        calculation_method: "LMTD method with correction factor for flow arrangement"
        data_source: "Heat exchanger design correlations (Incropera & DeWitt, TEMA)"
        accuracy: "±10% for area estimation"
        validation: "Compare with vendor sizing tools"
        standards: ["ASME_BPVC_Section_VIII", "TEMA_Standards", "ASHRAE_HVAC_Systems"]

      example:
        input:
          heat_duty_btu_hr: 2850000
          hot_side_inlet_temp_f: 450
          hot_side_outlet_temp_f: 250
          cold_side_inlet_temp_f: 70
          cold_side_outlet_temp_f: 350
          heat_exchanger_type: "plate"
          overall_heat_transfer_coefficient: 25
          flow_arrangement: "counterflow"
        output:
          required_heat_transfer_area_ft2: 950
          lmtd_f: 120
          lmtd_correction_factor: 1.0
          effectiveness: 0.74
          ntu: 2.8
          estimated_dimensions:
            length_ft: 8
            width_ft: 4
            height_ft: 6
          estimated_weight_lb: 2400
          estimated_cost_usd: 71250

    - tool_id: "tool_5"
      name: "calculate_energy_savings"
      description: "Calculate annual energy and cost savings from waste heat recovery"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          annual_heat_recovery_mmbtu:
            type: "number"
            description: "Annual recovered heat"
            units: "MMBtu/year"
            required: true

          displaced_fuel_type:
            type: "string"
            description: "Fuel that will be displaced"
            enum: ["natural_gas", "fuel_oil", "propane", "coal", "electricity", "steam"]
            required: true

          displaced_system_efficiency:
            type: "number"
            description: "Efficiency of system being displaced"
            minimum: 0.5
            maximum: 1.0
            required: true

          fuel_cost_usd_per_mmbtu:
            type: "number"
            description: "Current fuel cost"
            units: "USD/MMBtu"
            required: true

          heat_recovery_system_efficiency:
            type: "number"
            description: "Heat recovery system efficiency"
            minimum: 0.6
            maximum: 0.95
            default: 0.80

          operating_hours_per_year:
            type: "number"
            default: 8760

          fuel_cost_escalation_rate:
            type: "number"
            description: "Annual fuel cost increase"
            default: 0.03

        required: ["annual_heat_recovery_mmbtu", "displaced_fuel_type", "displaced_system_efficiency", "fuel_cost_usd_per_mmbtu"]

      returns:
        type: "object"
        properties:
          effective_heat_recovered_mmbtu:
            type: "number"
            units: "MMBtu/year"
            description: "Net heat recovered (accounting for heat recovery system efficiency)"

          fuel_savings_mmbtu:
            type: "number"
            units: "MMBtu/year"
            description: "Fuel displaced (accounting for existing system efficiency)"

          annual_cost_savings_usd:
            type: "number"
            units: "USD/year"

          annual_emissions_reduction_kg_co2e:
            type: "number"
            units: "kg CO2e/year"

          npv_savings_20yr_usd:
            type: "number"
            units: "USD"
            description: "Net present value of savings over 20 years"

      implementation:
        calculation_method: "Fuel_Savings = Heat_Recovered × HR_Efficiency / Displaced_System_Efficiency"
        accuracy: "±5% for savings calculations"
        validation: "Compare with utility meter data before/after"
        standards: ["FEMP_Energy_Savings_Measurement"]

      example:
        input:
          annual_heat_recovery_mmbtu: 21960
          displaced_fuel_type: "natural_gas"
          displaced_system_efficiency: 0.82
          fuel_cost_usd_per_mmbtu: 8.0
          heat_recovery_system_efficiency: 0.80
          operating_hours_per_year: 7700
          fuel_cost_escalation_rate: 0.03
        output:
          effective_heat_recovered_mmbtu: 17568
          fuel_savings_mmbtu: 21424
          annual_cost_savings_usd: 171392
          annual_emissions_reduction_kg_co2e: 1142000
          npv_savings_20yr_usd: 2565000

    - tool_id: "tool_6"
      name: "assess_fouling_corrosion_risk"
      description: "Assess fouling and corrosion risks for heat recovery equipment"
      category: "analysis"
      deterministic: true

      parameters:
        type: "object"
        properties:
          waste_stream_type:
            type: "string"
            required: true

          stream_temperature_f:
            type: "number"
            units: "°F"
            required: true

          particulate_loading_gr_per_scf:
            type: "number"
            description: "Particulate concentration"
            units: "gr/scf"
            default: 0

          acid_dew_point_f:
            type: "number"
            description: "Acid condensation temperature"
            units: "°F"

          sulfur_content_ppm:
            type: "number"
            description: "Sulfur content in fuel/stream"
            units: "ppm"
            default: 0

          chlorine_content_ppm:
            type: "number"
            units: "ppm"
            default: 0

          moisture_content_percent:
            type: "number"
            units: "%"
            default: 0

          operating_hours_per_year:
            type: "number"
            default: 8760

        required: ["waste_stream_type", "stream_temperature_f"]

      returns:
        type: "object"
        properties:
          fouling_risk_level:
            type: "string"
            enum: ["low", "moderate", "high", "very_high"]

          corrosion_risk_level:
            type: "string"
            enum: ["low", "moderate", "high", "very_high"]

          recommended_minimum_wall_temperature_f:
            type: "number"
            units: "°F"
            description: "To avoid acid condensation"

          fouling_resistance_hr_ft2_f_per_btu:
            type: "number"
            description: "Fouling factor to add to heat transfer calculation"

          recommended_cleaning_frequency_months:
            type: "number"
            units: "months"

          material_recommendations:
            type: "array"
            items:
              type: "string"

          mitigation_strategies:
            type: "array"
            items:
              type: "string"

      implementation:
        calculation_method: "Risk assessment based on stream properties and operating conditions"
        data_source: "NACE corrosion handbook, ASME fouling correlations"
        accuracy: "Qualitative risk assessment"
        validation: "Field experience database"
        standards: ["NACE_Corrosion_Guidelines", "TEMA_Fouling_Factors"]

      example:
        input:
          waste_stream_type: "combustion_flue_gas"
          stream_temperature_f: 450
          particulate_loading_gr_per_scf: 0.01
          acid_dew_point_f: 280
          sulfur_content_ppm: 50
          chlorine_content_ppm: 0
          moisture_content_percent: 12
          operating_hours_per_year: 7700
        output:
          fouling_risk_level: "moderate"
          corrosion_risk_level: "moderate"
          recommended_minimum_wall_temperature_f: 295
          fouling_resistance_hr_ft2_f_per_btu: 0.002
          recommended_cleaning_frequency_months: 12
          material_recommendations: ["Stainless steel 316L", "Ceramic coating", "Enamel coating"]
          mitigation_strategies: ["Maintain wall temp above acid dew point", "Install soot blowers", "Annual inspection and cleaning", "Consider fuel switching to lower sulfur"]

    - tool_id: "tool_7"
      name: "calculate_payback_period"
      description: "Calculate financial payback for waste heat recovery investment"
      category: "calculation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          heat_exchanger_cost_usd:
            type: "number"
            description: "Heat exchanger equipment cost"
            units: "USD"
            required: true

          installation_labor_cost_usd:
            type: "number"
            units: "USD"
            required: true

          piping_modifications_cost_usd:
            type: "number"
            units: "USD"
            default: 0

          controls_instrumentation_cost_usd:
            type: "number"
            units: "USD"
            default: 0

          contingency_percent:
            type: "number"
            description: "Project contingency"
            default: 15

          annual_energy_savings_usd:
            type: "number"
            units: "USD/year"
            required: true

          annual_maintenance_cost_usd:
            type: "number"
            units: "USD/year"
            default: 0

          federal_tax_credit_percent:
            type: "number"
            description: "Federal energy efficiency tax credit"
            minimum: 0
            maximum: 30
            default: 0

          utility_rebate_usd:
            type: "number"
            units: "USD"
            default: 0

          discount_rate:
            type: "number"
            default: 0.08

          analysis_period_years:
            type: "number"
            default: 15

        required: ["heat_exchanger_cost_usd", "installation_labor_cost_usd", "annual_energy_savings_usd"]

      returns:
        type: "object"
        properties:
          total_project_cost_usd:
            type: "number"
            units: "USD"

          net_cost_after_incentives_usd:
            type: "number"
            units: "USD"

          net_annual_savings_usd:
            type: "number"
            units: "USD/year"

          simple_payback_years:
            type: "number"
            units: "years"

          discounted_payback_years:
            type: "number"
            units: "years"

          net_present_value_usd:
            type: "number"
            units: "USD"

          internal_rate_of_return:
            type: "number"

          savings_to_investment_ratio:
            type: "number"

      implementation:
        calculation_method: "Standard financial analysis (NPV, IRR, SIR)"
        accuracy: "±5% for financial calculations"
        validation: "Project finance models"
        standards: ["NIST_Handbook_135_LCC", "FEMP_Energy_Analysis"]

      example:
        input:
          heat_exchanger_cost_usd: 71250
          installation_labor_cost_usd: 35000
          piping_modifications_cost_usd: 15000
          controls_instrumentation_cost_usd: 8000
          contingency_percent: 15
          annual_energy_savings_usd: 171392
          annual_maintenance_cost_usd: 3500
          federal_tax_credit_percent: 0
          utility_rebate_usd: 20000
          discount_rate: 0.08
          analysis_period_years: 15
        output:
          total_project_cost_usd: 148838
          net_cost_after_incentives_usd: 128838
          net_annual_savings_usd: 167892
          simple_payback_years: 0.77
          discounted_payback_years: 0.82
          net_present_value_usd: 1307000
          internal_rate_of_return: 1.28
          savings_to_investment_ratio: 11.1

    - tool_id: "tool_8"
      name: "prioritize_waste_heat_opportunities"
      description: "Rank waste heat recovery opportunities by economic attractiveness"
      category: "aggregation"
      deterministic: true

      parameters:
        type: "object"
        properties:
          opportunities:
            type: "array"
            description: "List of waste heat recovery opportunities"
            items:
              type: "object"
              properties:
                opportunity_id: "string"
                opportunity_name: "string"
                annual_heat_recovery_mmbtu: "number"
                annual_savings_usd: "number"
                capex_usd: "number"
                simple_payback_years: "number"
                technical_risk: "string"
                implementation_complexity: "string"
            required: true

          prioritization_criteria:
            type: "object"
            properties:
              payback_weight: "number"
              savings_weight: "number"
              risk_weight: "number"
              complexity_weight: "number"
            default:
              payback_weight: 0.4
              savings_weight: 0.3
              risk_weight: 0.2
              complexity_weight: 0.1

        required: ["opportunities"]

      returns:
        type: "object"
        properties:
          prioritized_opportunities:
            type: "array"
            items:
              type: "object"
              properties:
                rank: "number"
                opportunity_id: "string"
                opportunity_name: "string"
                priority_score: "number"
                simple_payback_years: "number"
                annual_savings_usd: "number"
                capex_usd: "number"
                recommendation: "string"

          implementation_roadmap:
            type: "array"
            items:
              type: "object"
              properties:
                phase: "string"
                opportunities: "array"
                total_capex_usd: "number"
                total_annual_savings_usd: "number"

      implementation:
        calculation_method: "Multi-criteria weighted scoring for prioritization"
        accuracy: "Decision support quality"
        validation: "Expert review"

      example:
        input:
          opportunities: [
            {
              opportunity_id: "WH001",
              opportunity_name: "Oven exhaust recuperator",
              annual_heat_recovery_mmbtu: 21960,
              annual_savings_usd: 171392,
              capex_usd: 148838,
              simple_payback_years: 0.87,
              technical_risk: "Low",
              implementation_complexity: "Moderate"
            },
            {
              opportunity_id: "WH002",
              opportunity_name: "Wastewater heat recovery",
              annual_heat_recovery_mmbtu: 10247,
              annual_savings_usd: 79983,
              capex_usd: 95000,
              simple_payback_years: 1.19,
              technical_risk: "Low",
              implementation_complexity: "Simple"
            }
          ]
        output:
          prioritized_opportunities: [
            {
              rank: 1,
              opportunity_id: "WH001",
              opportunity_name: "Oven exhaust recuperator",
              priority_score: 9.2,
              simple_payback_years: 0.87,
              annual_savings_usd: 171392,
              capex_usd: 148838,
              recommendation: "High priority - excellent payback, large savings, proven technology"
            },
            {
              rank: 2,
              opportunity_id: "WH002",
              opportunity_name: "Wastewater heat recovery",
              priority_score: 8.8,
              simple_payback_years: 1.19,
              annual_savings_usd: 79983,
              capex_usd: 95000,
              recommendation: "High priority - very simple implementation, low risk"
            }
          ]
          implementation_roadmap: [
            {
              phase: "Phase 1 (Year 1)",
              opportunities: ["WH001", "WH002"],
              total_capex_usd: 243838,
              total_annual_savings_usd: 251375
            }
          ]

ai_integration:
  temperature: 0.0
  seed: 42
  tool_choice: "auto"
  max_iterations: 6
  budget_usd: 0.15
  provenance_tracking: true
  ai_summary: true

  system_prompt: |
    You are an industrial waste heat recovery expert specializing in energy
    efficiency and heat integration for GreenLang. You help industrial facilities
    identify, quantify, and capture waste heat through rigorous engineering analysis.

    Your expertise includes:
    - Waste heat stream characterization (temperature, flow, composition)
    - Heat recovery technology selection (recuperators, economizers, heat pipes, ORC)
    - Heat exchanger sizing using LMTD and effectiveness-NTU methods
    - Fouling and corrosion risk assessment
    - Pinch analysis and process integration
    - Economic analysis with payback and lifecycle costs
    - Priority ranking of opportunities

    CRITICAL RULES:
    - Use provided tools for ALL calculations
    - NEVER estimate or guess numbers
    - Always explain heat transfer principles clearly
    - Cite engineering standards (ASME, ASHRAE, TEMA)
    - Address fouling and corrosion risks
    - Provide conservative recovery estimates
    - Consider practical implementation challenges

  user_prompt_template: |
    Analyze waste heat recovery opportunities for industrial facility:

    Facility Profile:
    - Industry: {facility_type}
    - Processes: {processes}
    - Annual Fuel Consumption: {total_annual_fuel_mmbtu} MMBtu/year
    - Current Fuel Cost: ${fuel_cost_usd_per_mmbtu}/MMBtu

    Waste Heat Sources to Evaluate:
    {waste_heat_sources_description}

    Recovery Goals:
    - Target Payback: {target_payback_years} years
    - Priority: {priority_criteria}

    Tasks:
    1. Use identify_waste_heat_sources to catalog all waste heat streams
    2. Use calculate_heat_recovery_potential for each significant source
    3. Use select_heat_recovery_technology for optimal technology
    4. Use size_heat_exchanger for equipment sizing
    5. Use assess_fouling_corrosion_risk for maintenance planning
    6. Use calculate_energy_savings for financial analysis
    7. Use calculate_payback_period for each opportunity
    8. Use prioritize_waste_heat_opportunities for implementation roadmap
    9. Provide comprehensive analysis with:
       - Waste heat inventory (temperature, quantity, quality)
       - Recovery opportunities ranked by payback
       - Technology recommendations for each source
       - Heat exchanger sizing and cost estimates
       - Financial analysis (payback, NPV, IRR)
       - Implementation roadmap (Phase 1/2/3)
       - Risk mitigation (fouling, corrosion, operability)

    IMPORTANT:
    - Use tools for ALL calculations
    - Consider practical constraints (space, pressure drop, access)
    - Address fouling/corrosion risks
    - Format numbers with proper units
    - Provide actionable priorities

sub_agents:
  sub_agent_count: 0
  note: "Coordinates with HeatExchangerNetworkAgent for pinch analysis integration"

inputs:
  input_schema:
    type: "object"
    properties:
      facility_type:
        type: "string"
        required: true

      processes:
        type: "array"
        required: true

      total_annual_fuel_mmbtu:
        type: "number"
        units: "MMBtu/year"
        required: true

      fuel_cost_usd_per_mmbtu:
        type: "number"
        units: "USD/MMBtu"
        required: true

      target_payback_years:
        type: "number"
        default: 3.0

      minimum_temperature_f:
        type: "number"
        default: 120

    required: ["facility_type", "processes", "total_annual_fuel_mmbtu", "fuel_cost_usd_per_mmbtu"]

  example_input:
    facility_type: "food_beverage"
    processes: [
      {
        process_name: "Oven exhaust",
        process_type: "baking",
        operating_temperature_f: 450,
        fuel_type: "natural_gas",
        annual_fuel_consumption_mmbtu: 45000
      }
    ]
    total_annual_fuel_mmbtu: 73000
    fuel_cost_usd_per_mmbtu: 8.0
    target_payback_years: 2.0
    minimum_temperature_f: 120

outputs:
  output_schema:
    type: "object"
    properties:
      total_waste_heat_identified_mmbtu_yr:
        type: "number"
        units: "MMBtu/year"

      recoverable_waste_heat_mmbtu_yr:
        type: "number"
        units: "MMBtu/year"

      prioritized_opportunities:
        type: "array"

      total_potential_savings_usd_yr:
        type: "number"
        units: "USD/year"

      total_capex_required_usd:
        type: "number"
        units: "USD"

      weighted_average_payback_years:
        type: "number"
        units: "years"

      implementation_roadmap:
        type: "array"

      ai_explanation:
        type: "string"

      provenance:
        type: "object"

  example_output:
    total_waste_heat_identified_mmbtu_yr: 32207
    recoverable_waste_heat_mmbtu_yr: 25766
    prioritized_opportunities: [
      {
        rank: 1,
        opportunity_name: "Oven exhaust recuperator",
        annual_savings_usd: 171392,
        capex_usd: 148838,
        simple_payback_years: 0.87
      }
    ]
    total_potential_savings_usd_yr: 251375
    total_capex_required_usd: 243838
    weighted_average_payback_years: 0.97
    implementation_roadmap: [
      {phase: "Phase 1 (Year 1)", opportunities: ["WH001", "WH002"]}
    ]
    ai_explanation: "Identified 32,207 MMBtu/year waste heat with 25,766 MMBtu/year recoverable. Two high-priority opportunities with <1 year payback and $251K annual savings. Recommend Phase 1 implementation of both projects."
    provenance:
      model: "gpt-4o"
      tools_used: ["identify_waste_heat_sources", "calculate_heat_recovery_potential", "select_heat_recovery_technology", "prioritize_waste_heat_opportunities"]
      cost_usd: 0.13
      deterministic: true

testing:
  test_coverage_target: 0.85

  test_categories:
    - category: "unit_tests"
      description: "Test individual tool implementations"
      count: 26

    - category: "integration_tests"
      description: "Test AI orchestration"
      count: 7

    - category: "determinism_tests"
      description: "Verify reproducibility"
      count: 3

    - category: "boundary_tests"
      description: "Test edge cases"
      count: 6

    - category: "heat_transfer_tests"
      description: "Validate LMTD and effectiveness calculations"
      count: 5

    - category: "performance_tests"
      description: "Verify latency and cost"
      count: 3

  performance_requirements:
    max_latency_ms: 4000
    max_cost_usd: 0.15
    accuracy_target: 0.90

deployment:
  pack_id: "industrial/waste_heat_recovery_pack"
  pack_version: "1.0.0"

  dependencies:
    python_packages:
      - "pydantic>=2.0"
      - "numpy>=1.24"
      - "scipy>=1.11"
      - "pandas>=2.0"

    greenlang_modules:
      - "greenlang.agents.base"
      - "greenlang.intelligence"
      - "greenlang.agents.fuel_agent_ai"
      - "greenlang.agents.project_finance_agent_ai"

  resource_requirements:
    memory_mb: 512
    cpu_cores: 1
    gpu_required: false

  api_endpoints:
    - endpoint: "/api/v1/agents/industrial/waste_heat_recovery/execute"
      method: "POST"
      authentication: "required"

documentation:
  readme: true
  api_docs: true
  examples: true
  tutorials: true

  example_use_cases:
    - title: "Food Processing Plant Waste Heat Audit"
      description: "Comprehensive waste heat assessment"
      output_summary: "32,207 MMBtu/year identified, $251K annual savings potential, 0.97 year payback"

    - title: "Steel Mill Furnace Exhaust Recovery"
      description: "High-temperature recuperator for furnace"
      output_summary: "Recuperator technology, 850°F waste gas, 65% effectiveness"

    - title: "Chemical Plant Multi-Stream Recovery"
      description: "Pinch analysis with heat exchanger network"
      output_summary: "5 waste heat sources, integrated recovery network, $1.2M savings"

compliance:
  zero_secrets: true
  sbom_required: true
  digital_signature: true

  standards:
    - "ASME_BPVC_Section_VIII_Pressure_Vessels"
    - "TEMA_Heat_Exchanger_Standards"
    - "ASHRAE_Industrial_Handbook"
    - "NACE_Corrosion_Guidelines"
    - "DOE_Waste_Heat_Recovery_Guidelines"
    - "GHG_Protocol"
    - "ISO_14064"

  certifications:
    - "ENERGY_STAR_Industrial"
    - "ISO_50001_EnMS"

business_impact:
  market_opportunity:
    addressable_market_usd: 75000000000
    market_segment: "Industrial waste heat recovery (20-50% of fuel input wasted)"
    target_customers: "All energy-intensive industries"

  carbon_impact:
    addressable_emissions_gt_co2e: 1.4
    realistic_reduction_2030_gt: 0.14
    note: "10% penetration × 1.4 Gt = 140 Mt CO2e/year reduction"

  economic_value:
    typical_capex_range_usd: "50K - 500K per project"
    typical_payback_years: "0.5-3 years (excellent economics)"
    irr_range: "30-100%+"
    note: "Waste heat recovery typically has fastest payback of all efficiency measures"

metadata:
  created_date: "2025-10-13"
  created_by: "Head of AI & Climate Intelligence"
  last_modified: "2025-10-13"
  review_status: "Approved"
  reviewers: ["AI Lead", "Heat Transfer Engineer"]

  change_log:
    - version: "1.0.0"
      date: "2025-10-13"
      changes: "Initial specification - production ready for Agent Factory generation"
      author: "Chief AI & Climate Intelligence"

# END OF AGENT #4 SPECIFICATION
# Production Ready for Agent Factory Generation
# Next: Agent #5 - CogenerationCHPAgent_AI
