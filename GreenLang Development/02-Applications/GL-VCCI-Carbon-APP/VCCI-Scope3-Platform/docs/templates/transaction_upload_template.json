{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "GL-VCCI Scope 3 Transaction Upload Schema",
  "description": "JSON schema for uploading Scope 3 carbon accounting transactions to the GL-VCCI Carbon Intelligence Platform",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Upload metadata and configuration",
      "properties": {
        "upload_id": {
          "type": "string",
          "description": "Unique identifier for this upload batch",
          "pattern": "^UPL-[0-9]{4}-[0-9]{8}-[0-9]{4}$",
          "example": "UPL-2024-10152024-0001"
        },
        "upload_date": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of upload",
          "example": "2024-10-15T14:30:00Z"
        },
        "organization_id": {
          "type": "string",
          "description": "Organization identifier",
          "example": "ORG-1001"
        },
        "reporting_period": {
          "type": "string",
          "description": "Reporting period for these transactions",
          "pattern": "^[0-9]{4}-(Q[1-4]|[0-9]{2})$",
          "example": "2024-Q3"
        },
        "data_source": {
          "type": "string",
          "description": "Source system or file name",
          "example": "SAP_ERP_Extract_Sept2024.xlsx"
        },
        "uploaded_by": {
          "type": "string",
          "description": "User who initiated the upload",
          "example": "john.smith@company.com"
        }
      },
      "required": ["upload_id", "upload_date", "organization_id"]
    },
    "transactions": {
      "type": "array",
      "description": "Array of transaction records",
      "minItems": 1,
      "maxItems": 10000,
      "items": {
        "type": "object",
        "properties": {
          "transaction_id": {
            "type": "string",
            "description": "Unique identifier for the transaction",
            "minLength": 1,
            "maxLength": 50,
            "example": "TXN-2024-MFG-00001"
          },
          "date": {
            "type": "string",
            "format": "date",
            "description": "Transaction date in YYYY-MM-DD format",
            "example": "2024-08-15"
          },
          "supplier_name": {
            "type": "string",
            "description": "Full legal name of the supplier",
            "minLength": 1,
            "maxLength": 200,
            "example": "Precision Steel Manufacturing Co."
          },
          "supplier_id": {
            "type": "string",
            "description": "Unique supplier identifier",
            "minLength": 1,
            "maxLength": 50,
            "example": "SUP-1001"
          },
          "product_name": {
            "type": "string",
            "description": "Name or description of product/service",
            "minLength": 1,
            "maxLength": 500,
            "example": "Cold-rolled steel sheets - Grade 304"
          },
          "product_category": {
            "type": "string",
            "description": "UNSPSC code or category identifier",
            "pattern": "^[0-9.]+$",
            "example": "3310.15.10.00"
          },
          "quantity": {
            "type": "number",
            "description": "Numeric quantity purchased",
            "minimum": 0,
            "exclusiveMinimum": true,
            "example": 5000
          },
          "unit": {
            "type": "string",
            "description": "Unit of measurement",
            "enum": ["kg", "tonnes", "liters", "m3", "kWh", "pieces", "units", "hours", "compute-hours", "containers", "trips"],
            "example": "kg"
          },
          "spend_usd": {
            "type": "number",
            "description": "Total spend in USD (2 decimal places)",
            "minimum": 0,
            "exclusiveMinimum": true,
            "multipleOf": 0.01,
            "example": 12500.00
          },
          "currency": {
            "type": "string",
            "description": "ISO 4217 currency code",
            "pattern": "^[A-Z]{3}$",
            "example": "USD"
          },
          "ghg_category": {
            "type": "integer",
            "description": "Scope 3 GHG Protocol category (1-15)",
            "minimum": 1,
            "maximum": 15,
            "example": 1
          },
          "country": {
            "type": "string",
            "description": "ISO 3166-1 alpha-2 country code",
            "pattern": "^[A-Z]{2}$",
            "example": "US"
          },
          "description": {
            "type": "string",
            "description": "Additional context or notes (optional)",
            "maxLength": 1000,
            "example": "High-grade stainless steel for automotive parts manufacturing"
          },
          "custom_fields": {
            "type": "object",
            "description": "Organization-specific custom fields",
            "additionalProperties": true,
            "example": {
              "cost_center": "CC-1234",
              "project_code": "PRJ-AUTO-2024",
              "approval_status": "approved"
            }
          }
        },
        "required": [
          "transaction_id",
          "date",
          "supplier_name",
          "supplier_id",
          "product_name",
          "product_category",
          "quantity",
          "unit",
          "spend_usd",
          "currency",
          "ghg_category",
          "country"
        ],
        "additionalProperties": false
      }
    },
    "validation_config": {
      "type": "object",
      "description": "Optional validation configuration",
      "properties": {
        "skip_duplicates": {
          "type": "boolean",
          "description": "Skip duplicate transaction_id values",
          "default": false
        },
        "validate_supplier_exists": {
          "type": "boolean",
          "description": "Validate supplier_id against supplier master",
          "default": true
        },
        "auto_categorize": {
          "type": "boolean",
          "description": "Automatically categorize based on product_name",
          "default": false
        },
        "strict_mode": {
          "type": "boolean",
          "description": "Enable strict validation (reject on any warning)",
          "default": false
        }
      }
    }
  },
  "required": ["metadata", "transactions"],
  "examples": [
    {
      "metadata": {
        "upload_id": "UPL-2024-10152024-0001",
        "upload_date": "2024-10-15T14:30:00Z",
        "organization_id": "ORG-1001",
        "reporting_period": "2024-Q3",
        "data_source": "Manual_Upload_Oct2024.json",
        "uploaded_by": "sustainability.team@company.com"
      },
      "transactions": [
        {
          "transaction_id": "TXN-2024-MFG-00001",
          "date": "2024-08-15",
          "supplier_name": "Precision Steel Manufacturing Co.",
          "supplier_id": "SUP-1001",
          "product_name": "Cold-rolled steel sheets - Grade 304",
          "product_category": "3310.15.10.00",
          "quantity": 5000,
          "unit": "kg",
          "spend_usd": 12500.00,
          "currency": "USD",
          "ghg_category": 1,
          "country": "US",
          "description": "High-grade stainless steel for automotive parts manufacturing",
          "custom_fields": {
            "cost_center": "CC-MFG-001",
            "project_code": "PRJ-AUTO-2024",
            "approval_status": "approved",
            "purchase_order": "PO-2024-08-1234"
          }
        },
        {
          "transaction_id": "TXN-2024-RTL-00003",
          "date": "2024-09-01",
          "supplier_name": "Pacific Freight Logistics",
          "supplier_id": "SUP-2001",
          "product_name": "Ocean freight container shipping - 40ft",
          "product_category": "78101803",
          "quantity": 12,
          "unit": "containers",
          "spend_usd": 24000.00,
          "currency": "USD",
          "ghg_category": 4,
          "country": "CN",
          "description": "Shanghai to Los Angeles route - consumer electronics shipment",
          "custom_fields": {
            "route": "SHA-LAX",
            "container_type": "40ft_HC",
            "shipment_weight_kg": 240000,
            "distance_km": 11150
          }
        },
        {
          "transaction_id": "TXN-2024-TECH-00005",
          "date": "2024-09-10",
          "supplier_name": "CloudCompute Services Inc.",
          "supplier_id": "SUP-4001",
          "product_name": "Cloud infrastructure services - Compute",
          "product_category": "81111800",
          "quantity": 5000,
          "unit": "compute-hours",
          "spend_usd": 15000.00,
          "currency": "USD",
          "ghg_category": 1,
          "country": "US",
          "description": "AWS EC2 instances for data processing and ML training",
          "custom_fields": {
            "cloud_provider": "AWS",
            "instance_type": "c5.4xlarge",
            "region": "us-east-1",
            "carbon_intensity_gCO2_kWh": 385
          }
        },
        {
          "transaction_id": "TXN-2024-TECH-00008",
          "date": "2024-09-25",
          "supplier_name": "TravelCorp Business Services",
          "supplier_id": "SUP-5001",
          "product_name": "Business travel - International flights",
          "product_category": "78111801",
          "quantity": 15,
          "unit": "trips",
          "spend_usd": 22500.00,
          "currency": "USD",
          "ghg_category": 6,
          "country": "US",
          "description": "Employee travel for client meetings and conferences Q3 2024",
          "custom_fields": {
            "travel_class": "economy",
            "total_distance_km": 45000,
            "number_of_travelers": 15,
            "average_trip_km": 3000
          }
        },
        {
          "transaction_id": "TXN-2024-MFG-00004",
          "date": "2024-09-05",
          "supplier_name": "GreenPower Energy Solutions",
          "supplier_id": "SUP-3001",
          "product_name": "Electricity - Renewable Energy Mix",
          "product_category": "26111701",
          "quantity": 150000,
          "unit": "kWh",
          "spend_usd": 18000.00,
          "currency": "USD",
          "ghg_category": 3,
          "country": "US",
          "description": "Monthly electricity consumption for manufacturing facility",
          "custom_fields": {
            "facility_id": "FAC-MFG-001",
            "renewable_percentage": 75,
            "grid_carbon_intensity_gCO2_kWh": 425,
            "meter_number": "MTR-12345"
          }
        }
      ],
      "validation_config": {
        "skip_duplicates": false,
        "validate_supplier_exists": true,
        "auto_categorize": false,
        "strict_mode": true
      }
    }
  ]
}
